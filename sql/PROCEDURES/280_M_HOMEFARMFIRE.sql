-- Object Type: PROCEDURES
CREATE OR REPLACE PROCEDURE ALFA_EDW_DEV.PUBLIC.M_HOMEFARMFIRE("RUN_ID" VARCHAR)
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS ' BEGIN 

-- Component HomeFarmFire, Type TRUNCATE_TABLE 
TRUNCATE TABLE DB_T_STAG_MEMBXREF_PROD.HomeFarmFire;


-- Component SQ_view_HomeFarmFire, Type SOURCE 
CREATE OR REPLACE TEMPORARY TABLE SQ_view_HomeFarmFire AS
(
SELECT /* adding column aliases to ensure proper downstream column references */
$1 as POLICY,
$2 as MEMBER_NUMBER,
$3 as AGENT,
$4 as FORM,
$5 as MAKE_MODEL,
$6 as LOCATION,
$7 as NAME1,
$8 as NAME2,
$9 as DWELLING,
$10 as OTHR_STR,
$11 as PERSONAL_PROPERTY,
$12 as LOSS_OF_USE,
$13 as LIABILITY,
$14 as MEDICAL,
$15 as DEDUCTIBLE,
$16 as CONSTRUCTION_YEAR,
$17 as EFF_DATE,
$18 as EXP_DATE,
$19 as PREMIUM,
$20 as STATUS,
$21 as MORTGAGE_IND,
$22 as DISCOUNT,
$23 as HOME_ALERT_DISCOUNT,
$24 as VALUE_CLIENT_DISCOUNT,
$25 as SPRINKLER_DISCOUNT,
$26 as NEW_HOME_DISCOUNT,
$27 as BLD_RISK_DISCOUNT,
$28 as END1,
$29 as END2,
$30 as END3,
$31 as END4,
$32 as END5,
$33 as END6,
$34 as END7,
$35 as END8,
$36 as END9,
$37 as END10,
$38 as OTHR_END1,
$39 as OTHR_END2,
$40 as OTHR_END3,
$41 as OTHR_END4,
$42 as OTHR_END5,
$43 as OTHR_END6,
$44 as OTHR_END7,
$45 as OTHR_END8,
$46 as OTHR_END9,
$47 as OTHR_END10,
$48 as CLAIM_DATE_1,
$49 as CLAIM_AMOUNT_1,
$50 as CLAIM_DATE_2,
$51 as CLAIM_AMOUNT_2,
$52 as CLAIM_DATE_3,
$53 as CLAIM_AMOUNT_3,
$54 as CLAIM_DATE_4,
$55 as CLAIM_AMOUNT_4,
$56 as CLAIM_DATE_5,
$57 as CLAIM_AMOUNT_5,
$58 as source_record_id
FROM (
SELECT SRC.*, row_number() over (order by 1) AS source_record_id FROM (
SELECT
view_HomeFarmFire.POLICY,
view_HomeFarmFire.MEMBER_NUMBER,
view_HomeFarmFire.AGENT,
view_HomeFarmFire.FORM,
view_HomeFarmFire.MAKE_MODEL,
view_HomeFarmFire.LOCATION,
view_HomeFarmFire.NAME1,
view_HomeFarmFire.NAME2,
view_HomeFarmFire.DWELLING,
view_HomeFarmFire.OTHR_STR,
view_HomeFarmFire.PERSONAL_PROPERTY,
view_HomeFarmFire.LOSS_OF_USE,
view_HomeFarmFire.LIABILITY,
view_HomeFarmFire.MEDICAL,
view_HomeFarmFire.DEDUCTIBLE,
view_HomeFarmFire.CONSTRUCTION_YEAR,
view_HomeFarmFire.EFF_DATE,
view_HomeFarmFire.EXP_DATE,
view_HomeFarmFire.PREMIUM,
view_HomeFarmFire.STATUS,
view_HomeFarmFire.MORTGAGE_IND,
view_HomeFarmFire.DISCOUNT,
view_HomeFarmFire.HOME_ALERT_DISCOUNT,
view_HomeFarmFire.VALUE_CLIENT_DISCOUNT,
view_HomeFarmFire.SPRINKLER_DISCOUNT,
view_HomeFarmFire.NEW_HOME_DISCOUNT,
view_HomeFarmFire.BLD_RISK_DISCOUNT,
view_HomeFarmFire.END1,
view_HomeFarmFire.END2,
view_HomeFarmFire.END3,
view_HomeFarmFire.END4,
view_HomeFarmFire.END5,
view_HomeFarmFire.END6,
view_HomeFarmFire.END7,
view_HomeFarmFire.END8,
view_HomeFarmFire.END9,
view_HomeFarmFire.END10,
view_HomeFarmFire.OTHR_END1,
view_HomeFarmFire.OTHR_END2,
view_HomeFarmFire.OTHR_END3,
view_HomeFarmFire.OTHR_END4,
view_HomeFarmFire.OTHR_END5,
view_HomeFarmFire.OTHR_END6,
view_HomeFarmFire.OTHR_END7,
view_HomeFarmFire.OTHR_END8,
view_HomeFarmFire.OTHR_END9,
view_HomeFarmFire.OTHR_END10,
view_HomeFarmFire.CLAIM_DATE_1,
view_HomeFarmFire.CLAIM_AMOUNT_1,
view_HomeFarmFire.CLAIM_DATE_2,
view_HomeFarmFire.CLAIM_AMOUNT_2,
view_HomeFarmFire.CLAIM_DATE_3,
view_HomeFarmFire.CLAIM_AMOUNT_3,
view_HomeFarmFire.CLAIM_DATE_4,
view_HomeFarmFire.CLAIM_AMOUNT_4,
view_HomeFarmFire.CLAIM_DATE_5,
view_HomeFarmFire.CLAIM_AMOUNT_5
FROM DB_T_STAG_MEMBXREF_PROD.view_HomeFarmFire
) SRC
)
);


-- Component EXPTRANS, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE EXPTRANS AS
(
SELECT
SQ_view_HomeFarmFire.POLICY as POLICY,
SQ_view_HomeFarmFire.MEMBER_NUMBER as MEMBER_NUMBER,
SQ_view_HomeFarmFire.AGENT as AGENT,
SQ_view_HomeFarmFire.FORM as FORM,
SQ_view_HomeFarmFire.MAKE_MODEL as MAKE_MODEL,
SQ_view_HomeFarmFire.LOCATION as LOCATION,
SQ_view_HomeFarmFire.NAME1 as NAME1,
SQ_view_HomeFarmFire.NAME2 as NAME2,
SQ_view_HomeFarmFire.DWELLING as DWELLING,
SQ_view_HomeFarmFire.OTHR_STR as OTHR_STR,
SQ_view_HomeFarmFire.PERSONAL_PROPERTY as PERSONAL_PROPERTY,
SQ_view_HomeFarmFire.LOSS_OF_USE as LOSS_OF_USE,
SQ_view_HomeFarmFire.LIABILITY as LIABILITY,
SQ_view_HomeFarmFire.MEDICAL as MEDICAL,
SQ_view_HomeFarmFire.DEDUCTIBLE as DEDUCTIBLE,
SQ_view_HomeFarmFire.CONSTRUCTION_YEAR as CONSTRUCTION_YEAR,
SQ_view_HomeFarmFire.EFF_DATE as EFF_DATE,
SQ_view_HomeFarmFire.EXP_DATE as EXP_DATE,
SQ_view_HomeFarmFire.PREMIUM as PREMIUM,
SQ_view_HomeFarmFire.STATUS as STATUS,
SQ_view_HomeFarmFire.MORTGAGE_IND as MORTGAGE_IND,
SQ_view_HomeFarmFire.DISCOUNT as DISCOUNT,
SQ_view_HomeFarmFire.HOME_ALERT_DISCOUNT as HOME_ALERT_DISCOUNT,
SQ_view_HomeFarmFire.VALUE_CLIENT_DISCOUNT as VALUE_CLIENT_DISCOUNT,
SQ_view_HomeFarmFire.SPRINKLER_DISCOUNT as SPRINKLER_DISCOUNT,
SQ_view_HomeFarmFire.NEW_HOME_DISCOUNT as NEW_HOME_DISCOUNT,
SQ_view_HomeFarmFire.BLD_RISK_DISCOUNT as BLD_RISK_DISCOUNT,
SQ_view_HomeFarmFire.END1 as END1,
SQ_view_HomeFarmFire.END2 as END2,
SQ_view_HomeFarmFire.END3 as END3,
SQ_view_HomeFarmFire.END4 as END4,
SQ_view_HomeFarmFire.END5 as END5,
SQ_view_HomeFarmFire.END6 as END6,
SQ_view_HomeFarmFire.END7 as END7,
SQ_view_HomeFarmFire.END8 as END8,
SQ_view_HomeFarmFire.END9 as END9,
SQ_view_HomeFarmFire.END10 as END10,
SQ_view_HomeFarmFire.OTHR_END1 as OTHR_END1,
SQ_view_HomeFarmFire.OTHR_END2 as OTHR_END2,
SQ_view_HomeFarmFire.OTHR_END3 as OTHR_END3,
SQ_view_HomeFarmFire.OTHR_END4 as OTHR_END4,
SQ_view_HomeFarmFire.OTHR_END5 as OTHR_END5,
SQ_view_HomeFarmFire.OTHR_END6 as OTHR_END6,
SQ_view_HomeFarmFire.OTHR_END7 as OTHR_END7,
SQ_view_HomeFarmFire.OTHR_END8 as OTHR_END8,
SQ_view_HomeFarmFire.OTHR_END9 as OTHR_END9,
SQ_view_HomeFarmFire.OTHR_END10 as OTHR_END10,
SQ_view_HomeFarmFire.CLAIM_DATE_1 as CLAIM_DATE_1,
SQ_view_HomeFarmFire.CLAIM_AMOUNT_1 as CLAIM_AMOUNT_1,
SQ_view_HomeFarmFire.CLAIM_DATE_2 as CLAIM_DATE_2,
SQ_view_HomeFarmFire.CLAIM_AMOUNT_2 as CLAIM_AMOUNT_2,
SQ_view_HomeFarmFire.CLAIM_DATE_3 as CLAIM_DATE_3,
SQ_view_HomeFarmFire.CLAIM_AMOUNT_3 as CLAIM_AMOUNT_3,
SQ_view_HomeFarmFire.CLAIM_DATE_4 as CLAIM_DATE_4,
SQ_view_HomeFarmFire.CLAIM_AMOUNT_4 as CLAIM_AMOUNT_4,
SQ_view_HomeFarmFire.CLAIM_DATE_5 as CLAIM_DATE_5,
SQ_view_HomeFarmFire.CLAIM_AMOUNT_5 as CLAIM_AMOUNT_5,
SQ_view_HomeFarmFire.source_record_id
FROM
SQ_view_HomeFarmFire
);


-- Component HomeFarmFire, Type TARGET 
INSERT INTO DB_T_STAG_MEMBXREF_PROD.HomeFarmFire
(
POLICY,
MEMBER_NUMBER,
AGENT,
FORM,
MAKE_MODEL,
LOCATION,
NAME1,
NAME2,
DWELLING,
OTHR_STR,
PERSONAL_PROPERTY,
LOSS_OF_USE,
LIABILITY,
MEDICAL,
DEDUCTIBLE,
CONSTRUCTION_YEAR,
EFF_DATE,
EXP_DATE,
PREMIUM,
STATUS,
MORTGAGE_IND,
DISCOUNT,
HOME_ALERT_DISCOUNT,
VALUE_CLIENT_DISCOUNT,
SPRINKLER_DISCOUNT,
NEW_HOME_DISCOUNT,
BLD_RISK_DISCOUNT,
END1,
END2,
END3,
END4,
END5,
END6,
END7,
END8,
END9,
END10,
OTHR_END1,
OTHR_END2,
OTHR_END3,
OTHR_END4,
OTHR_END5,
OTHR_END6,
OTHR_END7,
OTHR_END8,
OTHR_END9,
OTHR_END10,
CLAIM_DATE_1,
CLAIM_AMOUNT_1,
CLAIM_DATE_2,
CLAIM_AMOUNT_2,
CLAIM_DATE_3,
CLAIM_AMOUNT_3,
CLAIM_DATE_4,
CLAIM_AMOUNT_4,
CLAIM_DATE_5,
CLAIM_AMOUNT_5
)
SELECT
EXPTRANS.POLICY as POLICY,
EXPTRANS.MEMBER_NUMBER as MEMBER_NUMBER,
EXPTRANS.AGENT as AGENT,
EXPTRANS.FORM as FORM,
EXPTRANS.MAKE_MODEL as MAKE_MODEL,
EXPTRANS.LOCATION as LOCATION,
EXPTRANS.NAME1 as NAME1,
EXPTRANS.NAME2 as NAME2,
EXPTRANS.DWELLING as DWELLING,
EXPTRANS.OTHR_STR as OTHR_STR,
EXPTRANS.PERSONAL_PROPERTY as PERSONAL_PROPERTY,
EXPTRANS.LOSS_OF_USE as LOSS_OF_USE,
EXPTRANS.LIABILITY as LIABILITY,
EXPTRANS.MEDICAL as MEDICAL,
EXPTRANS.DEDUCTIBLE as DEDUCTIBLE,
EXPTRANS.CONSTRUCTION_YEAR as CONSTRUCTION_YEAR,
EXPTRANS.EFF_DATE as EFF_DATE,
EXPTRANS.EXP_DATE as EXP_DATE,
EXPTRANS.PREMIUM as PREMIUM,
EXPTRANS.STATUS as STATUS,
EXPTRANS.MORTGAGE_IND as MORTGAGE_IND,
EXPTRANS.DISCOUNT as DISCOUNT,
EXPTRANS.HOME_ALERT_DISCOUNT as HOME_ALERT_DISCOUNT,
EXPTRANS.VALUE_CLIENT_DISCOUNT as VALUE_CLIENT_DISCOUNT,
EXPTRANS.SPRINKLER_DISCOUNT as SPRINKLER_DISCOUNT,
EXPTRANS.NEW_HOME_DISCOUNT as NEW_HOME_DISCOUNT,
EXPTRANS.BLD_RISK_DISCOUNT as BLD_RISK_DISCOUNT,
EXPTRANS.END1 as END1,
EXPTRANS.END2 as END2,
EXPTRANS.END3 as END3,
EXPTRANS.END4 as END4,
EXPTRANS.END5 as END5,
EXPTRANS.END6 as END6,
EXPTRANS.END7 as END7,
EXPTRANS.END8 as END8,
EXPTRANS.END9 as END9,
EXPTRANS.END10 as END10,
EXPTRANS.OTHR_END1 as OTHR_END1,
EXPTRANS.OTHR_END2 as OTHR_END2,
EXPTRANS.OTHR_END3 as OTHR_END3,
EXPTRANS.OTHR_END4 as OTHR_END4,
EXPTRANS.OTHR_END5 as OTHR_END5,
EXPTRANS.OTHR_END6 as OTHR_END6,
EXPTRANS.OTHR_END7 as OTHR_END7,
EXPTRANS.OTHR_END8 as OTHR_END8,
EXPTRANS.OTHR_END9 as OTHR_END9,
EXPTRANS.OTHR_END10 as OTHR_END10,
EXPTRANS.CLAIM_DATE_1 as CLAIM_DATE_1,
EXPTRANS.CLAIM_AMOUNT_1 as CLAIM_AMOUNT_1,
EXPTRANS.CLAIM_DATE_2 as CLAIM_DATE_2,
EXPTRANS.CLAIM_AMOUNT_2 as CLAIM_AMOUNT_2,
EXPTRANS.CLAIM_DATE_3 as CLAIM_DATE_3,
EXPTRANS.CLAIM_AMOUNT_3 as CLAIM_AMOUNT_3,
EXPTRANS.CLAIM_DATE_4 as CLAIM_DATE_4,
EXPTRANS.CLAIM_AMOUNT_4 as CLAIM_AMOUNT_4,
EXPTRANS.CLAIM_DATE_5 as CLAIM_DATE_5,
EXPTRANS.CLAIM_AMOUNT_5 as CLAIM_AMOUNT_5
FROM
EXPTRANS;


END; ';
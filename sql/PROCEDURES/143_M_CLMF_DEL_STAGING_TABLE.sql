-- Object Type: PROCEDURES
CREATE OR REPLACE PROCEDURE ALFA_EDW_DEV.PUBLIC.M_CLMF_DEL_STAGING_TABLE("RUN_ID" VARCHAR)
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS ' BEGIN 

-- Component SQ_STG_CLMF_CLM_NO_TRL_AUTO, Type SOURCE 
CREATE OR REPLACE TEMPORARY TABLE SQ_STG_CLMF_CLM_NO_TRL_AUTO AS
(
SELECT /* adding column aliases to ensure proper downstream column references */
$1 as OPERATOR_ID,
$2 as COMPANY,
$3 as MRI,
$4 as TRL_COUNT,
$5 as POL_STATE,
$6 as PFX,
$7 as PNO,
$8 as DATE_O_LOSS,
$9 as DATE_O_LOSS_DT,
$10 as SEQNO,
$11 as TRANS_ID,
$12 as DIST,
$13 as ADJSYM,
$14 as FAST_TRAC,
$15 as GLASBRK,
$16 as SUSP,
$17 as SAL_SUB,
$18 as SUIT_CD,
$19 as SLC_CD,
$20 as REPT_DT,
$21 as REPT_DATE,
$22 as ACCTG_DT,
$23 as ACCTG_DATE,
$24 as CAUSE_CD,
$25 as CAUSE_DESC,
$26 as COT_PLN,
$27 as CAT_CD,
$28 as RISK_ID,
$29 as CLOSE_CD,
$30 as CLOSE_DT,
$31 as CLOSE_DATE,
$32 as NO_REO,
$33 as REIN,
$34 as ENC_CD,
$35 as AGTNO,
$36 as SCNO,
$37 as INSD_NM,
$38 as OCC_CD,
$39 as TIME_O_LOSS,
$40 as SUBROGATION_DATE,
$41 as PURG_CLM_FROM_FOLDER,
$42 as RECOVERABLE_LOSS_CD,
$43 as RECOVERABLE_LOSS_AMT,
$44 as PREM_FINANCE,
$45 as HIGH_PERFORM_CODE,
$46 as FIBER_GLASS_CODE,
$47 as INEXPER_DRVR_CODE,
$48 as FINANCIAL_RESPONBILITY_CODE,
$49 as MISC_DISCOUNT,
$50 as HO_DISCOUNT,
$51 as SM_SP_POLICY_IND,
$52 as PREV_AGENT,
$53 as CHANGE_AGT_DT,
$54 as CHANGE_AGT_DATE,
$55 as WC_EFF_YR,
$56 as POL_FOLDER_DATE,
$57 as POL_FOLDER_DT,
$58 as TRANSFERRED_POL_NBR,
$59 as CLUE_CHANGE_MMYY,
$60 as CLUE_REPT_ITEM,
$61 as MISS_FIRE_CLM_IND,
$62 as TIMES_NOT_FOUND,
$63 as TOT_RES_AMT,
$64 as TOT_PAID_AMT,
$65 as AC_VEHICLE_ID_NO,
$66 as AC_DRVERNO,
$67 as AC_DRVERNM,
$68 as AC_ARRP_CHRG_DT,
$69 as AC_ARRP_CHRG_DATE,
$70 as AC_FATAL_CD,
$71 as AC_FLEET_ITEM_NO,
$72 as AC_CARYR,
$73 as AC_MAKE,
$74 as AC_MODEL,
$75 as AC_HPTON,
$76 as AC_VEHICLE_TYPE,
$77 as TERR,
$78 as USEX,
$79 as DC,
$80 as SYM,
$81 as AC_DISC,
$82 as AC_DRLISC,
$83 as AC_DR_DOB,
$84 as AC_DR_DOB_DATE,
$85 as AC_ARRP_CODE,
$86 as AC_CAMPER_BODY,
$87 as source_record_id
FROM (
SELECT SRC.*, row_number() over (order by 1) AS source_record_id FROM (
SELECT * from DB_T_STAG_PROD.stg_clmf_clm_no_trl_auto

where 1=2
) SRC
)
);


-- Component EXPTRANS, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE EXPTRANS AS
(
SELECT
SQ_STG_CLMF_CLM_NO_TRL_AUTO.OPERATOR_ID as OPERATOR_ID,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.COMPANY as COMPANY,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.MRI as MRI,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.TRL_COUNT as TRL_COUNT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.POL_STATE as POL_STATE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.PFX as PFX,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.PNO as PNO,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.DATE_O_LOSS as DATE_O_LOSS,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.DATE_O_LOSS_DT as DATE_O_LOSS_DT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.SEQNO as SEQNO,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.TRANS_ID as TRANS_ID,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.DIST as DIST,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.ADJSYM as ADJSYM,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.FAST_TRAC as FAST_TRAC,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.GLASBRK as GLASBRK,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.SUSP as SUSP,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.SAL_SUB as SAL_SUB,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.SUIT_CD as SUIT_CD,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.SLC_CD as SLC_CD,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.REPT_DT as REPT_DT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.REPT_DATE as REPT_DATE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.ACCTG_DT as ACCTG_DT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.ACCTG_DATE as ACCTG_DATE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.CAUSE_CD as CAUSE_CD,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.CAUSE_DESC as CAUSE_DESC,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.COT_PLN as COT_PLN,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.CAT_CD as CAT_CD,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.RISK_ID as RISK_ID,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.CLOSE_CD as CLOSE_CD,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.CLOSE_DT as CLOSE_DT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.CLOSE_DATE as CLOSE_DATE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.NO_REO as NO_REO,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.REIN as REIN,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.ENC_CD as ENC_CD,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AGTNO as AGTNO,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.SCNO as SCNO,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.INSD_NM as INSD_NM,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.OCC_CD as OCC_CD,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.TIME_O_LOSS as TIME_O_LOSS,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.SUBROGATION_DATE as SUBROGATION_DATE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.PURG_CLM_FROM_FOLDER as PURG_CLM_FROM_FOLDER,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.RECOVERABLE_LOSS_CD as RECOVERABLE_LOSS_CD,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.RECOVERABLE_LOSS_AMT as RECOVERABLE_LOSS_AMT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.PREM_FINANCE as PREM_FINANCE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.HIGH_PERFORM_CODE as HIGH_PERFORM_CODE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.FIBER_GLASS_CODE as FIBER_GLASS_CODE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.INEXPER_DRVR_CODE as INEXPER_DRVR_CODE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.FINANCIAL_RESPONBILITY_CODE as FINANCIAL_RESPONBILITY_CODE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.MISC_DISCOUNT as MISC_DISCOUNT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.HO_DISCOUNT as HO_DISCOUNT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.SM_SP_POLICY_IND as SM_SP_POLICY_IND,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.PREV_AGENT as PREV_AGENT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.CHANGE_AGT_DT as CHANGE_AGT_DT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.CHANGE_AGT_DATE as CHANGE_AGT_DATE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.WC_EFF_YR as WC_EFF_YR,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.POL_FOLDER_DATE as POL_FOLDER_DATE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.POL_FOLDER_DT as POL_FOLDER_DT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.TRANSFERRED_POL_NBR as TRANSFERRED_POL_NBR,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.CLUE_CHANGE_MMYY as CLUE_CHANGE_MMYY,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.CLUE_REPT_ITEM as CLUE_REPT_ITEM,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.MISS_FIRE_CLM_IND as MISS_FIRE_CLM_IND,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.TIMES_NOT_FOUND as TIMES_NOT_FOUND,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.TOT_RES_AMT as TOT_RES_AMT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.TOT_PAID_AMT as TOT_PAID_AMT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_VEHICLE_ID_NO as AC_VEHICLE_ID_NO,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_DRVERNO as AC_DRVERNO,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_DRVERNM as AC_DRVERNM,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_ARRP_CHRG_DT as AC_ARRP_CHRG_DT,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_ARRP_CHRG_DATE as AC_ARRP_CHRG_DATE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_FATAL_CD as AC_FATAL_CD,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_FLEET_ITEM_NO as AC_FLEET_ITEM_NO,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_CARYR as AC_CARYR,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_MAKE as AC_MAKE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_MODEL as AC_MODEL,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_HPTON as AC_HPTON,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_VEHICLE_TYPE as AC_VEHICLE_TYPE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.TERR as TERR,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.USEX as USEX,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.DC as DC,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.SYM as SYM,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_DISC as AC_DISC,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_DRLISC as AC_DRLISC,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_DR_DOB as AC_DR_DOB,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_DR_DOB_DATE as AC_DR_DOB_DATE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_ARRP_CODE as AC_ARRP_CODE,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.AC_CAMPER_BODY as AC_CAMPER_BODY,
SQ_STG_CLMF_CLM_NO_TRL_AUTO.source_record_id
FROM
SQ_STG_CLMF_CLM_NO_TRL_AUTO
);


-- Component STG_CLMF_CLM_NO_TRL_AUTO1, Type TARGET 
INSERT INTO DB_T_STAG_PROD.STG_CLMF_CLM_NO_TRL_AUTO
(
OPERATOR_ID,
COMPANY,
MRI,
TRL_COUNT,
POL_STATE,
PFX,
PNO,
DATE_O_LOSS,
DATE_O_LOSS_DT,
SEQNO,
TRANS_ID,
DIST,
ADJSYM,
FAST_TRAC,
GLASBRK,
SUSP,
SAL_SUB,
SUIT_CD,
SLC_CD,
REPT_DT,
REPT_DATE,
ACCTG_DT,
ACCTG_DATE,
CAUSE_CD,
CAUSE_DESC,
COT_PLN,
CAT_CD,
RISK_ID,
CLOSE_CD,
CLOSE_DT,
CLOSE_DATE,
NO_REO,
REIN,
ENC_CD,
AGTNO,
SCNO,
INSD_NM,
OCC_CD,
TIME_O_LOSS,
SUBROGATION_DATE,
PURG_CLM_FROM_FOLDER,
RECOVERABLE_LOSS_CD,
RECOVERABLE_LOSS_AMT,
PREM_FINANCE,
HIGH_PERFORM_CODE,
FIBER_GLASS_CODE,
INEXPER_DRVR_CODE,
FINANCIAL_RESPONBILITY_CODE,
MISC_DISCOUNT,
HO_DISCOUNT,
SM_SP_POLICY_IND,
PREV_AGENT,
CHANGE_AGT_DT,
CHANGE_AGT_DATE,
WC_EFF_YR,
POL_FOLDER_DATE,
POL_FOLDER_DT,
TRANSFERRED_POL_NBR,
CLUE_CHANGE_MMYY,
CLUE_REPT_ITEM,
MISS_FIRE_CLM_IND,
TIMES_NOT_FOUND,
TOT_RES_AMT,
TOT_PAID_AMT,
AC_VEHICLE_ID_NO,
AC_DRVERNO,
AC_DRVERNM,
AC_ARRP_CHRG_DT,
AC_ARRP_CHRG_DATE,
AC_FATAL_CD,
AC_FLEET_ITEM_NO,
AC_CARYR,
AC_MAKE,
AC_MODEL,
AC_HPTON,
AC_VEHICLE_TYPE,
TERR,
USEX,
DC,
SYM,
AC_DISC,
AC_DRLISC,
AC_DR_DOB,
AC_DR_DOB_DATE,
AC_ARRP_CODE,
AC_CAMPER_BODY
)
SELECT
EXPTRANS.OPERATOR_ID as OPERATOR_ID,
EXPTRANS.COMPANY as COMPANY,
EXPTRANS.MRI as MRI,
EXPTRANS.TRL_COUNT as TRL_COUNT,
EXPTRANS.POL_STATE as POL_STATE,
EXPTRANS.PFX as PFX,
EXPTRANS.PNO as PNO,
EXPTRANS.DATE_O_LOSS as DATE_O_LOSS,
EXPTRANS.DATE_O_LOSS_DT as DATE_O_LOSS_DT,
EXPTRANS.SEQNO as SEQNO,
EXPTRANS.TRANS_ID as TRANS_ID,
EXPTRANS.DIST as DIST,
EXPTRANS.ADJSYM as ADJSYM,
EXPTRANS.FAST_TRAC as FAST_TRAC,
EXPTRANS.GLASBRK as GLASBRK,
EXPTRANS.SUSP as SUSP,
EXPTRANS.SAL_SUB as SAL_SUB,
EXPTRANS.SUIT_CD as SUIT_CD,
EXPTRANS.SLC_CD as SLC_CD,
EXPTRANS.REPT_DT as REPT_DT,
EXPTRANS.REPT_DATE as REPT_DATE,
EXPTRANS.ACCTG_DT as ACCTG_DT,
EXPTRANS.ACCTG_DATE as ACCTG_DATE,
EXPTRANS.CAUSE_CD as CAUSE_CD,
EXPTRANS.CAUSE_DESC as CAUSE_DESC,
EXPTRANS.COT_PLN as COT_PLN,
EXPTRANS.CAT_CD as CAT_CD,
EXPTRANS.RISK_ID as RISK_ID,
EXPTRANS.CLOSE_CD as CLOSE_CD,
EXPTRANS.CLOSE_DT as CLOSE_DT,
EXPTRANS.CLOSE_DATE as CLOSE_DATE,
EXPTRANS.NO_REO as NO_REO,
EXPTRANS.REIN as REIN,
EXPTRANS.ENC_CD as ENC_CD,
EXPTRANS.AGTNO as AGTNO,
EXPTRANS.SCNO as SCNO,
EXPTRANS.INSD_NM as INSD_NM,
EXPTRANS.OCC_CD as OCC_CD,
EXPTRANS.TIME_O_LOSS as TIME_O_LOSS,
EXPTRANS.SUBROGATION_DATE as SUBROGATION_DATE,
EXPTRANS.PURG_CLM_FROM_FOLDER as PURG_CLM_FROM_FOLDER,
EXPTRANS.RECOVERABLE_LOSS_CD as RECOVERABLE_LOSS_CD,
EXPTRANS.RECOVERABLE_LOSS_AMT as RECOVERABLE_LOSS_AMT,
EXPTRANS.PREM_FINANCE as PREM_FINANCE,
EXPTRANS.HIGH_PERFORM_CODE as HIGH_PERFORM_CODE,
EXPTRANS.FIBER_GLASS_CODE as FIBER_GLASS_CODE,
EXPTRANS.INEXPER_DRVR_CODE as INEXPER_DRVR_CODE,
EXPTRANS.FINANCIAL_RESPONBILITY_CODE as FINANCIAL_RESPONBILITY_CODE,
EXPTRANS.MISC_DISCOUNT as MISC_DISCOUNT,
EXPTRANS.HO_DISCOUNT as HO_DISCOUNT,
EXPTRANS.SM_SP_POLICY_IND as SM_SP_POLICY_IND,
EXPTRANS.PREV_AGENT as PREV_AGENT,
EXPTRANS.CHANGE_AGT_DT as CHANGE_AGT_DT,
EXPTRANS.CHANGE_AGT_DATE as CHANGE_AGT_DATE,
EXPTRANS.WC_EFF_YR as WC_EFF_YR,
EXPTRANS.POL_FOLDER_DATE as POL_FOLDER_DATE,
EXPTRANS.POL_FOLDER_DT as POL_FOLDER_DT,
EXPTRANS.TRANSFERRED_POL_NBR as TRANSFERRED_POL_NBR,
EXPTRANS.CLUE_CHANGE_MMYY as CLUE_CHANGE_MMYY,
EXPTRANS.CLUE_REPT_ITEM as CLUE_REPT_ITEM,
EXPTRANS.MISS_FIRE_CLM_IND as MISS_FIRE_CLM_IND,
EXPTRANS.TIMES_NOT_FOUND as TIMES_NOT_FOUND,
EXPTRANS.TOT_RES_AMT as TOT_RES_AMT,
EXPTRANS.TOT_PAID_AMT as TOT_PAID_AMT,
EXPTRANS.AC_VEHICLE_ID_NO as AC_VEHICLE_ID_NO,
EXPTRANS.AC_DRVERNO as AC_DRVERNO,
EXPTRANS.AC_DRVERNM as AC_DRVERNM,
EXPTRANS.AC_ARRP_CHRG_DT as AC_ARRP_CHRG_DT,
EXPTRANS.AC_ARRP_CHRG_DATE as AC_ARRP_CHRG_DATE,
EXPTRANS.AC_FATAL_CD as AC_FATAL_CD,
EXPTRANS.AC_FLEET_ITEM_NO as AC_FLEET_ITEM_NO,
EXPTRANS.AC_CARYR as AC_CARYR,
EXPTRANS.AC_MAKE as AC_MAKE,
EXPTRANS.AC_MODEL as AC_MODEL,
EXPTRANS.AC_HPTON as AC_HPTON,
EXPTRANS.AC_VEHICLE_TYPE as AC_VEHICLE_TYPE,
EXPTRANS.TERR as TERR,
EXPTRANS.USEX as USEX,
EXPTRANS.DC as DC,
EXPTRANS.SYM as SYM,
EXPTRANS.AC_DISC as AC_DISC,
EXPTRANS.AC_DRLISC as AC_DRLISC,
EXPTRANS.AC_DR_DOB as AC_DR_DOB,
EXPTRANS.AC_DR_DOB_DATE as AC_DR_DOB_DATE,
EXPTRANS.AC_ARRP_CODE as AC_ARRP_CODE,
EXPTRANS.AC_CAMPER_BODY as AC_CAMPER_BODY
FROM
EXPTRANS;


-- Component STG_CLMF_CLM_NO_TRL_AUTO1, Type Post SQL 
DELETE FROM DB_T_STAG_PROD.STG_CLMF_CLM_NO_TRL_AUTO;



DELETE FROM DB_T_STAG_PROD.STG_CLMF_CLM_NO_TRL_HO;



DELETE FROM DB_T_STAG_PROD.STG_CLMF_CLM_NO_TRL_WC;



DELETE FROM DB_T_STAG_PROD.STG_CLMF_CLM_LOSS_RESERVE_AUTO;



DELETE FROM DB_T_STAG_PROD.STG_CLMF_CLM_LOSS_RESERVE_HO;



DELETE FROM DB_T_STAG_PROD.STG_CLMF_CLM_LOSS_RESERVE_WC;



DELETE FROM DB_T_STAG_PROD.STG_CLMF_CLM_SURVEY_LTR_AUTO;



DELETE FROM DB_T_STAG_PROD.STG_CLMF_CLM_SURVEY_LTR_HO;



DELETE FROM DB_T_STAG_PROD.STG_CLMF_CLM_SURVEY_LTR_WC;


END; ';
-- Object Type: PROCEDURES
CREATE OR REPLACE PROCEDURE ALFA_EDW_DEV.PUBLIC.M_SMLNPOLS("RUN_ID" VARCHAR)
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS ' DECLARE PMMAPPINGNAME varchar;
PROJ_ID varchar;
BATCH_ACTIVE_IND varchar;
BEGIN 

PMMAPPINGNAME:=''M_SMLNPOLS'';  
BATCH_ACTIVE_IND:=(select ectl_active_ind from DB_T_CTRL_FIN_PROD.ECTL_BATCH_INFO where ECTL_BATCH_ID= :run_id); 
PROJ_ID:=(select ectl_proj_id from DB_T_CTRL_FIN_PROD.ECTL_BATCH_INFO where ECTL_BATCH_ID= :run_id); 

-- Component LKP_STG_MEMBXREF_TRIGGER, Type Prerequisite Lookup Object 
CREATE OR REPLACE TEMPORARY TABLE LKP_STG_MEMBXREF_TRIGGER AS
(
SELECT
TABLENAME,
FEED_DT
FROM DB_T_STAG_MEMBXREF_PROD.STG_MEMBXREF_TRIGGER
);


-- PIPELINE START FOR 1

-- Component SQ_SMLNPOLS, Type SOURCE 
CREATE OR REPLACE TEMPORARY TABLE SQ_SMLNPOLS AS
(
SELECT /* adding column aliases to ensure proper downstream column references */
$1 as SC_POLICY_NUM,
$2 as CHG_EFF_DT,
$3 as source_record_id
FROM (
SELECT SRC.*, row_number() over (order by 1) AS source_record_id FROM (
SELECT SMLNPOLS.SC_POLICY_NUM ,SMLNPOLS.CHG_EFF_DT 
FROM
 DB_T_CORE_MEMBXREF_PROD.SMLNPOLS WHERE CHG_EXP_DT = CAST(''9999-12-31'' AS DATE ) 
) SRC
)
);


-- Component exp_ASSIGN_DUMMY_TG, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_ASSIGN_DUMMY_TG AS
(
SELECT
SQ_SMLNPOLS.SC_POLICY_NUM as SC_POLICY_NUM,
SQ_SMLNPOLS.CHG_EFF_DT as CHG_EFF_DT,
''SMLNPOLS'' as var_TABLENAME,
LKP_1.FEED_DT /* replaced lookup LKP_STG_MEMBXREF_TRIGGER */ as var_FEED_DT,
var_FEED_DT as out_FEED_DT,
SQ_SMLNPOLS.source_record_id,
row_number() over (partition by SQ_SMLNPOLS.source_record_id order by SQ_SMLNPOLS.source_record_id) as RNK
FROM
SQ_SMLNPOLS
LEFT JOIN LKP_STG_MEMBXREF_TRIGGER LKP_1 ON LKP_1.TABLENAME = var_TABLENAME
QUALIFY RNK = 1
);


-- Component LKP_STG_SMLNPOLS, Type LOOKUP 
CREATE OR REPLACE TEMPORARY TABLE LKP_STG_SMLNPOLS AS
(
SELECT
LKP.SC_POLICY_NUM,
exp_ASSIGN_DUMMY_TG.source_record_id,
ROW_NUMBER() OVER(PARTITION BY exp_ASSIGN_DUMMY_TG.source_record_id ORDER BY LKP.SC_POLICY_NUM asc) RNK
FROM
exp_ASSIGN_DUMMY_TG
LEFT JOIN (
SELECT LTRIM(RTRIM(STG_SMLNPOLS.SC_POLICY_NUM)) as SC_POLICY_NUM FROM DB_T_STAG_MEMBXREF_PROD.STG_SMLNPOLS WHERE
 STG_SMLNPOLS. LOAD_DT=(SELECT FEED_DT FROM DB_T_STAG_MEMBXREF_PROD.STG_MEMBXREF_TRIGGER WHERE TABLENAME=''SMLNPOLS'')
) LKP ON LKP.SC_POLICY_NUM = exp_ASSIGN_DUMMY_TG.SC_POLICY_NUM
QUALIFY RNK = 1
);


-- Component fil_EXPIRED_POLS, Type FILTER 
CREATE OR REPLACE TEMPORARY TABLE fil_EXPIRED_POLS AS
(
SELECT
LKP_STG_SMLNPOLS.SC_POLICY_NUM as SC_POLICY_NUM_tgt,
exp_ASSIGN_DUMMY_TG.CHG_EFF_DT as CHG_EFF_DT,
exp_ASSIGN_DUMMY_TG.out_FEED_DT as LOAD_DT,
exp_ASSIGN_DUMMY_TG.SC_POLICY_NUM as SC_POLICY_NUM,
exp_ASSIGN_DUMMY_TG.source_record_id
FROM
exp_ASSIGN_DUMMY_TG
LEFT JOIN LKP_STG_SMLNPOLS ON exp_ASSIGN_DUMMY_TG.source_record_id = LKP_STG_SMLNPOLS.source_record_id
WHERE LKP_STG_SMLNPOLS.SC_POLICY_NUM IS NULL
);


-- Component exp_INPUT_ECTL_FIELD, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_INPUT_ECTL_FIELD AS
(
SELECT
fil_EXPIRED_POLS.CHG_EFF_DT as CHG_EFF_DT,
fil_EXPIRED_POLS.SC_POLICY_NUM as SC_POLICY_NUM,
LTRIM ( RTRIM ( :PMMappingName ) ) as out_PROJ_NAME,
:PROJ_ID as out_PROJ_ID,
:BATCH_ACTIVE_IND as out_BATCH_ACTIVE_IND,
:PROJ_ID as IN_ACT_PROJ_ID,
:BATCH_ACTIVE_IND as IN_BATCH_ACTIVE_IND,
''m_STG_FIN_CLM'' IN_PRGM_NM,
null IN_TABLE_NM,
''UPD'' as ECTL_TX_CD,
TO_CHAR ( ( DATE_PART(''YYYY'', TO_TIMESTAMP(fil_EXPIRED_POLS.LOAD_DT)) * 10000 ) + ( DATE_PART(''MM'', TO_TIMESTAMP(fil_EXPIRED_POLS.LOAD_DT)) * 100 ) + 1 ) as var_FIRST_DAY_EFF_DT,
 TO_DATE ( var_FIRST_DAY_EFF_DT ) - 1  as var_CHG_EXP_DT_new,
CASE WHEN fil_EXPIRED_POLS.CHG_EFF_DT >= var_CHG_EXP_DT_new THEN fil_EXPIRED_POLS.CHG_EFF_DT ELSE var_CHG_EXP_DT_new END as out_CHG_EXP_DT_new,
CURRENT_TIMESTAMP as ECTL_END_DATE,
fil_EXPIRED_POLS.source_record_id
FROM
fil_EXPIRED_POLS
);


-- Component mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1, Type MAPPLET 
--MAPPLET NOT REGISTERED: mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE, mapplet instance mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1;
call mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE(''exp_INPUT_ECTL_FIELD'');

-- Component upd_SMLNPOLS_EXPIRED_POLS, Type UPDATE 
CREATE OR REPLACE TEMPORARY TABLE upd_SMLNPOLS_EXPIRED_POLS AS
(
/* UPDATE_STRATEGY_ACTION = 0 FOR INSERT / UPDATE_STRATEGY_ACTION = 1 FOR UPDATE / UPDATE_STRATEGY_ACTION = 2 FOR DELETE / UPDATE_STRATEGY_ACTION = 3 FOR REJECT */
SELECT
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1.out_ECTL_BATCH_ID as out_ECTL_BATCH_ID,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1.out_ORIG_INS_TS as out_ORIG_INS_TS,
--null as out_ECTL_BATCH_ID,
--null as out_ORIG_INS_TS,
exp_INPUT_ECTL_FIELD.SC_POLICY_NUM as SC_POLICY_NUM,
exp_INPUT_ECTL_FIELD.CHG_EFF_DT as CHG_EFF_DT,
exp_INPUT_ECTL_FIELD.ECTL_TX_CD as ECTL_TX_CD,
exp_INPUT_ECTL_FIELD.out_CHG_EXP_DT_new as out_CHG_EXP_DT_new,
exp_INPUT_ECTL_FIELD.ECTL_END_DATE as ECTL_END_DATE,
1 as UPDATE_STRATEGY_ACTION
FROM
exp_INPUT_ECTL_FIELD
LEFT JOIN mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1 ON exp_INPUT_ECTL_FIELD.source_record_id = mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1.source_record_id
);


-- Component SMLNPOLS_UPD_EXPIRED_POLS, Type TARGET 
INSERT INTO DB_T_CORE_MEMBXREF_PROD.SMLNPOLS
(
SC_POLICY_NUM,
CHG_EFF_DT,
CHG_EXP_DT,
ECTL_BATCH_ID,
ECTL_MODIFY_TS,
ECTL_TX_CD,
ECTL_END_DATE
)
SELECT
upd_SMLNPOLS_EXPIRED_POLS.SC_POLICY_NUM as SC_POLICY_NUM,
upd_SMLNPOLS_EXPIRED_POLS.CHG_EFF_DT as CHG_EFF_DT,
upd_SMLNPOLS_EXPIRED_POLS.out_CHG_EXP_DT_new as CHG_EXP_DT,
upd_SMLNPOLS_EXPIRED_POLS.out_ECTL_BATCH_ID as ECTL_BATCH_ID,
upd_SMLNPOLS_EXPIRED_POLS.out_ORIG_INS_TS as ECTL_MODIFY_TS,
upd_SMLNPOLS_EXPIRED_POLS.ECTL_TX_CD as ECTL_TX_CD,
upd_SMLNPOLS_EXPIRED_POLS.ECTL_END_DATE as ECTL_END_DATE
FROM
upd_SMLNPOLS_EXPIRED_POLS
WHERE UPDATE_STRATEGY_ACTION = 0;

/* Perform Updates */
MERGE INTO DB_T_CORE_MEMBXREF_PROD.SMLNPOLS
USING (select * from upd_SMLNPOLS_EXPIRED_POLS ) upd_SMLNPOLS_EXPIRED_POLS  ON (UPDATE_STRATEGY_ACTION = 1 and DB_T_CORE_MEMBXREF_PROD.SMLNPOLS.SC_POLICY_NUM = upd_SMLNPOLS_EXPIRED_POLS.SC_POLICY_NUM and DB_T_CORE_MEMBXREF_PROD.SMLNPOLS.CHG_EFF_DT = upd_SMLNPOLS_EXPIRED_POLS.CHG_EFF_DT)
WHEN MATCHED THEN UPDATE
SET
SC_POLICY_NUM = upd_SMLNPOLS_EXPIRED_POLS.SC_POLICY_NUM,
CHG_EFF_DT = upd_SMLNPOLS_EXPIRED_POLS.CHG_EFF_DT,
CHG_EXP_DT = upd_SMLNPOLS_EXPIRED_POLS.out_CHG_EXP_DT_new,
ECTL_BATCH_ID = upd_SMLNPOLS_EXPIRED_POLS.out_ECTL_BATCH_ID,
ECTL_MODIFY_TS = upd_SMLNPOLS_EXPIRED_POLS.out_ORIG_INS_TS,
ECTL_TX_CD = upd_SMLNPOLS_EXPIRED_POLS.ECTL_TX_CD,
ECTL_END_DATE = upd_SMLNPOLS_EXPIRED_POLS.ECTL_END_DATE
;


-- PIPELINE END FOR 1

-- PIPELINE START FOR 2

-- Component sq_STG_SMLNPOLS, Type SOURCE 
CREATE OR REPLACE TEMPORARY TABLE sq_STG_SMLNPOLS AS
(
SELECT /* adding column aliases to ensure proper downstream column references */
$1 as SC_DWNLD_PRIORITY,
$2 as SC_SERVICE_CENTER,
$3 as SC_POLICY_NUM,
$4 as SC_FLT_ITEM,
$5 as SC_FILE_TYPE,
$6 as SC_REC_TRANS_CODE,
$7 as SC_TRANS_DATE,
$8 as SC_TRANS_TYPE,
$9 as PC_ALPHA_CODE,
$10 as PC_NAME_1,
$11 as PC_NAME_2,
$12 as PC_ADDRESS_1,
$13 as PC_ADDRESS_2,
$14 as PC_CITYST,
$15 as PC_ZIP,
$16 as PC_TAX_CODE,
$17 as PC_AGENT,
$18 as PC_MEMBER_NUMBER,
$19 as PC_RATE_CODE,
$20 as PC_ENCUMBRANCE,
$21 as PC_PREM_FIN,
$22 as PC_MORT_IND,
$23 as PC_COMPANY,
$24 as PC_INCEPT_DATE,
$25 as PC_EXP_DATE,
$26 as PC_EFF_DATE,
$27 as PC_STATUS,
$28 as SMLN_TOT_PREM,
$29 as SMLN_REWRITE_IND,
$30 as SMLN_REWRITE_DT,
$31 as SMLN_OUTST_AMT,
$32 as SMLN_OUTST_TYPE,
$33 as SMLN_OUTST_DATE,
$34 as SMLN_OUTST_PD_DATE,
$35 as SMLN_SUSPENSE_CD,
$36 as SMLN_SUSPENSE_CAN,
$37 as SMLN_SSN_1,
$38 as SMLN_SSN_2,
$39 as SMLN_UW_REVIEW_DT,
$40 as SMLN_UW_INITIALS,
$41 as SMLN_MORT_NAME_1,
$42 as SMLN_MORT_NAME_2,
$43 as SMLN_MORT_ADD_1,
$44 as SMLN_MORT_ADD_2,
$45 as SMLN_MORT_CTYST,
$46 as SMLN_MORT_ZIP,
$47 as SMLN_STATE,
$48 as SMLN_MORT_TYPE,
$49 as SMLN_CANC_CODE,
$50 as SMLN_SP5_ENDR_IND,
$51 as SMLN_LOAN_NUM,
$52 as SMLN_SLOAN_NUM,
$53 as SMLN_SMORT_NAME_1,
$54 as SMLN_SMORT_NAME_2,
$55 as SMLN_SMORT_ADD_1,
$56 as SMLN_SMORT_ADD_2,
$57 as SMLN_SMORT_CTYST,
$58 as SMLN_SMORT_ZIP,
$59 as SMLN_SMORT_TYPE,
$60 as SMLN_PREMIUM_1,
$61 as SMLN_PREMIUM_2,
$62 as SMLN_PREMIUM_3,
$63 as SMLN_PREMIUM_4,
$64 as SMLN_PREMIUM_5,
$65 as SMLN_PREMIUM_6,
$66 as SMLN_PREMIUM_7,
$67 as SMLN_COVERAGE_1,
$68 as SMLN_COVERAGE_2,
$69 as SMLN_COVERAGE_3,
$70 as SMLN_COVERAGE_4,
$71 as SMLN_COVERAGE_5,
$72 as SMLN_COVERAGE_6,
$73 as SMLN_COVERAGE_7,
$74 as SMLN_COVERAGE_8,
$75 as SMLN_T_MODEL_YEAR,
$76 as SMLN_T_MAKE,
$77 as SMLN_T_OCCUPANCY,
$78 as SMLN_T_UNDERPIN,
$79 as SMLN_T_CLASS,
$80 as SMLN_POL_TYPE,
$81 as SMLN_SP_BT_CLASS,
$82 as SMLN_FC_NUM_ACRES,
$83 as SMLN_FC_NUM_EMP,
$84 as SMLN_FC_PAYROLL,
$85 as SMLN_FC_CUST_FARM,
$86 as SMLN_FC_ADD_PREM,
$87 as SMLN_FC_RES_MAINT,
$88 as SMLN_FC_ADD_INSRD,
$89 as SMLN_FC_ADD_RENT,
$90 as SMLN_DEDUCTIBLE,
$91 as SMLN_HALF_TERM_BP,
$92 as SMLN_FULL_TERM_BP,
$93 as SMLN_TRANSFER_DATE,
$94 as SMLN_MB_TYPE,
$95 as SMLN_MB_ACCT_NUM,
$96 as SMLN_SC_LIAB_PRD_I,
$97 as SMLN_GL_COV_TYPE,
$98 as LOAD_DT,
$99 as FEED_IND,
$100 as source_record_id
FROM (
SELECT SRC.*, row_number() over (order by 1) AS source_record_id FROM (
SELECT 
STG_SMLNPOLS.SC_DWNLD_PRIORITY, 
STG_SMLNPOLS.SC_SERVICE_CENTER, 
LTRIM(RTRIM(STG_SMLNPOLS.SC_POLICY_NUM)),
LTRIM(RTRIM(STG_SMLNPOLS.SC_FLT_ITEM)), 
STG_SMLNPOLS.SC_FILE_TYPE, 
STG_SMLNPOLS.SC_REC_TRANS_CODE,
STG_SMLNPOLS.SC_TRANS_DATE,
STG_SMLNPOLS.SC_TRANS_TYPE,
LTRIM(RTRIM(STG_SMLNPOLS.PC_ALPHA_CODE)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_NAME_1)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_NAME_2)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_ADDRESS_1)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_ADDRESS_2)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_CITYST)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_ZIP)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_TAX_CODE)),
STG_SMLNPOLS.PC_AGENT,
LTRIM(RTRIM(STG_SMLNPOLS.PC_MEMBER_NUMBER)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_RATE_CODE)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_ENCUMBRANCE)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_PREM_FIN)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_MORT_IND)),
LTRIM(RTRIM(STG_SMLNPOLS.PC_COMPANY)),
STG_SMLNPOLS.PC_INCEPT_DATE,
STG_SMLNPOLS.PC_EXP_DATE,
STG_SMLNPOLS.PC_EFF_DATE,
LTRIM(RTRIM(STG_SMLNPOLS.PC_STATUS)),
STG_SMLNPOLS.SMLN_TOT_PREM,
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_REWRITE_IND)),
STG_SMLNPOLS.SMLN_REWRITE_DT,
STG_SMLNPOLS.SMLN_OUTST_AMT,
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_OUTST_TYPE)),
STG_SMLNPOLS.SMLN_OUTST_DATE,
STG_SMLNPOLS.SMLN_OUTST_PD_DATE,
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SUSPENSE_CD)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SUSPENSE_CAN)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SSN_1)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SSN_2)),
STG_SMLNPOLS.SMLN_UW_REVIEW_DT,
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_UW_INITIALS)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_MORT_NAME_1)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_MORT_NAME_2)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_MORT_ADD_1)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_MORT_ADD_2)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_MORT_CTYST)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_MORT_ZIP)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_STATE)),
STG_SMLNPOLS.SMLN_MORT_TYPE,
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_CANC_CODE)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SP5_ENDR_IND)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_LOAN_NUM)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SLOAN_NUM)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SMORT_NAME_1)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SMORT_NAME_2)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SMORT_ADD_1)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SMORT_ADD_2)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SMORT_CTYST)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SMORT_ZIP)),
STG_SMLNPOLS.SMLN_SMORT_TYPE,
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_PREMIUM_1)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_PREMIUM_2)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_PREMIUM_3)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_PREMIUM_4)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_PREMIUM_5)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_PREMIUM_6)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_PREMIUM_7)),
STG_SMLNPOLS.SMLN_COVERAGE_1,
STG_SMLNPOLS.SMLN_COVERAGE_2,
STG_SMLNPOLS.SMLN_COVERAGE_3,
STG_SMLNPOLS.SMLN_COVERAGE_4,
STG_SMLNPOLS.SMLN_COVERAGE_5,
STG_SMLNPOLS.SMLN_COVERAGE_6,
STG_SMLNPOLS.SMLN_COVERAGE_7,
STG_SMLNPOLS.SMLN_COVERAGE_8,
STG_SMLNPOLS.SMLN_T_MODEL_YEAR,
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_T_MAKE)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_T_OCCUPANCY)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_T_UNDERPIN)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_T_CLASS)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_POL_TYPE)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SP_BT_CLASS)),
STG_SMLNPOLS.SMLN_FC_NUM_ACRES,
STG_SMLNPOLS.SMLN_FC_NUM_EMP,
STG_SMLNPOLS.SMLN_FC_PAYROLL,
STG_SMLNPOLS.SMLN_FC_CUST_FARM,
STG_SMLNPOLS.SMLN_FC_ADD_PREM,
STG_SMLNPOLS.SMLN_FC_RES_MAINT,
STG_SMLNPOLS.SMLN_FC_ADD_INSRD,
STG_SMLNPOLS.SMLN_FC_ADD_RENT,
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_DEDUCTIBLE)),
STG_SMLNPOLS.SMLN_HALF_TERM_BP,
STG_SMLNPOLS.SMLN_FULL_TERM_BP,
STG_SMLNPOLS.SMLN_TRANSFER_DATE,
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_MB_TYPE)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_MB_ACCT_NUM)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_SC_LIAB_PRD_I)),
LTRIM(RTRIM(STG_SMLNPOLS.SMLN_GL_COV_TYPE)),
STG_SMLNPOLS.LOAD_DT,
STG_SMLNPOLS.FEED_IND
FROM DB_T_STAG_MEMBXREF_PROD.STG_SMLNPOLS where  LOAD_DT=(SELECT FEED_DT FROM DB_T_STAG_MEMBXREF_PROD.STG_MEMBXREF_TRIGGER WHERE TABLENAME=''SMLNPOLS'') 
) SRC
)
);


-- Component exp_HOLD_DATA, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_HOLD_DATA AS
(
SELECT
sq_STG_SMLNPOLS.SC_DWNLD_PRIORITY as SC_DWNLD_PRIORITY,
sq_STG_SMLNPOLS.SC_SERVICE_CENTER as SC_SERVICE_CENTER,
sq_STG_SMLNPOLS.SC_POLICY_NUM as SC_POLICY_NUM,
sq_STG_SMLNPOLS.SC_FLT_ITEM as SC_FLT_ITEM,
sq_STG_SMLNPOLS.SC_FILE_TYPE as SC_FILE_TYPE,
sq_STG_SMLNPOLS.SC_REC_TRANS_CODE as SC_REC_TRANS_CODE,
sq_STG_SMLNPOLS.SC_TRANS_DATE as SC_TRANS_DATE,
sq_STG_SMLNPOLS.SC_TRANS_TYPE as SC_TRANS_TYPE,
sq_STG_SMLNPOLS.PC_ALPHA_CODE as PC_ALPHA_CODE,
sq_STG_SMLNPOLS.PC_NAME_1 as PC_NAME_1,
sq_STG_SMLNPOLS.PC_NAME_2 as PC_NAME_2,
sq_STG_SMLNPOLS.PC_ADDRESS_1 as PC_ADDRESS_1,
sq_STG_SMLNPOLS.PC_ADDRESS_2 as PC_ADDRESS_2,
sq_STG_SMLNPOLS.PC_CITYST as PC_CITYST,
sq_STG_SMLNPOLS.PC_ZIP as PC_ZIP,
sq_STG_SMLNPOLS.PC_TAX_CODE as PC_TAX_CODE,
sq_STG_SMLNPOLS.PC_AGENT as PC_AGENT,
sq_STG_SMLNPOLS.PC_MEMBER_NUMBER as PC_MEMBER_NUMBER,
sq_STG_SMLNPOLS.PC_RATE_CODE as PC_RATE_CODE,
sq_STG_SMLNPOLS.PC_ENCUMBRANCE as PC_ENCUMBRANCE,
sq_STG_SMLNPOLS.PC_PREM_FIN as PC_PREM_FIN,
sq_STG_SMLNPOLS.PC_MORT_IND as PC_MORT_IND,
sq_STG_SMLNPOLS.PC_COMPANY as PC_COMPANY,
sq_STG_SMLNPOLS.PC_INCEPT_DATE as PC_INCEPT_DATE,
sq_STG_SMLNPOLS.PC_EXP_DATE as PC_EXP_DATE,
sq_STG_SMLNPOLS.PC_EFF_DATE as PC_EFF_DATE,
sq_STG_SMLNPOLS.PC_STATUS as PC_STATUS,
sq_STG_SMLNPOLS.SMLN_TOT_PREM as SMLN_TOT_PREM,
sq_STG_SMLNPOLS.SMLN_REWRITE_IND as SMLN_REWRITE_IND,
sq_STG_SMLNPOLS.SMLN_REWRITE_DT as SMLN_REWRITE_DT,
sq_STG_SMLNPOLS.SMLN_OUTST_AMT as SMLN_OUTST_AMT,
sq_STG_SMLNPOLS.SMLN_OUTST_TYPE as SMLN_OUTST_TYPE,
sq_STG_SMLNPOLS.SMLN_OUTST_DATE as SMLN_OUTST_DATE,
sq_STG_SMLNPOLS.SMLN_OUTST_PD_DATE as SMLN_OUTST_PD_DATE,
sq_STG_SMLNPOLS.SMLN_SUSPENSE_CD as SMLN_SUSPENSE_CD,
sq_STG_SMLNPOLS.SMLN_SUSPENSE_CAN as SMLN_SUSPENSE_CAN,
sq_STG_SMLNPOLS.SMLN_SSN_1 as SMLN_SSN_1,
sq_STG_SMLNPOLS.SMLN_SSN_2 as SMLN_SSN_2,
sq_STG_SMLNPOLS.SMLN_UW_REVIEW_DT as SMLN_UW_REVIEW_DT,
sq_STG_SMLNPOLS.SMLN_UW_INITIALS as SMLN_UW_INITIALS,
sq_STG_SMLNPOLS.SMLN_MORT_NAME_1 as SMLN_MORT_NAME_1,
sq_STG_SMLNPOLS.SMLN_MORT_NAME_2 as SMLN_MORT_NAME_2,
sq_STG_SMLNPOLS.SMLN_MORT_ADD_1 as SMLN_MORT_ADD_1,
sq_STG_SMLNPOLS.SMLN_MORT_ADD_2 as SMLN_MORT_ADD_2,
sq_STG_SMLNPOLS.SMLN_MORT_CTYST as SMLN_MORT_CTYST,
sq_STG_SMLNPOLS.SMLN_MORT_ZIP as SMLN_MORT_ZIP,
sq_STG_SMLNPOLS.SMLN_STATE as SMLN_STATE,
sq_STG_SMLNPOLS.SMLN_MORT_TYPE as SMLN_MORT_TYPE,
sq_STG_SMLNPOLS.SMLN_CANC_CODE as SMLN_CANC_CODE,
sq_STG_SMLNPOLS.SMLN_SP5_ENDR_IND as SMLN_SP5_ENDR_IND,
sq_STG_SMLNPOLS.SMLN_LOAN_NUM as SMLN_LOAN_NUM,
sq_STG_SMLNPOLS.SMLN_SLOAN_NUM as SMLN_SLOAN_NUM,
sq_STG_SMLNPOLS.SMLN_SMORT_NAME_1 as SMLN_SMORT_NAME_1,
sq_STG_SMLNPOLS.SMLN_SMORT_NAME_2 as SMLN_SMORT_NAME_2,
sq_STG_SMLNPOLS.SMLN_SMORT_ADD_1 as SMLN_SMORT_ADD_1,
sq_STG_SMLNPOLS.SMLN_SMORT_ADD_2 as SMLN_SMORT_ADD_2,
sq_STG_SMLNPOLS.SMLN_SMORT_CTYST as SMLN_SMORT_CTYST,
sq_STG_SMLNPOLS.SMLN_SMORT_ZIP as SMLN_SMORT_ZIP,
sq_STG_SMLNPOLS.SMLN_SMORT_TYPE as SMLN_SMORT_TYPE,
sq_STG_SMLNPOLS.SMLN_PREMIUM_1 as SMLN_PREMIUM_1,
sq_STG_SMLNPOLS.SMLN_PREMIUM_2 as SMLN_PREMIUM_2,
sq_STG_SMLNPOLS.SMLN_PREMIUM_3 as SMLN_PREMIUM_3,
sq_STG_SMLNPOLS.SMLN_PREMIUM_4 as SMLN_PREMIUM_4,
sq_STG_SMLNPOLS.SMLN_PREMIUM_5 as SMLN_PREMIUM_5,
sq_STG_SMLNPOLS.SMLN_PREMIUM_6 as SMLN_PREMIUM_6,
sq_STG_SMLNPOLS.SMLN_PREMIUM_7 as SMLN_PREMIUM_7,
sq_STG_SMLNPOLS.SMLN_COVERAGE_1 as SMLN_COVERAGE_1,
sq_STG_SMLNPOLS.SMLN_COVERAGE_2 as SMLN_COVERAGE_2,
sq_STG_SMLNPOLS.SMLN_COVERAGE_3 as SMLN_COVERAGE_3,
sq_STG_SMLNPOLS.SMLN_COVERAGE_4 as SMLN_COVERAGE_4,
sq_STG_SMLNPOLS.SMLN_COVERAGE_5 as SMLN_COVERAGE_5,
sq_STG_SMLNPOLS.SMLN_COVERAGE_6 as SMLN_COVERAGE_6,
sq_STG_SMLNPOLS.SMLN_COVERAGE_7 as SMLN_COVERAGE_7,
sq_STG_SMLNPOLS.SMLN_COVERAGE_8 as SMLN_COVERAGE_8,
sq_STG_SMLNPOLS.SMLN_T_MODEL_YEAR as SMLN_T_MODEL_YEAR,
sq_STG_SMLNPOLS.SMLN_T_MAKE as SMLN_T_MAKE,
sq_STG_SMLNPOLS.SMLN_T_OCCUPANCY as SMLN_T_OCCUPANCY,
sq_STG_SMLNPOLS.SMLN_T_UNDERPIN as SMLN_T_UNDERPIN,
sq_STG_SMLNPOLS.SMLN_T_CLASS as SMLN_T_CLASS,
sq_STG_SMLNPOLS.SMLN_POL_TYPE as SMLN_POL_TYPE,
sq_STG_SMLNPOLS.SMLN_SP_BT_CLASS as SMLN_SP_BT_CLASS,
sq_STG_SMLNPOLS.SMLN_FC_NUM_ACRES as SMLN_FC_NUM_ACRES,
sq_STG_SMLNPOLS.SMLN_FC_NUM_EMP as SMLN_FC_NUM_EMP,
sq_STG_SMLNPOLS.SMLN_FC_PAYROLL as SMLN_FC_PAYROLL,
sq_STG_SMLNPOLS.SMLN_FC_CUST_FARM as SMLN_FC_CUST_FARM,
sq_STG_SMLNPOLS.SMLN_FC_ADD_PREM as SMLN_FC_ADD_PREM,
sq_STG_SMLNPOLS.SMLN_FC_RES_MAINT as SMLN_FC_RES_MAINT,
sq_STG_SMLNPOLS.SMLN_FC_ADD_INSRD as SMLN_FC_ADD_INSRD,
sq_STG_SMLNPOLS.SMLN_FC_ADD_RENT as SMLN_FC_ADD_RENT,
sq_STG_SMLNPOLS.SMLN_DEDUCTIBLE as SMLN_DEDUCTIBLE,
sq_STG_SMLNPOLS.SMLN_HALF_TERM_BP as SMLN_HALF_TERM_BP,
sq_STG_SMLNPOLS.SMLN_FULL_TERM_BP as SMLN_FULL_TERM_BP,
sq_STG_SMLNPOLS.SMLN_TRANSFER_DATE as SMLN_TRANSFER_DATE,
sq_STG_SMLNPOLS.SMLN_MB_TYPE as SMLN_MB_TYPE,
sq_STG_SMLNPOLS.SMLN_MB_ACCT_NUM as SMLN_MB_ACCT_NUM,
sq_STG_SMLNPOLS.SMLN_SC_LIAB_PRD_I as SMLN_SC_LIAB_PRD_I,
sq_STG_SMLNPOLS.SMLN_GL_COV_TYPE as SMLN_GL_COV_TYPE,
sq_STG_SMLNPOLS.LOAD_DT as LOAD_DT,
sq_STG_SMLNPOLS.FEED_IND as FEED_IND,
sq_STG_SMLNPOLS.source_record_id
FROM
sq_STG_SMLNPOLS
);


-- Component LKP_SMLNPOLS, Type LOOKUP 
CREATE OR REPLACE TEMPORARY TABLE LKP_SMLNPOLS AS
(
SELECT
LKP.SC_DWNLD_PRIORITY,
LKP.SC_SERVICE_CENTER,
LKP.SC_POLICY_NUM,
LKP.CHG_EFF_DT,
LKP.CHG_EXP_DT,
LKP.SC_FLT_ITEM,
LKP.SC_FILE_TYPE,
LKP.SC_REC_TRANS_CODE,
LKP.SC_TRANS_DATE,
LKP.SC_TRANS_TYPE,
LKP.PC_ALPHA_CODE,
LKP.PC_NAME_1,
LKP.PC_NAME_2,
LKP.PC_ADDRESS_1,
LKP.PC_ADDRESS_2,
LKP.PC_CITYST,
LKP.PC_ZIP,
LKP.PC_TAX_CODE,
LKP.PC_AGENT,
LKP.PC_MEMBER_NUMBER,
LKP.PC_RATE_CODE,
LKP.PC_ENCUMBRANCE,
LKP.PC_PREM_FIN,
LKP.PC_MORT_IND,
LKP.PC_COMPANY,
LKP.PC_INCEPT_DATE,
LKP.PC_EXP_DATE,
LKP.PC_EFF_DATE,
LKP.PC_STATUS,
LKP.SMLN_TOT_PREM,
LKP.SMLN_REWRITE_IND,
LKP.SMLN_REWRITE_DT,
LKP.SMLN_OUTST_AMT,
LKP.SMLN_OUTST_TYPE,
LKP.SMLN_OUTST_DATE,
LKP.SMLN_OUTST_PD_DATE,
LKP.SMLN_SUSPENSE_CD,
LKP.SMLN_SUSPENSE_CAN,
LKP.SMLN_SSN_1,
LKP.SMLN_SSN_2,
LKP.SMLN_UW_REVIEW_DT,
LKP.SMLN_UW_INITIALS,
LKP.SMLN_MORT_NAME_1,
LKP.SMLN_MORT_NAME_2,
LKP.SMLN_MORT_ADD_1,
LKP.SMLN_MORT_ADD_2,
LKP.SMLN_MORT_CTYST,
LKP.SMLN_MORT_ZIP,
LKP.SMLN_STATE,
LKP.SMLN_MORT_TYPE,
LKP.SMLN_CANC_CODE,
LKP.SMLN_SP5_ENDR_IND,
LKP.SMLN_LOAN_NUM,
LKP.SMLN_SLOAN_NUM,
LKP.SMLN_SMORT_NAME_1,
LKP.SMLN_SMORT_NAME_2,
LKP.SMLN_SMORT_ADD_1,
LKP.SMLN_SMORT_ADD_2,
LKP.SMLN_SMORT_CTYST,
LKP.SMLN_SMORT_ZIP,
LKP.SMLN_SMORT_TYPE,
LKP.SMLN_PREMIUM_1,
LKP.SMLN_PREMIUM_2,
LKP.SMLN_PREMIUM_3,
LKP.SMLN_PREMIUM_4,
LKP.SMLN_PREMIUM_5,
LKP.SMLN_PREMIUM_6,
LKP.SMLN_PREMIUM_7,
LKP.SMLN_COVERAGE_1,
LKP.SMLN_COVERAGE_2,
LKP.SMLN_COVERAGE_3,
LKP.SMLN_COVERAGE_4,
LKP.SMLN_COVERAGE_5,
LKP.SMLN_COVERAGE_6,
LKP.SMLN_COVERAGE_7,
LKP.SMLN_COVERAGE_8,
LKP.SMLN_T_MODEL_YEAR,
LKP.SMLN_T_MAKE,
LKP.SMLN_T_OCCUPANCY,
LKP.SMLN_T_UNDERPIN,
LKP.SMLN_T_CLASS,
LKP.SMLN_POL_TYPE,
LKP.SMLN_SP_BT_CLASS,
LKP.SMLN_FC_NUM_ACRES,
LKP.SMLN_FC_NUM_EMP,
LKP.SMLN_FC_PAYROLL,
LKP.SMLN_FC_CUST_FARM,
LKP.SMLN_FC_ADD_PREM,
LKP.SMLN_FC_RES_MAINT,
LKP.SMLN_FC_ADD_INSRD,
LKP.SMLN_FC_ADD_RENT,
LKP.SMLN_DEDUCTIBLE,
LKP.SMLN_HALF_TERM_BP,
LKP.SMLN_FULL_TERM_BP,
LKP.SMLN_TRANSFER_DATE,
LKP.SMLN_MB_TYPE,
LKP.SMLN_MB_ACCT_NUM,
LKP.SMLN_SC_LIAB_PRD_I,
LKP.SMLN_GL_COV_TYPE,
LKP.FEED_IND,
exp_HOLD_DATA.source_record_id,
ROW_NUMBER() OVER(PARTITION BY exp_HOLD_DATA.source_record_id ORDER BY LKP.SC_DWNLD_PRIORITY asc,LKP.SC_SERVICE_CENTER asc,LKP.SC_POLICY_NUM asc,LKP.CHG_EFF_DT asc,LKP.CHG_EXP_DT asc,LKP.SC_FLT_ITEM asc,LKP.SC_FILE_TYPE asc,LKP.SC_REC_TRANS_CODE asc,LKP.SC_TRANS_DATE asc,LKP.SC_TRANS_TYPE asc,LKP.PC_ALPHA_CODE asc,LKP.PC_NAME_1 asc,LKP.PC_NAME_2 asc,LKP.PC_ADDRESS_1 asc,LKP.PC_ADDRESS_2 asc,LKP.PC_CITYST asc,LKP.PC_ZIP asc,LKP.PC_TAX_CODE asc,LKP.PC_AGENT asc,LKP.PC_MEMBER_NUMBER asc,LKP.PC_RATE_CODE asc,LKP.PC_ENCUMBRANCE asc,LKP.PC_PREM_FIN asc,LKP.PC_MORT_IND asc,LKP.PC_COMPANY asc,LKP.PC_INCEPT_DATE asc,LKP.PC_EXP_DATE asc,LKP.PC_EFF_DATE asc,LKP.PC_STATUS asc,LKP.SMLN_TOT_PREM asc,LKP.SMLN_REWRITE_IND asc,LKP.SMLN_REWRITE_DT asc,LKP.SMLN_OUTST_AMT asc,LKP.SMLN_OUTST_TYPE asc,LKP.SMLN_OUTST_DATE asc,LKP.SMLN_OUTST_PD_DATE asc,LKP.SMLN_SUSPENSE_CD asc,LKP.SMLN_SUSPENSE_CAN asc,LKP.SMLN_SSN_1 asc,LKP.SMLN_SSN_2 asc,LKP.SMLN_UW_REVIEW_DT asc,LKP.SMLN_UW_INITIALS asc,LKP.SMLN_MORT_NAME_1 asc,LKP.SMLN_MORT_NAME_2 asc,LKP.SMLN_MORT_ADD_1 asc,LKP.SMLN_MORT_ADD_2 asc,LKP.SMLN_MORT_CTYST asc,LKP.SMLN_MORT_ZIP asc,LKP.SMLN_STATE asc,LKP.SMLN_MORT_TYPE asc,LKP.SMLN_CANC_CODE asc,LKP.SMLN_SP5_ENDR_IND asc,LKP.SMLN_LOAN_NUM asc,LKP.SMLN_SLOAN_NUM asc,LKP.SMLN_SMORT_NAME_1 asc,LKP.SMLN_SMORT_NAME_2 asc,LKP.SMLN_SMORT_ADD_1 asc,LKP.SMLN_SMORT_ADD_2 asc,LKP.SMLN_SMORT_CTYST asc,LKP.SMLN_SMORT_ZIP asc,LKP.SMLN_SMORT_TYPE asc,LKP.SMLN_PREMIUM_1 asc,LKP.SMLN_PREMIUM_2 asc,LKP.SMLN_PREMIUM_3 asc,LKP.SMLN_PREMIUM_4 asc,LKP.SMLN_PREMIUM_5 asc,LKP.SMLN_PREMIUM_6 asc,LKP.SMLN_PREMIUM_7 asc,LKP.SMLN_COVERAGE_1 asc,LKP.SMLN_COVERAGE_2 asc,LKP.SMLN_COVERAGE_3 asc,LKP.SMLN_COVERAGE_4 asc,LKP.SMLN_COVERAGE_5 asc,LKP.SMLN_COVERAGE_6 asc,LKP.SMLN_COVERAGE_7 asc,LKP.SMLN_COVERAGE_8 asc,LKP.SMLN_T_MODEL_YEAR asc,LKP.SMLN_T_MAKE asc,LKP.SMLN_T_OCCUPANCY asc,LKP.SMLN_T_UNDERPIN asc,LKP.SMLN_T_CLASS asc,LKP.SMLN_POL_TYPE asc,LKP.SMLN_SP_BT_CLASS asc,LKP.SMLN_FC_NUM_ACRES asc,LKP.SMLN_FC_NUM_EMP asc,LKP.SMLN_FC_PAYROLL asc,LKP.SMLN_FC_CUST_FARM asc,LKP.SMLN_FC_ADD_PREM asc,LKP.SMLN_FC_RES_MAINT asc,LKP.SMLN_FC_ADD_INSRD asc,LKP.SMLN_FC_ADD_RENT asc,LKP.SMLN_DEDUCTIBLE asc,LKP.SMLN_HALF_TERM_BP asc,LKP.SMLN_FULL_TERM_BP asc,LKP.SMLN_TRANSFER_DATE asc,LKP.SMLN_MB_TYPE asc,LKP.SMLN_MB_ACCT_NUM asc,LKP.SMLN_SC_LIAB_PRD_I asc,LKP.SMLN_GL_COV_TYPE asc,LKP.FEED_IND asc) RNK
FROM
(select * from exp_HOLD_DATA ) exp_HOLD_DATA
LEFT JOIN (
SELECT SMLNPOLS.SC_DWNLD_PRIORITY as SC_DWNLD_PRIORITY, SMLNPOLS.SC_SERVICE_CENTER as SC_SERVICE_CENTER, SMLNPOLS.SC_POLICY_NUM as SC_POLICY_NUM,SMLNPOLS.CHG_EFF_DT as CHG_EFF_DT, SMLNPOLS.CHG_EXP_DT as CHG_EXP_DT, SMLNPOLS.SC_FLT_ITEM as SC_FLT_ITEM, SMLNPOLS.SC_FILE_TYPE as SC_FILE_TYPE, SMLNPOLS.SC_REC_TRANS_CODE as SC_REC_TRANS_CODE, SMLNPOLS.SC_TRANS_DATE as SC_TRANS_DATE, SMLNPOLS.SC_TRANS_TYPE as SC_TRANS_TYPE, SMLNPOLS.PC_ALPHA_CODE as PC_ALPHA_CODE, SMLNPOLS.PC_NAME_1 as PC_NAME_1, SMLNPOLS.PC_NAME_2 as PC_NAME_2, SMLNPOLS.PC_ADDRESS_1 as PC_ADDRESS_1, SMLNPOLS.PC_ADDRESS_2 as PC_ADDRESS_2, SMLNPOLS.PC_CITYST as PC_CITYST, SMLNPOLS.PC_ZIP as PC_ZIP, SMLNPOLS.PC_TAX_CODE as PC_TAX_CODE, SMLNPOLS.PC_AGENT as PC_AGENT, SMLNPOLS.PC_MEMBER_NUMBER as PC_MEMBER_NUMBER, SMLNPOLS.PC_RATE_CODE as PC_RATE_CODE, SMLNPOLS.PC_ENCUMBRANCE as PC_ENCUMBRANCE, SMLNPOLS.PC_PREM_FIN as PC_PREM_FIN, SMLNPOLS.PC_MORT_IND as PC_MORT_IND, SMLNPOLS.PC_COMPANY as PC_COMPANY, SMLNPOLS.PC_INCEPT_DATE as PC_INCEPT_DATE, SMLNPOLS.PC_EXP_DATE as PC_EXP_DATE, SMLNPOLS.PC_EFF_DATE as PC_EFF_DATE, SMLNPOLS.PC_STATUS as PC_STATUS, SMLNPOLS.SMLN_TOT_PREM as SMLN_TOT_PREM, SMLNPOLS.SMLN_REWRITE_IND as SMLN_REWRITE_IND, SMLNPOLS.SMLN_REWRITE_DT as SMLN_REWRITE_DT, SMLNPOLS.SMLN_OUTST_AMT as SMLN_OUTST_AMT, SMLNPOLS.SMLN_OUTST_TYPE as SMLN_OUTST_TYPE, SMLNPOLS.SMLN_OUTST_DATE as SMLN_OUTST_DATE, SMLNPOLS.SMLN_OUTST_PD_DATE as SMLN_OUTST_PD_DATE, SMLNPOLS.SMLN_SUSPENSE_CD as SMLN_SUSPENSE_CD, SMLNPOLS.SMLN_SUSPENSE_CAN as SMLN_SUSPENSE_CAN, SMLNPOLS.SMLN_SSN_1 as SMLN_SSN_1, SMLNPOLS.SMLN_SSN_2 as SMLN_SSN_2, SMLNPOLS.SMLN_UW_REVIEW_DT as SMLN_UW_REVIEW_DT, SMLNPOLS.SMLN_UW_INITIALS as SMLN_UW_INITIALS, SMLNPOLS.SMLN_MORT_NAME_1 as SMLN_MORT_NAME_1, SMLNPOLS.SMLN_MORT_NAME_2 as SMLN_MORT_NAME_2, SMLNPOLS.SMLN_MORT_ADD_1 as SMLN_MORT_ADD_1, SMLNPOLS.SMLN_MORT_ADD_2 as SMLN_MORT_ADD_2, SMLNPOLS.SMLN_MORT_CTYST as SMLN_MORT_CTYST, SMLNPOLS.SMLN_MORT_ZIP as SMLN_MORT_ZIP, SMLNPOLS.SMLN_STATE as SMLN_STATE, SMLNPOLS.SMLN_MORT_TYPE as SMLN_MORT_TYPE, SMLNPOLS.SMLN_CANC_CODE as SMLN_CANC_CODE, SMLNPOLS.SMLN_SP5_ENDR_IND as SMLN_SP5_ENDR_IND, SMLNPOLS.SMLN_LOAN_NUM as SMLN_LOAN_NUM, SMLNPOLS.SMLN_SLOAN_NUM as SMLN_SLOAN_NUM, SMLNPOLS.SMLN_SMORT_NAME_1 as SMLN_SMORT_NAME_1, SMLNPOLS.SMLN_SMORT_NAME_2 as SMLN_SMORT_NAME_2, SMLNPOLS.SMLN_SMORT_ADD_1 as SMLN_SMORT_ADD_1, SMLNPOLS.SMLN_SMORT_ADD_2 as SMLN_SMORT_ADD_2, SMLNPOLS.SMLN_SMORT_CTYST as SMLN_SMORT_CTYST, SMLNPOLS.SMLN_SMORT_ZIP as SMLN_SMORT_ZIP, SMLNPOLS.SMLN_SMORT_TYPE as SMLN_SMORT_TYPE, SMLNPOLS.SMLN_PREMIUM_1 as SMLN_PREMIUM_1, SMLNPOLS.SMLN_PREMIUM_2 as SMLN_PREMIUM_2, SMLNPOLS.SMLN_PREMIUM_3 as SMLN_PREMIUM_3, SMLNPOLS.SMLN_PREMIUM_4 as SMLN_PREMIUM_4, SMLNPOLS.SMLN_PREMIUM_5 as SMLN_PREMIUM_5, SMLNPOLS.SMLN_PREMIUM_6 as SMLN_PREMIUM_6, SMLNPOLS.SMLN_PREMIUM_7 as SMLN_PREMIUM_7, SMLNPOLS.SMLN_COVERAGE_1 as SMLN_COVERAGE_1, SMLNPOLS.SMLN_COVERAGE_2 as SMLN_COVERAGE_2, SMLNPOLS.SMLN_COVERAGE_3 as SMLN_COVERAGE_3, SMLNPOLS.SMLN_COVERAGE_4 as SMLN_COVERAGE_4, SMLNPOLS.SMLN_COVERAGE_5 as SMLN_COVERAGE_5, SMLNPOLS.SMLN_COVERAGE_6 as SMLN_COVERAGE_6, SMLNPOLS.SMLN_COVERAGE_7 as SMLN_COVERAGE_7, SMLNPOLS.SMLN_COVERAGE_8 as SMLN_COVERAGE_8, SMLNPOLS.SMLN_T_MODEL_YEAR as SMLN_T_MODEL_YEAR, SMLNPOLS.SMLN_T_MAKE as SMLN_T_MAKE, SMLNPOLS.SMLN_T_OCCUPANCY as SMLN_T_OCCUPANCY, SMLNPOLS.SMLN_T_UNDERPIN as SMLN_T_UNDERPIN, SMLNPOLS.SMLN_T_CLASS as SMLN_T_CLASS, SMLNPOLS.SMLN_POL_TYPE as SMLN_POL_TYPE, SMLNPOLS.SMLN_SP_BT_CLASS as SMLN_SP_BT_CLASS, SMLNPOLS.SMLN_FC_NUM_ACRES as SMLN_FC_NUM_ACRES, SMLNPOLS.SMLN_FC_NUM_EMP as SMLN_FC_NUM_EMP, SMLNPOLS.SMLN_FC_PAYROLL as SMLN_FC_PAYROLL, SMLNPOLS.SMLN_FC_CUST_FARM as SMLN_FC_CUST_FARM, SMLNPOLS.SMLN_FC_ADD_PREM as SMLN_FC_ADD_PREM, SMLNPOLS.SMLN_FC_RES_MAINT as SMLN_FC_RES_MAINT, SMLNPOLS.SMLN_FC_ADD_INSRD as SMLN_FC_ADD_INSRD, SMLNPOLS.SMLN_FC_ADD_RENT as SMLN_FC_ADD_RENT, SMLNPOLS.SMLN_DEDUCTIBLE as SMLN_DEDUCTIBLE, SMLNPOLS.SMLN_HALF_TERM_BP as SMLN_HALF_TERM_BP, SMLNPOLS.SMLN_FULL_TERM_BP as SMLN_FULL_TERM_BP, SMLNPOLS.SMLN_TRANSFER_DATE as SMLN_TRANSFER_DATE, SMLNPOLS.SMLN_MB_TYPE as SMLN_MB_TYPE, SMLNPOLS.SMLN_MB_ACCT_NUM as SMLN_MB_ACCT_NUM, SMLNPOLS.SMLN_SC_LIAB_PRD_I as SMLN_SC_LIAB_PRD_I, SMLNPOLS.SMLN_GL_COV_TYPE as SMLN_GL_COV_TYPE, SMLNPOLS.FEED_IND as FEED_IND FROM DB_T_CORE_MEMBXREF_PROD.SMLNPOLS where ECTL_TX_CD=''NEW''
) LKP ON LKP.SC_POLICY_NUM = exp_HOLD_DATA.SC_POLICY_NUM
QUALIFY RNK = 1
);


-- Component exp_DERIVE_FLAG, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_DERIVE_FLAG AS
(
SELECT
LKP_SMLNPOLS.SC_POLICY_NUM as SC_POLICY_NUM_LKP,
LKP_SMLNPOLS.CHG_EFF_DT as CHG_EFF_DT_LKP,
exp_HOLD_DATA.SC_DWNLD_PRIORITY as SC_DWNLD_PRIORITY,
exp_HOLD_DATA.SC_SERVICE_CENTER as SC_SERVICE_CENTER,
exp_HOLD_DATA.SC_POLICY_NUM as SC_POLICY_NUM,
exp_HOLD_DATA.SC_FLT_ITEM as SC_FLT_ITEM,
exp_HOLD_DATA.SC_FILE_TYPE as SC_FILE_TYPE,
exp_HOLD_DATA.SC_REC_TRANS_CODE as SC_REC_TRANS_CODE,
exp_HOLD_DATA.SC_TRANS_DATE as SC_TRANS_DATE,
exp_HOLD_DATA.SC_TRANS_TYPE as SC_TRANS_TYPE,
exp_HOLD_DATA.PC_ALPHA_CODE as PC_ALPHA_CODE,
exp_HOLD_DATA.PC_NAME_1 as PC_NAME_1,
exp_HOLD_DATA.PC_NAME_2 as PC_NAME_2,
exp_HOLD_DATA.PC_ADDRESS_1 as PC_ADDRESS_1,
exp_HOLD_DATA.PC_ADDRESS_2 as PC_ADDRESS_2,
exp_HOLD_DATA.PC_CITYST as PC_CITYST,
exp_HOLD_DATA.PC_ZIP as PC_ZIP,
exp_HOLD_DATA.PC_TAX_CODE as PC_TAX_CODE,
exp_HOLD_DATA.PC_AGENT as PC_AGENT,
exp_HOLD_DATA.PC_MEMBER_NUMBER as PC_MEMBER_NUMBER,
exp_HOLD_DATA.PC_RATE_CODE as PC_RATE_CODE,
exp_HOLD_DATA.PC_ENCUMBRANCE as PC_ENCUMBRANCE,
exp_HOLD_DATA.PC_PREM_FIN as PC_PREM_FIN,
exp_HOLD_DATA.PC_MORT_IND as PC_MORT_IND,
exp_HOLD_DATA.PC_COMPANY as PC_COMPANY,
exp_HOLD_DATA.PC_INCEPT_DATE as PC_INCEPT_DATE,
exp_HOLD_DATA.PC_EXP_DATE as PC_EXP_DATE,
exp_HOLD_DATA.PC_EFF_DATE as PC_EFF_DATE,
exp_HOLD_DATA.PC_STATUS as PC_STATUS,
exp_HOLD_DATA.SMLN_TOT_PREM as SMLN_TOT_PREM,
exp_HOLD_DATA.SMLN_REWRITE_IND as SMLN_REWRITE_IND,
exp_HOLD_DATA.SMLN_REWRITE_DT as SMLN_REWRITE_DT,
exp_HOLD_DATA.SMLN_OUTST_AMT as SMLN_OUTST_AMT,
exp_HOLD_DATA.SMLN_OUTST_TYPE as SMLN_OUTST_TYPE,
exp_HOLD_DATA.SMLN_OUTST_DATE as SMLN_OUTST_DATE,
exp_HOLD_DATA.SMLN_OUTST_PD_DATE as SMLN_OUTST_PD_DATE,
exp_HOLD_DATA.SMLN_SUSPENSE_CD as SMLN_SUSPENSE_CD,
exp_HOLD_DATA.SMLN_SUSPENSE_CAN as SMLN_SUSPENSE_CAN,
exp_HOLD_DATA.SMLN_SSN_1 as SMLN_SSN_1,
exp_HOLD_DATA.SMLN_SSN_2 as SMLN_SSN_2,
exp_HOLD_DATA.SMLN_UW_REVIEW_DT as SMLN_UW_REVIEW_DT,
exp_HOLD_DATA.SMLN_UW_INITIALS as SMLN_UW_INITIALS,
exp_HOLD_DATA.SMLN_MORT_NAME_1 as SMLN_MORT_NAME_1,
exp_HOLD_DATA.SMLN_MORT_NAME_2 as SMLN_MORT_NAME_2,
exp_HOLD_DATA.SMLN_MORT_ADD_1 as SMLN_MORT_ADD_1,
exp_HOLD_DATA.SMLN_MORT_ADD_2 as SMLN_MORT_ADD_2,
exp_HOLD_DATA.SMLN_MORT_CTYST as SMLN_MORT_CTYST,
exp_HOLD_DATA.SMLN_MORT_ZIP as SMLN_MORT_ZIP,
exp_HOLD_DATA.SMLN_STATE as SMLN_STATE,
exp_HOLD_DATA.SMLN_MORT_TYPE as SMLN_MORT_TYPE,
exp_HOLD_DATA.SMLN_CANC_CODE as SMLN_CANC_CODE,
exp_HOLD_DATA.SMLN_SP5_ENDR_IND as SMLN_SP5_ENDR_IND,
exp_HOLD_DATA.SMLN_LOAN_NUM as SMLN_LOAN_NUM,
exp_HOLD_DATA.SMLN_SLOAN_NUM as SMLN_SLOAN_NUM,
exp_HOLD_DATA.SMLN_SMORT_NAME_1 as SMLN_SMORT_NAME_1,
exp_HOLD_DATA.SMLN_SMORT_NAME_2 as SMLN_SMORT_NAME_2,
exp_HOLD_DATA.SMLN_SMORT_ADD_1 as SMLN_SMORT_ADD_1,
exp_HOLD_DATA.SMLN_SMORT_ADD_2 as SMLN_SMORT_ADD_2,
exp_HOLD_DATA.SMLN_SMORT_CTYST as SMLN_SMORT_CTYST,
exp_HOLD_DATA.SMLN_SMORT_ZIP as SMLN_SMORT_ZIP,
exp_HOLD_DATA.SMLN_SMORT_TYPE as SMLN_SMORT_TYPE,
exp_HOLD_DATA.SMLN_PREMIUM_1 as SMLN_PREMIUM_1,
exp_HOLD_DATA.SMLN_PREMIUM_2 as SMLN_PREMIUM_2,
exp_HOLD_DATA.SMLN_PREMIUM_3 as SMLN_PREMIUM_3,
exp_HOLD_DATA.SMLN_PREMIUM_4 as SMLN_PREMIUM_4,
exp_HOLD_DATA.SMLN_PREMIUM_5 as SMLN_PREMIUM_5,
exp_HOLD_DATA.SMLN_PREMIUM_6 as SMLN_PREMIUM_6,
exp_HOLD_DATA.SMLN_PREMIUM_7 as SMLN_PREMIUM_7,
exp_HOLD_DATA.SMLN_COVERAGE_1 as SMLN_COVERAGE_1,
exp_HOLD_DATA.SMLN_COVERAGE_2 as SMLN_COVERAGE_2,
exp_HOLD_DATA.SMLN_COVERAGE_3 as SMLN_COVERAGE_3,
exp_HOLD_DATA.SMLN_COVERAGE_4 as SMLN_COVERAGE_4,
exp_HOLD_DATA.SMLN_COVERAGE_5 as SMLN_COVERAGE_5,
exp_HOLD_DATA.SMLN_COVERAGE_6 as SMLN_COVERAGE_6,
exp_HOLD_DATA.SMLN_COVERAGE_7 as SMLN_COVERAGE_7,
exp_HOLD_DATA.SMLN_COVERAGE_8 as SMLN_COVERAGE_8,
exp_HOLD_DATA.SMLN_T_MODEL_YEAR as SMLN_T_MODEL_YEAR,
exp_HOLD_DATA.SMLN_T_MAKE as SMLN_T_MAKE,
exp_HOLD_DATA.SMLN_T_OCCUPANCY as SMLN_T_OCCUPANCY,
exp_HOLD_DATA.SMLN_T_UNDERPIN as SMLN_T_UNDERPIN,
exp_HOLD_DATA.SMLN_T_CLASS as SMLN_T_CLASS,
exp_HOLD_DATA.SMLN_POL_TYPE as SMLN_POL_TYPE,
exp_HOLD_DATA.SMLN_SP_BT_CLASS as SMLN_SP_BT_CLASS,
exp_HOLD_DATA.SMLN_FC_NUM_ACRES as SMLN_FC_NUM_ACRES,
exp_HOLD_DATA.SMLN_FC_NUM_EMP as SMLN_FC_NUM_EMP,
exp_HOLD_DATA.SMLN_FC_PAYROLL as SMLN_FC_PAYROLL,
exp_HOLD_DATA.SMLN_FC_CUST_FARM as SMLN_FC_CUST_FARM,
exp_HOLD_DATA.SMLN_FC_ADD_PREM as SMLN_FC_ADD_PREM,
exp_HOLD_DATA.SMLN_FC_RES_MAINT as SMLN_FC_RES_MAINT,
exp_HOLD_DATA.SMLN_FC_ADD_INSRD as SMLN_FC_ADD_INSRD,
exp_HOLD_DATA.SMLN_FC_ADD_RENT as SMLN_FC_ADD_RENT,
exp_HOLD_DATA.SMLN_DEDUCTIBLE as SMLN_DEDUCTIBLE,
exp_HOLD_DATA.SMLN_HALF_TERM_BP as SMLN_HALF_TERM_BP,
exp_HOLD_DATA.SMLN_FULL_TERM_BP as SMLN_FULL_TERM_BP,
exp_HOLD_DATA.SMLN_TRANSFER_DATE as SMLN_TRANSFER_DATE,
exp_HOLD_DATA.SMLN_MB_TYPE as SMLN_MB_TYPE,
exp_HOLD_DATA.SMLN_MB_ACCT_NUM as SMLN_MB_ACCT_NUM,
exp_HOLD_DATA.SMLN_SC_LIAB_PRD_I as SMLN_SC_LIAB_PRD_I,
exp_HOLD_DATA.SMLN_GL_COV_TYPE as SMLN_GL_COV_TYPE,
exp_HOLD_DATA.LOAD_DT as LOAD_DT,
exp_HOLD_DATA.FEED_IND as FEED_IND,
LTRIM ( RTRIM ( :PMMappingName ) ) as out_PROJ_NAME,
:PROJ_ID as out_PROJ_ID,
:BATCH_ACTIVE_IND as out_BATCH_ACTV_IND,
CASE WHEN LKP_SMLNPOLS.SC_POLICY_NUM IS NULL THEN ''NEW'' ELSE CASE WHEN CASE WHEN LKP_SMLNPOLS.SC_DWNLD_PRIORITY IS NULL THEN 0 ELSE LKP_SMLNPOLS.SC_DWNLD_PRIORITY END <> CASE WHEN exp_HOLD_DATA.SC_DWNLD_PRIORITY IS NULL THEN 0 ELSE exp_HOLD_DATA.SC_DWNLD_PRIORITY END OR CASE WHEN LKP_SMLNPOLS.SC_SERVICE_CENTER IS NULL THEN 0 ELSE LKP_SMLNPOLS.SC_SERVICE_CENTER END <> CASE WHEN exp_HOLD_DATA.SC_SERVICE_CENTER IS NULL THEN 0 ELSE exp_HOLD_DATA.SC_SERVICE_CENTER END OR CASE WHEN LKP_SMLNPOLS.SC_FILE_TYPE IS NULL THEN 0 ELSE LKP_SMLNPOLS.SC_FILE_TYPE END <> CASE WHEN exp_HOLD_DATA.SC_FILE_TYPE IS NULL THEN 0 ELSE exp_HOLD_DATA.SC_FILE_TYPE END OR CASE WHEN LKP_SMLNPOLS.SC_REC_TRANS_CODE IS NULL THEN 0 ELSE LKP_SMLNPOLS.SC_REC_TRANS_CODE END <> CASE WHEN exp_HOLD_DATA.SC_REC_TRANS_CODE IS NULL THEN 0 ELSE exp_HOLD_DATA.SC_REC_TRANS_CODE END OR CASE WHEN LKP_SMLNPOLS.SC_TRANS_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE LKP_SMLNPOLS.SC_TRANS_DATE END <> CASE WHEN exp_HOLD_DATA.SC_TRANS_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE exp_HOLD_DATA.SC_TRANS_DATE END OR CASE WHEN LKP_SMLNPOLS.SC_TRANS_TYPE IS NULL THEN 0 ELSE LKP_SMLNPOLS.SC_TRANS_TYPE END <> CASE WHEN exp_HOLD_DATA.SC_TRANS_TYPE IS NULL THEN 0 ELSE exp_HOLD_DATA.SC_TRANS_TYPE END OR CASE WHEN LKP_SMLNPOLS.PC_ALPHA_CODE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_ALPHA_CODE END <> CASE WHEN exp_HOLD_DATA.PC_ALPHA_CODE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_ALPHA_CODE END OR CASE WHEN LKP_SMLNPOLS.PC_NAME_1 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_NAME_1 END <> CASE WHEN exp_HOLD_DATA.PC_NAME_1 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_NAME_1 END OR CASE WHEN LKP_SMLNPOLS.PC_NAME_2 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_NAME_2 END <> CASE WHEN exp_HOLD_DATA.PC_NAME_2 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_NAME_2 END OR CASE WHEN LKP_SMLNPOLS.PC_ADDRESS_1 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_ADDRESS_1 END <> CASE WHEN exp_HOLD_DATA.PC_ADDRESS_1 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_ADDRESS_1 END OR CASE WHEN LKP_SMLNPOLS.PC_ADDRESS_2 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_ADDRESS_2 END <> CASE WHEN exp_HOLD_DATA.PC_ADDRESS_2 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_ADDRESS_2 END OR CASE WHEN LKP_SMLNPOLS.PC_CITYST IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_CITYST END <> CASE WHEN exp_HOLD_DATA.PC_CITYST IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_CITYST END OR CASE WHEN LKP_SMLNPOLS.PC_ZIP IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_ZIP END <> CASE WHEN exp_HOLD_DATA.PC_ZIP IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_ZIP END OR CASE WHEN LKP_SMLNPOLS.PC_TAX_CODE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_TAX_CODE END <> CASE WHEN exp_HOLD_DATA.PC_TAX_CODE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_TAX_CODE END OR CASE WHEN LKP_SMLNPOLS.PC_AGENT IS NULL THEN 0 ELSE LKP_SMLNPOLS.PC_AGENT END <> CASE WHEN exp_HOLD_DATA.PC_AGENT IS NULL THEN 0 ELSE exp_HOLD_DATA.PC_AGENT END OR CASE WHEN LKP_SMLNPOLS.PC_MEMBER_NUMBER IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_MEMBER_NUMBER END <> CASE WHEN exp_HOLD_DATA.PC_MEMBER_NUMBER IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_MEMBER_NUMBER END OR CASE WHEN LKP_SMLNPOLS.PC_RATE_CODE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_RATE_CODE END <> CASE WHEN exp_HOLD_DATA.PC_RATE_CODE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_RATE_CODE END OR CASE WHEN LKP_SMLNPOLS.PC_ENCUMBRANCE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_ENCUMBRANCE END <> CASE WHEN exp_HOLD_DATA.PC_ENCUMBRANCE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_ENCUMBRANCE END OR CASE WHEN LKP_SMLNPOLS.PC_PREM_FIN IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_PREM_FIN END <> CASE WHEN exp_HOLD_DATA.PC_PREM_FIN IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_PREM_FIN END OR CASE WHEN LKP_SMLNPOLS.PC_MORT_IND IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_MORT_IND END <> CASE WHEN exp_HOLD_DATA.PC_MORT_IND IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_MORT_IND END OR CASE WHEN LKP_SMLNPOLS.PC_COMPANY IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_COMPANY END <> CASE WHEN exp_HOLD_DATA.PC_COMPANY IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_COMPANY END OR CASE WHEN LKP_SMLNPOLS.PC_INCEPT_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE LKP_SMLNPOLS.PC_INCEPT_DATE END <> CASE WHEN exp_HOLD_DATA.PC_INCEPT_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE exp_HOLD_DATA.PC_INCEPT_DATE END OR CASE WHEN LKP_SMLNPOLS.PC_EXP_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE LKP_SMLNPOLS.PC_EXP_DATE END <> CASE WHEN exp_HOLD_DATA.PC_EXP_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE exp_HOLD_DATA.PC_EXP_DATE END OR CASE WHEN LKP_SMLNPOLS.PC_EFF_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE LKP_SMLNPOLS.PC_EFF_DATE END <> CASE WHEN exp_HOLD_DATA.PC_EFF_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE exp_HOLD_DATA.PC_EFF_DATE END OR CASE WHEN LKP_SMLNPOLS.PC_STATUS IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.PC_STATUS END <> CASE WHEN exp_HOLD_DATA.PC_STATUS IS NULL THEN ''~'' ELSE exp_HOLD_DATA.PC_STATUS END OR CASE WHEN LKP_SMLNPOLS.SMLN_TOT_PREM IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_TOT_PREM END <> CASE WHEN exp_HOLD_DATA.SMLN_TOT_PREM IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_TOT_PREM END OR CASE WHEN LKP_SMLNPOLS.SMLN_REWRITE_IND IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_REWRITE_IND END <> CASE WHEN exp_HOLD_DATA.SMLN_REWRITE_IND IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_REWRITE_IND END OR CASE WHEN LKP_SMLNPOLS.SMLN_REWRITE_DT IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE LKP_SMLNPOLS.SMLN_REWRITE_DT END <> CASE WHEN exp_HOLD_DATA.SMLN_REWRITE_DT IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE exp_HOLD_DATA.SMLN_REWRITE_DT END OR CASE WHEN LKP_SMLNPOLS.SMLN_OUTST_AMT IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_OUTST_AMT END <> CASE WHEN exp_HOLD_DATA.SMLN_OUTST_AMT IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_OUTST_AMT END OR CASE WHEN LKP_SMLNPOLS.SMLN_OUTST_TYPE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_OUTST_TYPE END <> CASE WHEN exp_HOLD_DATA.SMLN_OUTST_TYPE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_OUTST_TYPE END OR CASE WHEN LKP_SMLNPOLS.SMLN_OUTST_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE LKP_SMLNPOLS.SMLN_OUTST_DATE END <> CASE WHEN exp_HOLD_DATA.SMLN_OUTST_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE exp_HOLD_DATA.SMLN_OUTST_DATE END OR CASE WHEN LKP_SMLNPOLS.SMLN_OUTST_PD_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE LKP_SMLNPOLS.SMLN_OUTST_PD_DATE END <> CASE WHEN exp_HOLD_DATA.SMLN_OUTST_PD_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE exp_HOLD_DATA.SMLN_OUTST_PD_DATE END OR CASE WHEN LKP_SMLNPOLS.SMLN_SUSPENSE_CD IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SUSPENSE_CD END <> CASE WHEN exp_HOLD_DATA.SMLN_SUSPENSE_CD IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SUSPENSE_CD END OR CASE WHEN LKP_SMLNPOLS.SMLN_SUSPENSE_CAN IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SUSPENSE_CAN END <> CASE WHEN exp_HOLD_DATA.SMLN_SUSPENSE_CAN IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SUSPENSE_CAN END OR CASE WHEN LKP_SMLNPOLS.SMLN_SSN_1 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SSN_1 END <> CASE WHEN exp_HOLD_DATA.SMLN_SSN_1 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SSN_1 END OR CASE WHEN LKP_SMLNPOLS.SMLN_SSN_2 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SSN_2 END <> CASE WHEN exp_HOLD_DATA.SMLN_SSN_2 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SSN_2 END OR CASE WHEN LKP_SMLNPOLS.SMLN_UW_REVIEW_DT IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE LKP_SMLNPOLS.SMLN_UW_REVIEW_DT END <> CASE WHEN exp_HOLD_DATA.SMLN_UW_REVIEW_DT IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE exp_HOLD_DATA.SMLN_UW_REVIEW_DT END OR CASE WHEN LKP_SMLNPOLS.SMLN_UW_INITIALS IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_UW_INITIALS END <> CASE WHEN exp_HOLD_DATA.SMLN_UW_INITIALS IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_UW_INITIALS END OR CASE WHEN LKP_SMLNPOLS.SMLN_MORT_NAME_1 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_MORT_NAME_1 END <> CASE WHEN exp_HOLD_DATA.SMLN_MORT_NAME_1 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_MORT_NAME_1 END OR CASE WHEN LKP_SMLNPOLS.SMLN_MORT_NAME_2 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_MORT_NAME_2 END <> CASE WHEN exp_HOLD_DATA.SMLN_MORT_NAME_2 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_MORT_NAME_2 END OR CASE WHEN LKP_SMLNPOLS.SMLN_MORT_ADD_1 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_MORT_ADD_1 END <> CASE WHEN exp_HOLD_DATA.SMLN_MORT_ADD_1 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_MORT_ADD_1 END OR CASE WHEN LKP_SMLNPOLS.SMLN_MORT_ADD_2 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_MORT_ADD_2 END <> CASE WHEN exp_HOLD_DATA.SMLN_MORT_ADD_2 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_MORT_ADD_2 END OR CASE WHEN LKP_SMLNPOLS.SMLN_MORT_CTYST IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_MORT_CTYST END <> CASE WHEN exp_HOLD_DATA.SMLN_MORT_CTYST IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_MORT_CTYST END OR CASE WHEN LKP_SMLNPOLS.SMLN_MORT_ZIP IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_MORT_ZIP END <> CASE WHEN exp_HOLD_DATA.SMLN_MORT_ZIP IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_MORT_ZIP END OR CASE WHEN LKP_SMLNPOLS.SMLN_STATE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_STATE END <> CASE WHEN exp_HOLD_DATA.SMLN_STATE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_STATE END OR CASE WHEN LKP_SMLNPOLS.SMLN_MORT_TYPE IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_MORT_TYPE END <> CASE WHEN exp_HOLD_DATA.SMLN_MORT_TYPE IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_MORT_TYPE END OR CASE WHEN LKP_SMLNPOLS.SMLN_CANC_CODE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_CANC_CODE END <> CASE WHEN exp_HOLD_DATA.SMLN_CANC_CODE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_CANC_CODE END OR CASE WHEN LKP_SMLNPOLS.SMLN_SP5_ENDR_IND IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SP5_ENDR_IND END <> CASE WHEN exp_HOLD_DATA.SMLN_SP5_ENDR_IND IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SP5_ENDR_IND END OR CASE WHEN LKP_SMLNPOLS.SMLN_LOAN_NUM IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_LOAN_NUM END <> CASE WHEN exp_HOLD_DATA.SMLN_LOAN_NUM IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_LOAN_NUM END OR CASE WHEN LKP_SMLNPOLS.SMLN_SLOAN_NUM IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SLOAN_NUM END <> CASE WHEN exp_HOLD_DATA.SMLN_SLOAN_NUM IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SLOAN_NUM END OR CASE WHEN LKP_SMLNPOLS.SMLN_SMORT_NAME_1 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SMORT_NAME_1 END <> CASE WHEN exp_HOLD_DATA.SMLN_SMORT_NAME_1 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SMORT_NAME_1 END OR CASE WHEN LKP_SMLNPOLS.SMLN_SMORT_NAME_2 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SMORT_NAME_2 END <> CASE WHEN exp_HOLD_DATA.SMLN_SMORT_NAME_2 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SMORT_NAME_2 END OR CASE WHEN LKP_SMLNPOLS.SMLN_SMORT_ADD_1 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SMORT_ADD_1 END <> CASE WHEN exp_HOLD_DATA.SMLN_SMORT_ADD_1 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SMORT_ADD_1 END OR CASE WHEN LKP_SMLNPOLS.SMLN_SMORT_ADD_2 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SMORT_ADD_2 END <> CASE WHEN exp_HOLD_DATA.SMLN_SMORT_ADD_2 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SMORT_ADD_2 END OR CASE WHEN LKP_SMLNPOLS.SMLN_SMORT_CTYST IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SMORT_CTYST END <> CASE WHEN exp_HOLD_DATA.SMLN_SMORT_CTYST IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SMORT_CTYST END OR CASE WHEN LKP_SMLNPOLS.SMLN_SMORT_ZIP IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SMORT_ZIP END <> CASE WHEN exp_HOLD_DATA.SMLN_SMORT_ZIP IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SMORT_ZIP END OR CASE WHEN LKP_SMLNPOLS.SMLN_SMORT_TYPE IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_SMORT_TYPE END <> CASE WHEN exp_HOLD_DATA.SMLN_SMORT_TYPE IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_SMORT_TYPE END OR CASE WHEN LKP_SMLNPOLS.SMLN_PREMIUM_1 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_PREMIUM_1 END <> CASE WHEN exp_HOLD_DATA.SMLN_PREMIUM_1 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_PREMIUM_1 END OR CASE WHEN LKP_SMLNPOLS.SMLN_PREMIUM_2 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_PREMIUM_2 END <> CASE WHEN exp_HOLD_DATA.SMLN_PREMIUM_2 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_PREMIUM_2 END OR CASE WHEN LKP_SMLNPOLS.SMLN_PREMIUM_3 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_PREMIUM_3 END <> CASE WHEN exp_HOLD_DATA.SMLN_PREMIUM_3 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_PREMIUM_3 END OR CASE WHEN LKP_SMLNPOLS.SMLN_PREMIUM_4 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_PREMIUM_4 END <> CASE WHEN exp_HOLD_DATA.SMLN_PREMIUM_4 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_PREMIUM_4 END OR CASE WHEN LKP_SMLNPOLS.SMLN_PREMIUM_5 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_PREMIUM_5 END <> CASE WHEN exp_HOLD_DATA.SMLN_PREMIUM_5 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_PREMIUM_5 END OR CASE WHEN LKP_SMLNPOLS.SMLN_PREMIUM_6 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_PREMIUM_6 END <> CASE WHEN exp_HOLD_DATA.SMLN_PREMIUM_6 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_PREMIUM_6 END OR CASE WHEN LKP_SMLNPOLS.SMLN_PREMIUM_7 IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_PREMIUM_7 END <> CASE WHEN exp_HOLD_DATA.SMLN_PREMIUM_7 IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_PREMIUM_7 END OR CASE WHEN LKP_SMLNPOLS.SMLN_COVERAGE_1 IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_COVERAGE_1 END <> CASE WHEN exp_HOLD_DATA.SMLN_COVERAGE_1 IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_COVERAGE_1 END OR CASE WHEN LKP_SMLNPOLS.SMLN_COVERAGE_2 IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_COVERAGE_2 END <> CASE WHEN exp_HOLD_DATA.SMLN_COVERAGE_2 IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_COVERAGE_2 END OR CASE WHEN LKP_SMLNPOLS.SMLN_COVERAGE_3 IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_COVERAGE_3 END <> CASE WHEN exp_HOLD_DATA.SMLN_COVERAGE_3 IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_COVERAGE_3 END OR CASE WHEN LKP_SMLNPOLS.SMLN_COVERAGE_4 IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_COVERAGE_4 END <> CASE WHEN exp_HOLD_DATA.SMLN_COVERAGE_4 IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_COVERAGE_4 END OR CASE WHEN LKP_SMLNPOLS.SMLN_COVERAGE_5 IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_COVERAGE_5 END <> CASE WHEN exp_HOLD_DATA.SMLN_COVERAGE_5 IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_COVERAGE_5 END OR CASE WHEN LKP_SMLNPOLS.SMLN_COVERAGE_6 IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_COVERAGE_6 END <> CASE WHEN exp_HOLD_DATA.SMLN_COVERAGE_6 IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_COVERAGE_6 END OR CASE WHEN LKP_SMLNPOLS.SMLN_COVERAGE_7 IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_COVERAGE_7 END <> CASE WHEN exp_HOLD_DATA.SMLN_COVERAGE_7 IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_COVERAGE_7 END OR CASE WHEN LKP_SMLNPOLS.SMLN_COVERAGE_8 IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_COVERAGE_8 END <> CASE WHEN exp_HOLD_DATA.SMLN_COVERAGE_8 IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_COVERAGE_8 END OR CASE WHEN LKP_SMLNPOLS.SMLN_T_MODEL_YEAR IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_T_MODEL_YEAR END <> CASE WHEN exp_HOLD_DATA.SMLN_T_MODEL_YEAR IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_T_MODEL_YEAR END OR CASE WHEN LKP_SMLNPOLS.SMLN_T_MAKE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_T_MAKE END <> CASE WHEN exp_HOLD_DATA.SMLN_T_MAKE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_T_MAKE END OR CASE WHEN LKP_SMLNPOLS.SMLN_T_OCCUPANCY IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_T_OCCUPANCY END <> CASE WHEN exp_HOLD_DATA.SMLN_T_OCCUPANCY IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_T_OCCUPANCY END OR CASE WHEN LKP_SMLNPOLS.SMLN_T_UNDERPIN IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_T_UNDERPIN END <> CASE WHEN exp_HOLD_DATA.SMLN_T_UNDERPIN IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_T_UNDERPIN END OR CASE WHEN LKP_SMLNPOLS.SMLN_T_CLASS IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_T_CLASS END <> CASE WHEN exp_HOLD_DATA.SMLN_T_CLASS IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_T_CLASS END OR CASE WHEN LKP_SMLNPOLS.SMLN_POL_TYPE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_POL_TYPE END <> CASE WHEN exp_HOLD_DATA.SMLN_POL_TYPE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_POL_TYPE END OR CASE WHEN LKP_SMLNPOLS.SMLN_SP_BT_CLASS IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SP_BT_CLASS END <> CASE WHEN exp_HOLD_DATA.SMLN_SP_BT_CLASS IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SP_BT_CLASS END OR CASE WHEN LKP_SMLNPOLS.SMLN_FC_NUM_ACRES IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_FC_NUM_ACRES END <> CASE WHEN exp_HOLD_DATA.SMLN_FC_NUM_ACRES IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_FC_NUM_ACRES END OR CASE WHEN LKP_SMLNPOLS.SMLN_FC_NUM_EMP IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_FC_NUM_EMP END <> CASE WHEN exp_HOLD_DATA.SMLN_FC_NUM_EMP IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_FC_NUM_EMP END OR CASE WHEN LKP_SMLNPOLS.SMLN_FC_PAYROLL IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_FC_PAYROLL END <> CASE WHEN exp_HOLD_DATA.SMLN_FC_PAYROLL IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_FC_PAYROLL END OR CASE WHEN LKP_SMLNPOLS.SMLN_FC_CUST_FARM IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_FC_CUST_FARM END <> CASE WHEN exp_HOLD_DATA.SMLN_FC_CUST_FARM IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_FC_CUST_FARM END OR CASE WHEN LKP_SMLNPOLS.SMLN_FC_ADD_PREM IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_FC_ADD_PREM END <> CASE WHEN exp_HOLD_DATA.SMLN_FC_ADD_PREM IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_FC_ADD_PREM END OR CASE WHEN LKP_SMLNPOLS.SMLN_FC_RES_MAINT IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_FC_RES_MAINT END <> CASE WHEN exp_HOLD_DATA.SMLN_FC_RES_MAINT IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_FC_RES_MAINT END OR CASE WHEN LKP_SMLNPOLS.SMLN_FC_ADD_INSRD IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_FC_ADD_INSRD END <> CASE WHEN exp_HOLD_DATA.SMLN_FC_ADD_INSRD IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_FC_ADD_INSRD END OR CASE WHEN LKP_SMLNPOLS.SMLN_FC_ADD_RENT IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_FC_ADD_RENT END <> CASE WHEN exp_HOLD_DATA.SMLN_FC_ADD_RENT IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_FC_ADD_RENT END OR CASE WHEN LKP_SMLNPOLS.SMLN_DEDUCTIBLE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_DEDUCTIBLE END <> CASE WHEN exp_HOLD_DATA.SMLN_DEDUCTIBLE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_DEDUCTIBLE END OR CASE WHEN LKP_SMLNPOLS.SMLN_HALF_TERM_BP IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_HALF_TERM_BP END <> CASE WHEN exp_HOLD_DATA.SMLN_HALF_TERM_BP IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_HALF_TERM_BP END OR CASE WHEN LKP_SMLNPOLS.SMLN_FULL_TERM_BP IS NULL THEN 0 ELSE LKP_SMLNPOLS.SMLN_FULL_TERM_BP END <> CASE WHEN exp_HOLD_DATA.SMLN_FULL_TERM_BP IS NULL THEN 0 ELSE exp_HOLD_DATA.SMLN_FULL_TERM_BP END OR CASE WHEN LKP_SMLNPOLS.SMLN_TRANSFER_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE LKP_SMLNPOLS.SMLN_TRANSFER_DATE END <> CASE WHEN exp_HOLD_DATA.SMLN_TRANSFER_DATE IS NULL THEN TO_DATE ( ''01/01/0001'' , ''MM/DD/YYYY'' ) ELSE exp_HOLD_DATA.SMLN_TRANSFER_DATE END OR CASE WHEN LKP_SMLNPOLS.SMLN_MB_TYPE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_MB_TYPE END <> CASE WHEN exp_HOLD_DATA.SMLN_MB_TYPE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_MB_TYPE END OR CASE WHEN LKP_SMLNPOLS.SMLN_MB_ACCT_NUM IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_MB_ACCT_NUM END <> CASE WHEN exp_HOLD_DATA.SMLN_MB_ACCT_NUM IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_MB_ACCT_NUM END OR CASE WHEN LKP_SMLNPOLS.SMLN_SC_LIAB_PRD_I IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_SC_LIAB_PRD_I END <> CASE WHEN exp_HOLD_DATA.SMLN_SC_LIAB_PRD_I IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_SC_LIAB_PRD_I END OR CASE WHEN LKP_SMLNPOLS.SMLN_GL_COV_TYPE IS NULL THEN ''~'' ELSE LKP_SMLNPOLS.SMLN_GL_COV_TYPE END <> CASE WHEN exp_HOLD_DATA.SMLN_GL_COV_TYPE IS NULL THEN ''~'' ELSE exp_HOLD_DATA.SMLN_GL_COV_TYPE END THEN ''UPD'' ELSE ''REJ'' END END as FLAG,
exp_HOLD_DATA.source_record_id
FROM
exp_HOLD_DATA
INNER JOIN LKP_SMLNPOLS ON exp_HOLD_DATA.source_record_id = LKP_SMLNPOLS.source_record_id
);


-- Component mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE, Type MAPPLET 
--MAPPLET NOT REGISTERED: mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE, mapplet instance mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE;


-- Component exp_SMLNPOLS, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_SMLNPOLS AS
(
SELECT
exp_DERIVE_FLAG.SC_POLICY_NUM_LKP as SC_POLICY_NUM_LKP,
exp_DERIVE_FLAG.CHG_EFF_DT_LKP as CHG_EFF_DT_LKP,
exp_DERIVE_FLAG.SC_DWNLD_PRIORITY as SC_DWNLD_PRIORITY,
exp_DERIVE_FLAG.SC_SERVICE_CENTER as SC_SERVICE_CENTER,
exp_DERIVE_FLAG.SC_POLICY_NUM as SC_POLICY_NUM,
exp_DERIVE_FLAG.SC_FLT_ITEM as SC_FLT_ITEM,
exp_DERIVE_FLAG.SC_FILE_TYPE as SC_FILE_TYPE,
exp_DERIVE_FLAG.SC_REC_TRANS_CODE as SC_REC_TRANS_CODE,
exp_DERIVE_FLAG.SC_TRANS_DATE as SC_TRANS_DATE,
exp_DERIVE_FLAG.SC_TRANS_TYPE as SC_TRANS_TYPE,
exp_DERIVE_FLAG.PC_ALPHA_CODE as PC_ALPHA_CODE,
exp_DERIVE_FLAG.PC_NAME_1 as PC_NAME_1,
exp_DERIVE_FLAG.PC_NAME_2 as PC_NAME_2,
exp_DERIVE_FLAG.PC_ADDRESS_1 as PC_ADDRESS_1,
exp_DERIVE_FLAG.PC_ADDRESS_2 as PC_ADDRESS_2,
exp_DERIVE_FLAG.PC_CITYST as PC_CITYST,
exp_DERIVE_FLAG.PC_ZIP as PC_ZIP,
exp_DERIVE_FLAG.PC_TAX_CODE as PC_TAX_CODE,
exp_DERIVE_FLAG.PC_AGENT as PC_AGENT,
exp_DERIVE_FLAG.PC_MEMBER_NUMBER as PC_MEMBER_NUMBER,
exp_DERIVE_FLAG.PC_RATE_CODE as PC_RATE_CODE,
exp_DERIVE_FLAG.PC_ENCUMBRANCE as PC_ENCUMBRANCE,
exp_DERIVE_FLAG.PC_PREM_FIN as PC_PREM_FIN,
exp_DERIVE_FLAG.PC_MORT_IND as PC_MORT_IND,
exp_DERIVE_FLAG.PC_COMPANY as PC_COMPANY,
exp_DERIVE_FLAG.PC_INCEPT_DATE as PC_INCEPT_DATE,
exp_DERIVE_FLAG.PC_EXP_DATE as PC_EXP_DATE,
exp_DERIVE_FLAG.PC_EFF_DATE as PC_EFF_DATE,
exp_DERIVE_FLAG.PC_STATUS as PC_STATUS,
exp_DERIVE_FLAG.SMLN_TOT_PREM as SMLN_TOT_PREM,
exp_DERIVE_FLAG.SMLN_REWRITE_IND as SMLN_REWRITE_IND,
exp_DERIVE_FLAG.SMLN_REWRITE_DT as SMLN_REWRITE_DT,
exp_DERIVE_FLAG.SMLN_OUTST_AMT as SMLN_OUTST_AMT,
exp_DERIVE_FLAG.SMLN_OUTST_TYPE as SMLN_OUTST_TYPE,
exp_DERIVE_FLAG.SMLN_OUTST_DATE as SMLN_OUTST_DATE,
exp_DERIVE_FLAG.SMLN_OUTST_PD_DATE as SMLN_OUTST_PD_DATE,
exp_DERIVE_FLAG.SMLN_SUSPENSE_CD as SMLN_SUSPENSE_CD,
exp_DERIVE_FLAG.SMLN_SUSPENSE_CAN as SMLN_SUSPENSE_CAN,
exp_DERIVE_FLAG.SMLN_SSN_1 as SMLN_SSN_1,
exp_DERIVE_FLAG.SMLN_SSN_2 as SMLN_SSN_2,
exp_DERIVE_FLAG.SMLN_UW_REVIEW_DT as SMLN_UW_REVIEW_DT,
exp_DERIVE_FLAG.SMLN_UW_INITIALS as SMLN_UW_INITIALS,
exp_DERIVE_FLAG.SMLN_MORT_NAME_1 as SMLN_MORT_NAME_1,
exp_DERIVE_FLAG.SMLN_MORT_NAME_2 as SMLN_MORT_NAME_2,
exp_DERIVE_FLAG.SMLN_MORT_ADD_1 as SMLN_MORT_ADD_1,
exp_DERIVE_FLAG.SMLN_MORT_ADD_2 as SMLN_MORT_ADD_2,
exp_DERIVE_FLAG.SMLN_MORT_CTYST as SMLN_MORT_CTYST,
exp_DERIVE_FLAG.SMLN_MORT_ZIP as SMLN_MORT_ZIP,
exp_DERIVE_FLAG.SMLN_STATE as SMLN_STATE,
exp_DERIVE_FLAG.SMLN_MORT_TYPE as SMLN_MORT_TYPE,
exp_DERIVE_FLAG.SMLN_CANC_CODE as SMLN_CANC_CODE,
exp_DERIVE_FLAG.SMLN_SP5_ENDR_IND as SMLN_SP5_ENDR_IND,
exp_DERIVE_FLAG.SMLN_LOAN_NUM as SMLN_LOAN_NUM,
exp_DERIVE_FLAG.SMLN_SLOAN_NUM as SMLN_SLOAN_NUM,
exp_DERIVE_FLAG.SMLN_SMORT_NAME_1 as SMLN_SMORT_NAME_1,
exp_DERIVE_FLAG.SMLN_SMORT_NAME_2 as SMLN_SMORT_NAME_2,
exp_DERIVE_FLAG.SMLN_SMORT_ADD_1 as SMLN_SMORT_ADD_1,
exp_DERIVE_FLAG.SMLN_SMORT_ADD_2 as SMLN_SMORT_ADD_2,
exp_DERIVE_FLAG.SMLN_SMORT_CTYST as SMLN_SMORT_CTYST,
exp_DERIVE_FLAG.SMLN_SMORT_ZIP as SMLN_SMORT_ZIP,
exp_DERIVE_FLAG.SMLN_SMORT_TYPE as SMLN_SMORT_TYPE,
exp_DERIVE_FLAG.SMLN_PREMIUM_1 as SMLN_PREMIUM_1,
exp_DERIVE_FLAG.SMLN_PREMIUM_2 as SMLN_PREMIUM_2,
exp_DERIVE_FLAG.SMLN_PREMIUM_3 as SMLN_PREMIUM_3,
exp_DERIVE_FLAG.SMLN_PREMIUM_4 as SMLN_PREMIUM_4,
exp_DERIVE_FLAG.SMLN_PREMIUM_5 as SMLN_PREMIUM_5,
exp_DERIVE_FLAG.SMLN_PREMIUM_6 as SMLN_PREMIUM_6,
exp_DERIVE_FLAG.SMLN_PREMIUM_7 as SMLN_PREMIUM_7,
exp_DERIVE_FLAG.SMLN_COVERAGE_1 as SMLN_COVERAGE_1,
exp_DERIVE_FLAG.SMLN_COVERAGE_2 as SMLN_COVERAGE_2,
exp_DERIVE_FLAG.SMLN_COVERAGE_3 as SMLN_COVERAGE_3,
exp_DERIVE_FLAG.SMLN_COVERAGE_4 as SMLN_COVERAGE_4,
exp_DERIVE_FLAG.SMLN_COVERAGE_5 as SMLN_COVERAGE_5,
exp_DERIVE_FLAG.SMLN_COVERAGE_6 as SMLN_COVERAGE_6,
exp_DERIVE_FLAG.SMLN_COVERAGE_7 as SMLN_COVERAGE_7,
exp_DERIVE_FLAG.SMLN_COVERAGE_8 as SMLN_COVERAGE_8,
exp_DERIVE_FLAG.SMLN_T_MODEL_YEAR as SMLN_T_MODEL_YEAR,
exp_DERIVE_FLAG.SMLN_T_MAKE as SMLN_T_MAKE,
exp_DERIVE_FLAG.SMLN_T_OCCUPANCY as SMLN_T_OCCUPANCY,
exp_DERIVE_FLAG.SMLN_T_UNDERPIN as SMLN_T_UNDERPIN,
exp_DERIVE_FLAG.SMLN_T_CLASS as SMLN_T_CLASS,
exp_DERIVE_FLAG.SMLN_POL_TYPE as SMLN_POL_TYPE,
exp_DERIVE_FLAG.SMLN_SP_BT_CLASS as SMLN_SP_BT_CLASS,
exp_DERIVE_FLAG.SMLN_FC_NUM_ACRES as SMLN_FC_NUM_ACRES,
exp_DERIVE_FLAG.SMLN_FC_NUM_EMP as SMLN_FC_NUM_EMP,
exp_DERIVE_FLAG.SMLN_FC_PAYROLL as SMLN_FC_PAYROLL,
exp_DERIVE_FLAG.SMLN_FC_CUST_FARM as SMLN_FC_CUST_FARM,
exp_DERIVE_FLAG.SMLN_FC_ADD_PREM as SMLN_FC_ADD_PREM,
exp_DERIVE_FLAG.SMLN_FC_RES_MAINT as SMLN_FC_RES_MAINT,
exp_DERIVE_FLAG.SMLN_FC_ADD_INSRD as SMLN_FC_ADD_INSRD,
exp_DERIVE_FLAG.SMLN_FC_ADD_RENT as SMLN_FC_ADD_RENT,
exp_DERIVE_FLAG.SMLN_DEDUCTIBLE as SMLN_DEDUCTIBLE,
exp_DERIVE_FLAG.SMLN_HALF_TERM_BP as SMLN_HALF_TERM_BP,
exp_DERIVE_FLAG.SMLN_FULL_TERM_BP as SMLN_FULL_TERM_BP,
exp_DERIVE_FLAG.SMLN_TRANSFER_DATE as SMLN_TRANSFER_DATE,
exp_DERIVE_FLAG.SMLN_MB_TYPE as SMLN_MB_TYPE,
exp_DERIVE_FLAG.SMLN_MB_ACCT_NUM as SMLN_MB_ACCT_NUM,
exp_DERIVE_FLAG.SMLN_SC_LIAB_PRD_I as SMLN_SC_LIAB_PRD_I,
exp_DERIVE_FLAG.SMLN_GL_COV_TYPE as SMLN_GL_COV_TYPE,
exp_DERIVE_FLAG.LOAD_DT as LOAD_DT,
exp_DERIVE_FLAG.FEED_IND as FEED_IND,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ECTL_PRGM_ID as out_ECTL_PRGM_ID,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ECTL_SRC_ID as out_ECTL_SRC_ID,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ECTL_SRC_INST_ID as out_ECTL_SRC_INST_ID,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ECTL_BATCH_ID as out_ECTL_BATCH_ID,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ORIG_INS_TS as out_ORIG_INS_TS,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ECTL_BATCH_START_DATE as out_ECTL_BATCH_START_DATE,
--null as out_ECTL_PRGM_ID,
--null as out_ECTL_SRC_ID,
--null as out_ECTL_SRC_INST_ID,
--null as out_ECTL_BATCH_ID,
--null as out_ORIG_INS_TS,
--null as out_ECTL_BATCH_START_DATE,
exp_DERIVE_FLAG.FLAG as FLAG,
exp_DERIVE_FLAG.source_record_id
FROM
exp_DERIVE_FLAG
INNER JOIN mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE ON exp_DERIVE_FLAG.source_record_id = mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.source_record_id
);


-- Component rtr_INS_UPD_INSERT, Type ROUTER Output Group INSERT
create or replace temp table RTR_INS_UPD_INSERT as
SELECT
exp_SMLNPOLS.SC_DWNLD_PRIORITY as SC_DWNLD_PRIORITY,
exp_SMLNPOLS.SC_SERVICE_CENTER as SC_SERVICE_CENTER,
exp_SMLNPOLS.SC_POLICY_NUM as SC_POLICY_NUM,
exp_SMLNPOLS.SC_FLT_ITEM as SC_FLT_ITEM,
exp_SMLNPOLS.SC_FILE_TYPE as SC_FILE_TYPE,
exp_SMLNPOLS.SC_REC_TRANS_CODE as SC_REC_TRANS_CODE,
exp_SMLNPOLS.SC_TRANS_DATE as SC_TRANS_DATE,
exp_SMLNPOLS.SC_TRANS_TYPE as SC_TRANS_TYPE,
exp_SMLNPOLS.PC_ALPHA_CODE as PC_ALPHA_CODE,
exp_SMLNPOLS.PC_NAME_1 as PC_NAME_1,
exp_SMLNPOLS.PC_NAME_2 as PC_NAME_2,
exp_SMLNPOLS.PC_ADDRESS_1 as PC_ADDRESS_1,
exp_SMLNPOLS.PC_ADDRESS_2 as PC_ADDRESS_2,
exp_SMLNPOLS.PC_CITYST as PC_CITYST,
exp_SMLNPOLS.PC_ZIP as PC_ZIP,
exp_SMLNPOLS.PC_TAX_CODE as PC_TAX_CODE,
exp_SMLNPOLS.PC_AGENT as PC_AGENT,
exp_SMLNPOLS.PC_MEMBER_NUMBER as PC_MEMBER_NUMBER,
exp_SMLNPOLS.PC_RATE_CODE as PC_RATE_CODE,
exp_SMLNPOLS.PC_ENCUMBRANCE as PC_ENCUMBRANCE,
exp_SMLNPOLS.PC_PREM_FIN as PC_PREM_FIN,
exp_SMLNPOLS.PC_MORT_IND as PC_MORT_IND,
exp_SMLNPOLS.PC_COMPANY as PC_COMPANY,
exp_SMLNPOLS.PC_INCEPT_DATE as PC_INCEPT_DATE,
exp_SMLNPOLS.PC_EXP_DATE as PC_EXP_DATE,
exp_SMLNPOLS.PC_EFF_DATE as PC_EFF_DATE,
exp_SMLNPOLS.PC_STATUS as PC_STATUS,
exp_SMLNPOLS.SMLN_TOT_PREM as SMLN_TOT_PREM,
exp_SMLNPOLS.SMLN_REWRITE_IND as SMLN_REWRITE_IND,
exp_SMLNPOLS.SMLN_REWRITE_DT as SMLN_REWRITE_DT,
exp_SMLNPOLS.SMLN_OUTST_AMT as SMLN_OUTST_AMT,
exp_SMLNPOLS.SMLN_OUTST_TYPE as SMLN_OUTST_TYPE,
exp_SMLNPOLS.SMLN_OUTST_DATE as SMLN_OUTST_DATE,
exp_SMLNPOLS.SMLN_OUTST_PD_DATE as SMLN_OUTST_PD_DATE,
exp_SMLNPOLS.SMLN_SUSPENSE_CD as SMLN_SUSPENSE_CD,
exp_SMLNPOLS.SMLN_SUSPENSE_CAN as SMLN_SUSPENSE_CAN,
exp_SMLNPOLS.SMLN_SSN_1 as SMLN_SSN_1,
exp_SMLNPOLS.SMLN_SSN_2 as SMLN_SSN_2,
exp_SMLNPOLS.SMLN_UW_REVIEW_DT as SMLN_UW_REVIEW_DT,
exp_SMLNPOLS.SMLN_UW_INITIALS as SMLN_UW_INITIALS,
exp_SMLNPOLS.SMLN_MORT_NAME_1 as SMLN_MORT_NAME_1,
exp_SMLNPOLS.SMLN_MORT_NAME_2 as SMLN_MORT_NAME_2,
exp_SMLNPOLS.SMLN_MORT_ADD_1 as SMLN_MORT_ADD_1,
exp_SMLNPOLS.SMLN_MORT_ADD_2 as SMLN_MORT_ADD_2,
exp_SMLNPOLS.SMLN_MORT_CTYST as SMLN_MORT_CTYST,
exp_SMLNPOLS.SMLN_MORT_ZIP as SMLN_MORT_ZIP,
exp_SMLNPOLS.SMLN_STATE as SMLN_STATE,
exp_SMLNPOLS.SMLN_MORT_TYPE as SMLN_MORT_TYPE,
exp_SMLNPOLS.SMLN_CANC_CODE as SMLN_CANC_CODE,
exp_SMLNPOLS.SMLN_SP5_ENDR_IND as SMLN_SP5_ENDR_IND,
exp_SMLNPOLS.SMLN_LOAN_NUM as SMLN_LOAN_NUM,
exp_SMLNPOLS.SMLN_SLOAN_NUM as SMLN_SLOAN_NUM,
exp_SMLNPOLS.SMLN_SMORT_NAME_1 as SMLN_SMORT_NAME_1,
exp_SMLNPOLS.SMLN_SMORT_NAME_2 as SMLN_SMORT_NAME_2,
exp_SMLNPOLS.SMLN_SMORT_ADD_1 as SMLN_SMORT_ADD_1,
exp_SMLNPOLS.SMLN_SMORT_ADD_2 as SMLN_SMORT_ADD_2,
exp_SMLNPOLS.SMLN_SMORT_CTYST as SMLN_SMORT_CTYST,
exp_SMLNPOLS.SMLN_SMORT_ZIP as SMLN_SMORT_ZIP,
exp_SMLNPOLS.SMLN_SMORT_TYPE as SMLN_SMORT_TYPE,
exp_SMLNPOLS.SMLN_PREMIUM_1 as SMLN_PREMIUM_1,
exp_SMLNPOLS.SMLN_PREMIUM_2 as SMLN_PREMIUM_2,
exp_SMLNPOLS.SMLN_PREMIUM_3 as SMLN_PREMIUM_3,
exp_SMLNPOLS.SMLN_PREMIUM_4 as SMLN_PREMIUM_4,
exp_SMLNPOLS.SMLN_PREMIUM_5 as SMLN_PREMIUM_5,
exp_SMLNPOLS.SMLN_PREMIUM_6 as SMLN_PREMIUM_6,
exp_SMLNPOLS.SMLN_PREMIUM_7 as SMLN_PREMIUM_7,
exp_SMLNPOLS.SMLN_COVERAGE_1 as SMLN_COVERAGE_1,
exp_SMLNPOLS.SMLN_COVERAGE_2 as SMLN_COVERAGE_2,
exp_SMLNPOLS.SMLN_COVERAGE_3 as SMLN_COVERAGE_3,
exp_SMLNPOLS.SMLN_COVERAGE_4 as SMLN_COVERAGE_4,
exp_SMLNPOLS.SMLN_COVERAGE_5 as SMLN_COVERAGE_5,
exp_SMLNPOLS.SMLN_COVERAGE_6 as SMLN_COVERAGE_6,
exp_SMLNPOLS.SMLN_COVERAGE_7 as SMLN_COVERAGE_7,
exp_SMLNPOLS.SMLN_COVERAGE_8 as SMLN_COVERAGE_8,
exp_SMLNPOLS.SMLN_T_MODEL_YEAR as SMLN_T_MODEL_YEAR,
exp_SMLNPOLS.SMLN_T_MAKE as SMLN_T_MAKE,
exp_SMLNPOLS.SMLN_T_OCCUPANCY as SMLN_T_OCCUPANCY,
exp_SMLNPOLS.SMLN_T_UNDERPIN as SMLN_T_UNDERPIN,
exp_SMLNPOLS.SMLN_T_CLASS as SMLN_T_CLASS,
exp_SMLNPOLS.SMLN_POL_TYPE as SMLN_POL_TYPE,
exp_SMLNPOLS.SMLN_SP_BT_CLASS as SMLN_SP_BT_CLASS,
exp_SMLNPOLS.SMLN_FC_NUM_ACRES as SMLN_FC_NUM_ACRES,
exp_SMLNPOLS.SMLN_FC_NUM_EMP as SMLN_FC_NUM_EMP,
exp_SMLNPOLS.SMLN_FC_PAYROLL as SMLN_FC_PAYROLL,
exp_SMLNPOLS.SMLN_FC_CUST_FARM as SMLN_FC_CUST_FARM,
exp_SMLNPOLS.SMLN_FC_ADD_PREM as SMLN_FC_ADD_PREM,
exp_SMLNPOLS.SMLN_FC_RES_MAINT as SMLN_FC_RES_MAINT,
exp_SMLNPOLS.SMLN_FC_ADD_INSRD as SMLN_FC_ADD_INSRD,
exp_SMLNPOLS.SMLN_FC_ADD_RENT as SMLN_FC_ADD_RENT,
exp_SMLNPOLS.SMLN_DEDUCTIBLE as SMLN_DEDUCTIBLE,
exp_SMLNPOLS.SMLN_HALF_TERM_BP as SMLN_HALF_TERM_BP,
exp_SMLNPOLS.SMLN_FULL_TERM_BP as SMLN_FULL_TERM_BP,
exp_SMLNPOLS.SMLN_TRANSFER_DATE as SMLN_TRANSFER_DATE,
exp_SMLNPOLS.SMLN_MB_TYPE as SMLN_MB_TYPE,
exp_SMLNPOLS.SMLN_MB_ACCT_NUM as SMLN_MB_ACCT_NUM,
exp_SMLNPOLS.SMLN_SC_LIAB_PRD_I as SMLN_SC_LIAB_PRD_I,
exp_SMLNPOLS.SMLN_GL_COV_TYPE as SMLN_GL_COV_TYPE,
exp_SMLNPOLS.LOAD_DT as LOAD_DT,
exp_SMLNPOLS.FEED_IND as FEED_IND,
exp_SMLNPOLS.out_ECTL_PRGM_ID as out_ECTL_PRGM_ID,
exp_SMLNPOLS.out_ECTL_SRC_ID as out_ECTL_SRC_ID,
exp_SMLNPOLS.out_ECTL_SRC_INST_ID as out_ECTL_SRC_INST_ID,
exp_SMLNPOLS.out_ECTL_BATCH_ID as out_ECTL_BATCH_ID,
exp_SMLNPOLS.out_ORIG_INS_TS as out_ORIG_INS_TS,
exp_SMLNPOLS.out_ECTL_BATCH_START_DATE as out_ECTL_BATCH_START_DATE,
exp_SMLNPOLS.FLAG as FLAG,
exp_SMLNPOLS.SC_POLICY_NUM_LKP as SC_POLICY_NUM_LKP,
exp_SMLNPOLS.CHG_EFF_DT_LKP as CHG_EFF_DT_LKP,
exp_SMLNPOLS.source_record_id
FROM
exp_SMLNPOLS
WHERE exp_SMLNPOLS.FLAG = ''NEW'' or exp_SMLNPOLS.FLAG = ''UPD'';


-- Component rtr_INS_UPD_UPDATE, Type ROUTER Output Group UPDATE
create or replace temp table rtr_INS_UPD_UPDATE as
SELECT
exp_SMLNPOLS.SC_DWNLD_PRIORITY as SC_DWNLD_PRIORITY,
exp_SMLNPOLS.SC_SERVICE_CENTER as SC_SERVICE_CENTER,
exp_SMLNPOLS.SC_POLICY_NUM as SC_POLICY_NUM,
exp_SMLNPOLS.SC_FLT_ITEM as SC_FLT_ITEM,
exp_SMLNPOLS.SC_FILE_TYPE as SC_FILE_TYPE,
exp_SMLNPOLS.SC_REC_TRANS_CODE as SC_REC_TRANS_CODE,
exp_SMLNPOLS.SC_TRANS_DATE as SC_TRANS_DATE,
exp_SMLNPOLS.SC_TRANS_TYPE as SC_TRANS_TYPE,
exp_SMLNPOLS.PC_ALPHA_CODE as PC_ALPHA_CODE,
exp_SMLNPOLS.PC_NAME_1 as PC_NAME_1,
exp_SMLNPOLS.PC_NAME_2 as PC_NAME_2,
exp_SMLNPOLS.PC_ADDRESS_1 as PC_ADDRESS_1,
exp_SMLNPOLS.PC_ADDRESS_2 as PC_ADDRESS_2,
exp_SMLNPOLS.PC_CITYST as PC_CITYST,
exp_SMLNPOLS.PC_ZIP as PC_ZIP,
exp_SMLNPOLS.PC_TAX_CODE as PC_TAX_CODE,
exp_SMLNPOLS.PC_AGENT as PC_AGENT,
exp_SMLNPOLS.PC_MEMBER_NUMBER as PC_MEMBER_NUMBER,
exp_SMLNPOLS.PC_RATE_CODE as PC_RATE_CODE,
exp_SMLNPOLS.PC_ENCUMBRANCE as PC_ENCUMBRANCE,
exp_SMLNPOLS.PC_PREM_FIN as PC_PREM_FIN,
exp_SMLNPOLS.PC_MORT_IND as PC_MORT_IND,
exp_SMLNPOLS.PC_COMPANY as PC_COMPANY,
exp_SMLNPOLS.PC_INCEPT_DATE as PC_INCEPT_DATE,
exp_SMLNPOLS.PC_EXP_DATE as PC_EXP_DATE,
exp_SMLNPOLS.PC_EFF_DATE as PC_EFF_DATE,
exp_SMLNPOLS.PC_STATUS as PC_STATUS,
exp_SMLNPOLS.SMLN_TOT_PREM as SMLN_TOT_PREM,
exp_SMLNPOLS.SMLN_REWRITE_IND as SMLN_REWRITE_IND,
exp_SMLNPOLS.SMLN_REWRITE_DT as SMLN_REWRITE_DT,
exp_SMLNPOLS.SMLN_OUTST_AMT as SMLN_OUTST_AMT,
exp_SMLNPOLS.SMLN_OUTST_TYPE as SMLN_OUTST_TYPE,
exp_SMLNPOLS.SMLN_OUTST_DATE as SMLN_OUTST_DATE,
exp_SMLNPOLS.SMLN_OUTST_PD_DATE as SMLN_OUTST_PD_DATE,
exp_SMLNPOLS.SMLN_SUSPENSE_CD as SMLN_SUSPENSE_CD,
exp_SMLNPOLS.SMLN_SUSPENSE_CAN as SMLN_SUSPENSE_CAN,
exp_SMLNPOLS.SMLN_SSN_1 as SMLN_SSN_1,
exp_SMLNPOLS.SMLN_SSN_2 as SMLN_SSN_2,
exp_SMLNPOLS.SMLN_UW_REVIEW_DT as SMLN_UW_REVIEW_DT,
exp_SMLNPOLS.SMLN_UW_INITIALS as SMLN_UW_INITIALS,
exp_SMLNPOLS.SMLN_MORT_NAME_1 as SMLN_MORT_NAME_1,
exp_SMLNPOLS.SMLN_MORT_NAME_2 as SMLN_MORT_NAME_2,
exp_SMLNPOLS.SMLN_MORT_ADD_1 as SMLN_MORT_ADD_1,
exp_SMLNPOLS.SMLN_MORT_ADD_2 as SMLN_MORT_ADD_2,
exp_SMLNPOLS.SMLN_MORT_CTYST as SMLN_MORT_CTYST,
exp_SMLNPOLS.SMLN_MORT_ZIP as SMLN_MORT_ZIP,
exp_SMLNPOLS.SMLN_STATE as SMLN_STATE,
exp_SMLNPOLS.SMLN_MORT_TYPE as SMLN_MORT_TYPE,
exp_SMLNPOLS.SMLN_CANC_CODE as SMLN_CANC_CODE,
exp_SMLNPOLS.SMLN_SP5_ENDR_IND as SMLN_SP5_ENDR_IND,
exp_SMLNPOLS.SMLN_LOAN_NUM as SMLN_LOAN_NUM,
exp_SMLNPOLS.SMLN_SLOAN_NUM as SMLN_SLOAN_NUM,
exp_SMLNPOLS.SMLN_SMORT_NAME_1 as SMLN_SMORT_NAME_1,
exp_SMLNPOLS.SMLN_SMORT_NAME_2 as SMLN_SMORT_NAME_2,
exp_SMLNPOLS.SMLN_SMORT_ADD_1 as SMLN_SMORT_ADD_1,
exp_SMLNPOLS.SMLN_SMORT_ADD_2 as SMLN_SMORT_ADD_2,
exp_SMLNPOLS.SMLN_SMORT_CTYST as SMLN_SMORT_CTYST,
exp_SMLNPOLS.SMLN_SMORT_ZIP as SMLN_SMORT_ZIP,
exp_SMLNPOLS.SMLN_SMORT_TYPE as SMLN_SMORT_TYPE,
exp_SMLNPOLS.SMLN_PREMIUM_1 as SMLN_PREMIUM_1,
exp_SMLNPOLS.SMLN_PREMIUM_2 as SMLN_PREMIUM_2,
exp_SMLNPOLS.SMLN_PREMIUM_3 as SMLN_PREMIUM_3,
exp_SMLNPOLS.SMLN_PREMIUM_4 as SMLN_PREMIUM_4,
exp_SMLNPOLS.SMLN_PREMIUM_5 as SMLN_PREMIUM_5,
exp_SMLNPOLS.SMLN_PREMIUM_6 as SMLN_PREMIUM_6,
exp_SMLNPOLS.SMLN_PREMIUM_7 as SMLN_PREMIUM_7,
exp_SMLNPOLS.SMLN_COVERAGE_1 as SMLN_COVERAGE_1,
exp_SMLNPOLS.SMLN_COVERAGE_2 as SMLN_COVERAGE_2,
exp_SMLNPOLS.SMLN_COVERAGE_3 as SMLN_COVERAGE_3,
exp_SMLNPOLS.SMLN_COVERAGE_4 as SMLN_COVERAGE_4,
exp_SMLNPOLS.SMLN_COVERAGE_5 as SMLN_COVERAGE_5,
exp_SMLNPOLS.SMLN_COVERAGE_6 as SMLN_COVERAGE_6,
exp_SMLNPOLS.SMLN_COVERAGE_7 as SMLN_COVERAGE_7,
exp_SMLNPOLS.SMLN_COVERAGE_8 as SMLN_COVERAGE_8,
exp_SMLNPOLS.SMLN_T_MODEL_YEAR as SMLN_T_MODEL_YEAR,
exp_SMLNPOLS.SMLN_T_MAKE as SMLN_T_MAKE,
exp_SMLNPOLS.SMLN_T_OCCUPANCY as SMLN_T_OCCUPANCY,
exp_SMLNPOLS.SMLN_T_UNDERPIN as SMLN_T_UNDERPIN,
exp_SMLNPOLS.SMLN_T_CLASS as SMLN_T_CLASS,
exp_SMLNPOLS.SMLN_POL_TYPE as SMLN_POL_TYPE,
exp_SMLNPOLS.SMLN_SP_BT_CLASS as SMLN_SP_BT_CLASS,
exp_SMLNPOLS.SMLN_FC_NUM_ACRES as SMLN_FC_NUM_ACRES,
exp_SMLNPOLS.SMLN_FC_NUM_EMP as SMLN_FC_NUM_EMP,
exp_SMLNPOLS.SMLN_FC_PAYROLL as SMLN_FC_PAYROLL,
exp_SMLNPOLS.SMLN_FC_CUST_FARM as SMLN_FC_CUST_FARM,
exp_SMLNPOLS.SMLN_FC_ADD_PREM as SMLN_FC_ADD_PREM,
exp_SMLNPOLS.SMLN_FC_RES_MAINT as SMLN_FC_RES_MAINT,
exp_SMLNPOLS.SMLN_FC_ADD_INSRD as SMLN_FC_ADD_INSRD,
exp_SMLNPOLS.SMLN_FC_ADD_RENT as SMLN_FC_ADD_RENT,
exp_SMLNPOLS.SMLN_DEDUCTIBLE as SMLN_DEDUCTIBLE,
exp_SMLNPOLS.SMLN_HALF_TERM_BP as SMLN_HALF_TERM_BP,
exp_SMLNPOLS.SMLN_FULL_TERM_BP as SMLN_FULL_TERM_BP,
exp_SMLNPOLS.SMLN_TRANSFER_DATE as SMLN_TRANSFER_DATE,
exp_SMLNPOLS.SMLN_MB_TYPE as SMLN_MB_TYPE,
exp_SMLNPOLS.SMLN_MB_ACCT_NUM as SMLN_MB_ACCT_NUM,
exp_SMLNPOLS.SMLN_SC_LIAB_PRD_I as SMLN_SC_LIAB_PRD_I,
exp_SMLNPOLS.SMLN_GL_COV_TYPE as SMLN_GL_COV_TYPE,
exp_SMLNPOLS.LOAD_DT as LOAD_DT,
exp_SMLNPOLS.FEED_IND as FEED_IND,
exp_SMLNPOLS.out_ECTL_PRGM_ID as out_ECTL_PRGM_ID,
exp_SMLNPOLS.out_ECTL_SRC_ID as out_ECTL_SRC_ID,
exp_SMLNPOLS.out_ECTL_SRC_INST_ID as out_ECTL_SRC_INST_ID,
exp_SMLNPOLS.out_ECTL_BATCH_ID as out_ECTL_BATCH_ID,
exp_SMLNPOLS.out_ORIG_INS_TS as out_ORIG_INS_TS,
exp_SMLNPOLS.out_ECTL_BATCH_START_DATE as out_ECTL_BATCH_START_DATE,
exp_SMLNPOLS.FLAG as FLAG,
exp_SMLNPOLS.SC_POLICY_NUM_LKP as SC_POLICY_NUM_LKP,
exp_SMLNPOLS.CHG_EFF_DT_LKP as CHG_EFF_DT_LKP,
exp_SMLNPOLS.source_record_id
FROM
exp_SMLNPOLS
WHERE exp_SMLNPOLS.FLAG = ''UPD'';


-- Component exp_GET_EXP_DATE, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_GET_EXP_DATE AS
(
SELECT
rtr_INS_UPD_UPDATE.SC_POLICY_NUM_LKP as SC_POLICY_NUM3,
rtr_INS_UPD_UPDATE.CHG_EFF_DT_LKP as CHG_EFF_DT,
TO_CHAR ( ( DATE_PART(''YYYY'', TO_TIMESTAMP(rtr_INS_UPD_UPDATE.LOAD_DT)) * 10000 ) + ( DATE_PART(''MM'', TO_TIMESTAMP(rtr_INS_UPD_UPDATE.LOAD_DT)) * 100 ) + 1 ) as var_FIRST_DAY_EFF_DT,
 TO_DATE ( var_FIRST_DAY_EFF_DT ) - 1  as var_CHG_EXP_DT_NEW,
CASE WHEN rtr_INS_UPD_UPDATE.CHG_EFF_DT_LKP >= TO_DATE ( var_FIRST_DAY_EFF_DT , ''YYYYMMDD'' ) THEN rtr_INS_UPD_UPDATE.CHG_EFF_DT_LKP ELSE var_CHG_EXP_DT_NEW END as out_CHG_EXP_DT_NEW,
rtr_INS_UPD_UPDATE.SC_FLT_ITEM as SC_FLT_ITEM3,
rtr_INS_UPD_UPDATE.out_ECTL_BATCH_ID as out_ECTL_BATCH_ID3,
rtr_INS_UPD_UPDATE.out_ORIG_INS_TS as out_ORIG_INS_TS3,
CURRENT_TIMESTAMP as ECTL_END_DATE,
rtr_INS_UPD_UPDATE.FLAG as FLAG3,
rtr_INS_UPD_UPDATE.source_record_id
FROM
rtr_INS_UPD_UPDATE
);


-- Component exp_GET_EFF_DATE, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_GET_EFF_DATE AS
(
SELECT
rtr_INS_UPD_INSERT.SC_DWNLD_PRIORITY as SC_DWNLD_PRIORITY1,
rtr_INS_UPD_INSERT.SC_SERVICE_CENTER as SC_SERVICE_CENTER1,
rtr_INS_UPD_INSERT.SC_POLICY_NUM as SC_POLICY_NUM1,
TO_CHAR ( ( DATE_PART(''YYYY'', TO_TIMESTAMP(rtr_INS_UPD_INSERT.LOAD_DT)) * 10000 ) + ( DATE_PART(''MM'', TO_TIMESTAMP(rtr_INS_UPD_INSERT.LOAD_DT)) * 100 ) + 1 ) as var_FIRST_DAY_EFF_DT,
TO_DATE ( var_FIRST_DAY_EFF_DT , ''YYYYMMDD'' ) as var_CHG_EFF_DT,
CASE WHEN rtr_INS_UPD_INSERT.CHG_EFF_DT_LKP >= var_CHG_EFF_DT THEN  rtr_INS_UPD_INSERT.CHG_EFF_DT_LKP + 1  ELSE var_CHG_EFF_DT END as out_CHG_EFF_DT,
TO_DATE ( ''9999-12-31'' , ''YYYY-MM-DD'' ) as CHG_EXP_DT,
rtr_INS_UPD_INSERT.SC_FLT_ITEM as SC_FLT_ITEM1,
rtr_INS_UPD_INSERT.SC_FILE_TYPE as SC_FILE_TYPE1,
rtr_INS_UPD_INSERT.SC_REC_TRANS_CODE as SC_REC_TRANS_CODE1,
rtr_INS_UPD_INSERT.SC_TRANS_DATE as SC_TRANS_DATE1,
rtr_INS_UPD_INSERT.SC_TRANS_TYPE as SC_TRANS_TYPE1,
rtr_INS_UPD_INSERT.PC_ALPHA_CODE as PC_ALPHA_CODE1,
rtr_INS_UPD_INSERT.PC_NAME_1 as PC_NAME_11,
rtr_INS_UPD_INSERT.PC_NAME_2 as PC_NAME_21,
rtr_INS_UPD_INSERT.PC_ADDRESS_1 as PC_ADDRESS_11,
rtr_INS_UPD_INSERT.PC_ADDRESS_2 as PC_ADDRESS_21,
rtr_INS_UPD_INSERT.PC_CITYST as PC_CITYST1,
rtr_INS_UPD_INSERT.PC_ZIP as PC_ZIP1,
rtr_INS_UPD_INSERT.PC_TAX_CODE as PC_TAX_CODE1,
rtr_INS_UPD_INSERT.PC_AGENT as PC_AGENT1,
rtr_INS_UPD_INSERT.PC_MEMBER_NUMBER as PC_MEMBER_NUMBER1,
rtr_INS_UPD_INSERT.PC_RATE_CODE as PC_RATE_CODE1,
rtr_INS_UPD_INSERT.PC_ENCUMBRANCE as PC_ENCUMBRANCE1,
rtr_INS_UPD_INSERT.PC_PREM_FIN as PC_PREM_FIN1,
rtr_INS_UPD_INSERT.PC_MORT_IND as PC_MORT_IND1,
rtr_INS_UPD_INSERT.PC_COMPANY as PC_COMPANY1,
rtr_INS_UPD_INSERT.PC_INCEPT_DATE as PC_INCEPT_DATE1,
rtr_INS_UPD_INSERT.PC_EXP_DATE as PC_EXP_DATE1,
rtr_INS_UPD_INSERT.PC_EFF_DATE as PC_EFF_DATE1,
rtr_INS_UPD_INSERT.PC_STATUS as PC_STATUS1,
rtr_INS_UPD_INSERT.SMLN_TOT_PREM as SMLN_TOT_PREM1,
rtr_INS_UPD_INSERT.SMLN_REWRITE_IND as SMLN_REWRITE_IND1,
rtr_INS_UPD_INSERT.SMLN_REWRITE_DT as SMLN_REWRITE_DT1,
rtr_INS_UPD_INSERT.SMLN_OUTST_AMT as SMLN_OUTST_AMT1,
rtr_INS_UPD_INSERT.SMLN_OUTST_TYPE as SMLN_OUTST_TYPE1,
rtr_INS_UPD_INSERT.SMLN_OUTST_DATE as SMLN_OUTST_DATE1,
rtr_INS_UPD_INSERT.SMLN_OUTST_PD_DATE as SMLN_OUTST_PD_DATE1,
rtr_INS_UPD_INSERT.SMLN_SUSPENSE_CD as SMLN_SUSPENSE_CD1,
rtr_INS_UPD_INSERT.SMLN_SUSPENSE_CAN as SMLN_SUSPENSE_CAN1,
rtr_INS_UPD_INSERT.SMLN_SSN_1 as SMLN_SSN_11,
rtr_INS_UPD_INSERT.SMLN_SSN_2 as SMLN_SSN_21,
rtr_INS_UPD_INSERT.SMLN_UW_REVIEW_DT as SMLN_UW_REVIEW_DT1,
rtr_INS_UPD_INSERT.SMLN_UW_INITIALS as SMLN_UW_INITIALS1,
rtr_INS_UPD_INSERT.SMLN_MORT_NAME_1 as SMLN_MORT_NAME_11,
rtr_INS_UPD_INSERT.SMLN_MORT_NAME_2 as SMLN_MORT_NAME_21,
rtr_INS_UPD_INSERT.SMLN_MORT_ADD_1 as SMLN_MORT_ADD_11,
rtr_INS_UPD_INSERT.SMLN_MORT_ADD_2 as SMLN_MORT_ADD_21,
rtr_INS_UPD_INSERT.SMLN_MORT_CTYST as SMLN_MORT_CTYST1,
rtr_INS_UPD_INSERT.SMLN_MORT_ZIP as SMLN_MORT_ZIP1,
rtr_INS_UPD_INSERT.SMLN_STATE as SMLN_STATE1,
rtr_INS_UPD_INSERT.SMLN_MORT_TYPE as SMLN_MORT_TYPE1,
rtr_INS_UPD_INSERT.SMLN_CANC_CODE as SMLN_CANC_CODE1,
rtr_INS_UPD_INSERT.SMLN_SP5_ENDR_IND as SMLN_SP5_ENDR_IND1,
rtr_INS_UPD_INSERT.SMLN_LOAN_NUM as SMLN_LOAN_NUM1,
rtr_INS_UPD_INSERT.SMLN_SLOAN_NUM as SMLN_SLOAN_NUM1,
rtr_INS_UPD_INSERT.SMLN_SMORT_NAME_1 as SMLN_SMORT_NAME_11,
rtr_INS_UPD_INSERT.SMLN_SMORT_NAME_2 as SMLN_SMORT_NAME_21,
rtr_INS_UPD_INSERT.SMLN_SMORT_ADD_1 as SMLN_SMORT_ADD_11,
rtr_INS_UPD_INSERT.SMLN_SMORT_ADD_2 as SMLN_SMORT_ADD_21,
rtr_INS_UPD_INSERT.SMLN_SMORT_CTYST as SMLN_SMORT_CTYST1,
rtr_INS_UPD_INSERT.SMLN_SMORT_ZIP as SMLN_SMORT_ZIP1,
rtr_INS_UPD_INSERT.SMLN_SMORT_TYPE as SMLN_SMORT_TYPE1,
rtr_INS_UPD_INSERT.SMLN_PREMIUM_1 as SMLN_PREMIUM_11,
rtr_INS_UPD_INSERT.SMLN_PREMIUM_2 as SMLN_PREMIUM_21,
rtr_INS_UPD_INSERT.SMLN_PREMIUM_3 as SMLN_PREMIUM_31,
rtr_INS_UPD_INSERT.SMLN_PREMIUM_4 as SMLN_PREMIUM_41,
rtr_INS_UPD_INSERT.SMLN_PREMIUM_5 as SMLN_PREMIUM_51,
rtr_INS_UPD_INSERT.SMLN_PREMIUM_6 as SMLN_PREMIUM_61,
rtr_INS_UPD_INSERT.SMLN_PREMIUM_7 as SMLN_PREMIUM_71,
rtr_INS_UPD_INSERT.SMLN_COVERAGE_1 as SMLN_COVERAGE_11,
rtr_INS_UPD_INSERT.SMLN_COVERAGE_2 as SMLN_COVERAGE_21,
rtr_INS_UPD_INSERT.SMLN_COVERAGE_3 as SMLN_COVERAGE_31,
rtr_INS_UPD_INSERT.SMLN_COVERAGE_4 as SMLN_COVERAGE_41,
rtr_INS_UPD_INSERT.SMLN_COVERAGE_5 as SMLN_COVERAGE_51,
rtr_INS_UPD_INSERT.SMLN_COVERAGE_6 as SMLN_COVERAGE_61,
rtr_INS_UPD_INSERT.SMLN_COVERAGE_7 as SMLN_COVERAGE_71,
rtr_INS_UPD_INSERT.SMLN_COVERAGE_8 as SMLN_COVERAGE_81,
rtr_INS_UPD_INSERT.SMLN_T_MODEL_YEAR as SMLN_T_MODEL_YEAR1,
rtr_INS_UPD_INSERT.SMLN_T_MAKE as SMLN_T_MAKE1,
rtr_INS_UPD_INSERT.SMLN_T_OCCUPANCY as SMLN_T_OCCUPANCY1,
rtr_INS_UPD_INSERT.SMLN_T_UNDERPIN as SMLN_T_UNDERPIN1,
rtr_INS_UPD_INSERT.SMLN_T_CLASS as SMLN_T_CLASS1,
rtr_INS_UPD_INSERT.SMLN_POL_TYPE as SMLN_POL_TYPE1,
rtr_INS_UPD_INSERT.SMLN_SP_BT_CLASS as SMLN_SP_BT_CLASS1,
rtr_INS_UPD_INSERT.SMLN_FC_NUM_ACRES as SMLN_FC_NUM_ACRES1,
rtr_INS_UPD_INSERT.SMLN_FC_NUM_EMP as SMLN_FC_NUM_EMP1,
rtr_INS_UPD_INSERT.SMLN_FC_PAYROLL as SMLN_FC_PAYROLL1,
rtr_INS_UPD_INSERT.SMLN_FC_CUST_FARM as SMLN_FC_CUST_FARM1,
rtr_INS_UPD_INSERT.SMLN_FC_ADD_PREM as SMLN_FC_ADD_PREM1,
rtr_INS_UPD_INSERT.SMLN_FC_RES_MAINT as SMLN_FC_RES_MAINT1,
rtr_INS_UPD_INSERT.SMLN_FC_ADD_INSRD as SMLN_FC_ADD_INSRD1,
rtr_INS_UPD_INSERT.SMLN_FC_ADD_RENT as SMLN_FC_ADD_RENT1,
rtr_INS_UPD_INSERT.SMLN_DEDUCTIBLE as SMLN_DEDUCTIBLE1,
rtr_INS_UPD_INSERT.SMLN_HALF_TERM_BP as SMLN_HALF_TERM_BP1,
rtr_INS_UPD_INSERT.SMLN_FULL_TERM_BP as SMLN_FULL_TERM_BP1,
rtr_INS_UPD_INSERT.SMLN_TRANSFER_DATE as SMLN_TRANSFER_DATE1,
rtr_INS_UPD_INSERT.SMLN_MB_TYPE as SMLN_MB_TYPE1,
rtr_INS_UPD_INSERT.SMLN_MB_ACCT_NUM as SMLN_MB_ACCT_NUM1,
rtr_INS_UPD_INSERT.SMLN_SC_LIAB_PRD_I as SMLN_SC_LIAB_PRD_I1,
rtr_INS_UPD_INSERT.SMLN_GL_COV_TYPE as SMLN_GL_COV_TYPE1,
rtr_INS_UPD_INSERT.FEED_IND as FEED_IND1,
rtr_INS_UPD_INSERT.out_ECTL_BATCH_ID as out_ECTL_BATCH_ID1,
rtr_INS_UPD_INSERT.out_ORIG_INS_TS as out_ORIG_INS_TS1,
rtr_INS_UPD_INSERT.out_ECTL_SRC_ID as out_ECTL_SRC_ID1,
rtr_INS_UPD_INSERT.out_ECTL_SRC_INST_ID as out_ECTL_SRC_INST_ID1,
rtr_INS_UPD_INSERT.out_ECTL_PRGM_ID as out_ECTL_PRGM_ID1,
''NEW'' as ECTL_TX_CD,
rtr_INS_UPD_INSERT.out_ECTL_BATCH_START_DATE as out_ECTL_BATCH_START_DATE1,
TO_DATE ( ''9999-12-31'' , ''YYYY-MM-DD'' ) as out_ECTL_END_DATE,
rtr_INS_UPD_INSERT.source_record_id
FROM
rtr_INS_UPD_INSERT
);


-- Component upd_SMLNPOLS, Type UPDATE 
CREATE OR REPLACE TEMPORARY TABLE upd_SMLNPOLS AS
(
/* UPDATE_STRATEGY_ACTION = 0 FOR INSERT / UPDATE_STRATEGY_ACTION = 1 FOR UPDATE / UPDATE_STRATEGY_ACTION = 2 FOR DELETE / UPDATE_STRATEGY_ACTION = 3 FOR REJECT */
SELECT
exp_GET_EXP_DATE.SC_POLICY_NUM3 as SC_POLICY_NUM3,
exp_GET_EXP_DATE.CHG_EFF_DT as CHG_EFF_DT,
exp_GET_EXP_DATE.out_CHG_EXP_DT_NEW as CHG_EXP_DT,
exp_GET_EXP_DATE.SC_FLT_ITEM3 as SC_FLT_ITEM3,
exp_GET_EXP_DATE.out_ECTL_BATCH_ID3 as out_ECTL_BATCH_ID3,
exp_GET_EXP_DATE.out_ORIG_INS_TS3 as out_ORIG_INS_TS3,
exp_GET_EXP_DATE.ECTL_END_DATE as ECTL_END_DATE,
exp_GET_EXP_DATE.FLAG3 as FLAG3,
1 as UPDATE_STRATEGY_ACTION
FROM
exp_GET_EXP_DATE
);


-- Component SMLNPOLS_INS, Type TARGET 
INSERT INTO DB_T_CORE_MEMBXREF_PROD.SMLNPOLS
(
SC_DWNLD_PRIORITY,
SC_SERVICE_CENTER,
SC_POLICY_NUM,
CHG_EFF_DT,
CHG_EXP_DT,
SC_FLT_ITEM,
SC_FILE_TYPE,
SC_REC_TRANS_CODE,
SC_TRANS_DATE,
SC_TRANS_TYPE,
PC_ALPHA_CODE,
PC_NAME_1,
PC_NAME_2,
PC_ADDRESS_1,
PC_ADDRESS_2,
PC_CITYST,
PC_ZIP,
PC_TAX_CODE,
PC_AGENT,
PC_MEMBER_NUMBER,
PC_RATE_CODE,
PC_ENCUMBRANCE,
PC_PREM_FIN,
PC_MORT_IND,
PC_COMPANY,
PC_INCEPT_DATE,
PC_EXP_DATE,
PC_EFF_DATE,
PC_STATUS,
SMLN_TOT_PREM,
SMLN_REWRITE_IND,
SMLN_REWRITE_DT,
SMLN_OUTST_AMT,
SMLN_OUTST_TYPE,
SMLN_OUTST_DATE,
SMLN_OUTST_PD_DATE,
SMLN_SUSPENSE_CD,
SMLN_SUSPENSE_CAN,
SMLN_SSN_1,
SMLN_SSN_2,
SMLN_UW_REVIEW_DT,
SMLN_UW_INITIALS,
SMLN_MORT_NAME_1,
SMLN_MORT_NAME_2,
SMLN_MORT_ADD_1,
SMLN_MORT_ADD_2,
SMLN_MORT_CTYST,
SMLN_MORT_ZIP,
SMLN_STATE,
SMLN_MORT_TYPE,
SMLN_CANC_CODE,
SMLN_SP5_ENDR_IND,
SMLN_LOAN_NUM,
SMLN_SLOAN_NUM,
SMLN_SMORT_NAME_1,
SMLN_SMORT_NAME_2,
SMLN_SMORT_ADD_1,
SMLN_SMORT_ADD_2,
SMLN_SMORT_CTYST,
SMLN_SMORT_ZIP,
SMLN_SMORT_TYPE,
SMLN_PREMIUM_1,
SMLN_PREMIUM_2,
SMLN_PREMIUM_3,
SMLN_PREMIUM_4,
SMLN_PREMIUM_5,
SMLN_PREMIUM_6,
SMLN_PREMIUM_7,
SMLN_COVERAGE_1,
SMLN_COVERAGE_2,
SMLN_COVERAGE_3,
SMLN_COVERAGE_4,
SMLN_COVERAGE_5,
SMLN_COVERAGE_6,
SMLN_COVERAGE_7,
SMLN_COVERAGE_8,
SMLN_T_MODEL_YEAR,
SMLN_T_MAKE,
SMLN_T_OCCUPANCY,
SMLN_T_UNDERPIN,
SMLN_T_CLASS,
SMLN_POL_TYPE,
SMLN_SP_BT_CLASS,
SMLN_FC_NUM_ACRES,
SMLN_FC_NUM_EMP,
SMLN_FC_PAYROLL,
SMLN_FC_CUST_FARM,
SMLN_FC_ADD_PREM,
SMLN_FC_RES_MAINT,
SMLN_FC_ADD_INSRD,
SMLN_FC_ADD_RENT,
SMLN_DEDUCTIBLE,
SMLN_HALF_TERM_BP,
SMLN_FULL_TERM_BP,
SMLN_TRANSFER_DATE,
SMLN_MB_TYPE,
SMLN_MB_ACCT_NUM,
SMLN_SC_LIAB_PRD_I,
SMLN_GL_COV_TYPE,
FEED_IND,
ECTL_BATCH_ID,
ECTL_ORIG_INS_TS,
ECTL_MODIFY_TS,
ECTL_SRC_ID,
ECTL_SRC_INST_ID,
ECTL_PRGM_ID,
ECTL_TX_CD,
ECTL_START_DATE,
ECTL_END_DATE
)
SELECT
exp_GET_EFF_DATE.SC_DWNLD_PRIORITY1 as SC_DWNLD_PRIORITY,
exp_GET_EFF_DATE.SC_SERVICE_CENTER1 as SC_SERVICE_CENTER,
exp_GET_EFF_DATE.SC_POLICY_NUM1 as SC_POLICY_NUM,
exp_GET_EFF_DATE.out_CHG_EFF_DT as CHG_EFF_DT,
exp_GET_EFF_DATE.CHG_EXP_DT as CHG_EXP_DT,
exp_GET_EFF_DATE.SC_FLT_ITEM1 as SC_FLT_ITEM,
exp_GET_EFF_DATE.SC_FILE_TYPE1 as SC_FILE_TYPE,
exp_GET_EFF_DATE.SC_REC_TRANS_CODE1 as SC_REC_TRANS_CODE,
exp_GET_EFF_DATE.SC_TRANS_DATE1 as SC_TRANS_DATE,
exp_GET_EFF_DATE.SC_TRANS_TYPE1 as SC_TRANS_TYPE,
exp_GET_EFF_DATE.PC_ALPHA_CODE1 as PC_ALPHA_CODE,
exp_GET_EFF_DATE.PC_NAME_11 as PC_NAME_1,
exp_GET_EFF_DATE.PC_NAME_21 as PC_NAME_2,
exp_GET_EFF_DATE.PC_ADDRESS_11 as PC_ADDRESS_1,
exp_GET_EFF_DATE.PC_ADDRESS_21 as PC_ADDRESS_2,
exp_GET_EFF_DATE.PC_CITYST1 as PC_CITYST,
exp_GET_EFF_DATE.PC_ZIP1 as PC_ZIP,
exp_GET_EFF_DATE.PC_TAX_CODE1 as PC_TAX_CODE,
exp_GET_EFF_DATE.PC_AGENT1 as PC_AGENT,
exp_GET_EFF_DATE.PC_MEMBER_NUMBER1 as PC_MEMBER_NUMBER,
exp_GET_EFF_DATE.PC_RATE_CODE1 as PC_RATE_CODE,
exp_GET_EFF_DATE.PC_ENCUMBRANCE1 as PC_ENCUMBRANCE,
exp_GET_EFF_DATE.PC_PREM_FIN1 as PC_PREM_FIN,
exp_GET_EFF_DATE.PC_MORT_IND1 as PC_MORT_IND,
exp_GET_EFF_DATE.PC_COMPANY1 as PC_COMPANY,
exp_GET_EFF_DATE.PC_INCEPT_DATE1 as PC_INCEPT_DATE,
exp_GET_EFF_DATE.PC_EXP_DATE1 as PC_EXP_DATE,
exp_GET_EFF_DATE.PC_EFF_DATE1 as PC_EFF_DATE,
exp_GET_EFF_DATE.PC_STATUS1 as PC_STATUS,
exp_GET_EFF_DATE.SMLN_TOT_PREM1 as SMLN_TOT_PREM,
exp_GET_EFF_DATE.SMLN_REWRITE_IND1 as SMLN_REWRITE_IND,
exp_GET_EFF_DATE.SMLN_REWRITE_DT1 as SMLN_REWRITE_DT,
exp_GET_EFF_DATE.SMLN_OUTST_AMT1 as SMLN_OUTST_AMT,
exp_GET_EFF_DATE.SMLN_OUTST_TYPE1 as SMLN_OUTST_TYPE,
exp_GET_EFF_DATE.SMLN_OUTST_DATE1 as SMLN_OUTST_DATE,
exp_GET_EFF_DATE.SMLN_OUTST_PD_DATE1 as SMLN_OUTST_PD_DATE,
exp_GET_EFF_DATE.SMLN_SUSPENSE_CD1 as SMLN_SUSPENSE_CD,
exp_GET_EFF_DATE.SMLN_SUSPENSE_CAN1 as SMLN_SUSPENSE_CAN,
exp_GET_EFF_DATE.SMLN_SSN_11 as SMLN_SSN_1,
exp_GET_EFF_DATE.SMLN_SSN_21 as SMLN_SSN_2,
exp_GET_EFF_DATE.SMLN_UW_REVIEW_DT1 as SMLN_UW_REVIEW_DT,
exp_GET_EFF_DATE.SMLN_UW_INITIALS1 as SMLN_UW_INITIALS,
exp_GET_EFF_DATE.SMLN_MORT_NAME_11 as SMLN_MORT_NAME_1,
exp_GET_EFF_DATE.SMLN_MORT_NAME_21 as SMLN_MORT_NAME_2,
exp_GET_EFF_DATE.SMLN_MORT_ADD_11 as SMLN_MORT_ADD_1,
exp_GET_EFF_DATE.SMLN_MORT_ADD_21 as SMLN_MORT_ADD_2,
exp_GET_EFF_DATE.SMLN_MORT_CTYST1 as SMLN_MORT_CTYST,
exp_GET_EFF_DATE.SMLN_MORT_ZIP1 as SMLN_MORT_ZIP,
exp_GET_EFF_DATE.SMLN_STATE1 as SMLN_STATE,
exp_GET_EFF_DATE.SMLN_MORT_TYPE1 as SMLN_MORT_TYPE,
exp_GET_EFF_DATE.SMLN_CANC_CODE1 as SMLN_CANC_CODE,
exp_GET_EFF_DATE.SMLN_SP5_ENDR_IND1 as SMLN_SP5_ENDR_IND,
exp_GET_EFF_DATE.SMLN_LOAN_NUM1 as SMLN_LOAN_NUM,
exp_GET_EFF_DATE.SMLN_SLOAN_NUM1 as SMLN_SLOAN_NUM,
exp_GET_EFF_DATE.SMLN_SMORT_NAME_11 as SMLN_SMORT_NAME_1,
exp_GET_EFF_DATE.SMLN_SMORT_NAME_21 as SMLN_SMORT_NAME_2,
exp_GET_EFF_DATE.SMLN_SMORT_ADD_11 as SMLN_SMORT_ADD_1,
exp_GET_EFF_DATE.SMLN_SMORT_ADD_21 as SMLN_SMORT_ADD_2,
exp_GET_EFF_DATE.SMLN_SMORT_CTYST1 as SMLN_SMORT_CTYST,
exp_GET_EFF_DATE.SMLN_SMORT_ZIP1 as SMLN_SMORT_ZIP,
exp_GET_EFF_DATE.SMLN_SMORT_TYPE1 as SMLN_SMORT_TYPE,
exp_GET_EFF_DATE.SMLN_PREMIUM_11 as SMLN_PREMIUM_1,
exp_GET_EFF_DATE.SMLN_PREMIUM_21 as SMLN_PREMIUM_2,
exp_GET_EFF_DATE.SMLN_PREMIUM_31 as SMLN_PREMIUM_3,
exp_GET_EFF_DATE.SMLN_PREMIUM_41 as SMLN_PREMIUM_4,
exp_GET_EFF_DATE.SMLN_PREMIUM_51 as SMLN_PREMIUM_5,
exp_GET_EFF_DATE.SMLN_PREMIUM_61 as SMLN_PREMIUM_6,
exp_GET_EFF_DATE.SMLN_PREMIUM_71 as SMLN_PREMIUM_7,
exp_GET_EFF_DATE.SMLN_COVERAGE_11 as SMLN_COVERAGE_1,
exp_GET_EFF_DATE.SMLN_COVERAGE_21 as SMLN_COVERAGE_2,
exp_GET_EFF_DATE.SMLN_COVERAGE_31 as SMLN_COVERAGE_3,
exp_GET_EFF_DATE.SMLN_COVERAGE_41 as SMLN_COVERAGE_4,
exp_GET_EFF_DATE.SMLN_COVERAGE_51 as SMLN_COVERAGE_5,
exp_GET_EFF_DATE.SMLN_COVERAGE_61 as SMLN_COVERAGE_6,
exp_GET_EFF_DATE.SMLN_COVERAGE_71 as SMLN_COVERAGE_7,
exp_GET_EFF_DATE.SMLN_COVERAGE_81 as SMLN_COVERAGE_8,
exp_GET_EFF_DATE.SMLN_T_MODEL_YEAR1 as SMLN_T_MODEL_YEAR,
exp_GET_EFF_DATE.SMLN_T_MAKE1 as SMLN_T_MAKE,
exp_GET_EFF_DATE.SMLN_T_OCCUPANCY1 as SMLN_T_OCCUPANCY,
exp_GET_EFF_DATE.SMLN_T_UNDERPIN1 as SMLN_T_UNDERPIN,
exp_GET_EFF_DATE.SMLN_T_CLASS1 as SMLN_T_CLASS,
exp_GET_EFF_DATE.SMLN_POL_TYPE1 as SMLN_POL_TYPE,
exp_GET_EFF_DATE.SMLN_SP_BT_CLASS1 as SMLN_SP_BT_CLASS,
exp_GET_EFF_DATE.SMLN_FC_NUM_ACRES1 as SMLN_FC_NUM_ACRES,
exp_GET_EFF_DATE.SMLN_FC_NUM_EMP1 as SMLN_FC_NUM_EMP,
exp_GET_EFF_DATE.SMLN_FC_PAYROLL1 as SMLN_FC_PAYROLL,
exp_GET_EFF_DATE.SMLN_FC_CUST_FARM1 as SMLN_FC_CUST_FARM,
exp_GET_EFF_DATE.SMLN_FC_ADD_PREM1 as SMLN_FC_ADD_PREM,
exp_GET_EFF_DATE.SMLN_FC_RES_MAINT1 as SMLN_FC_RES_MAINT,
exp_GET_EFF_DATE.SMLN_FC_ADD_INSRD1 as SMLN_FC_ADD_INSRD,
exp_GET_EFF_DATE.SMLN_FC_ADD_RENT1 as SMLN_FC_ADD_RENT,
exp_GET_EFF_DATE.SMLN_DEDUCTIBLE1 as SMLN_DEDUCTIBLE,
exp_GET_EFF_DATE.SMLN_HALF_TERM_BP1 as SMLN_HALF_TERM_BP,
exp_GET_EFF_DATE.SMLN_FULL_TERM_BP1 as SMLN_FULL_TERM_BP,
exp_GET_EFF_DATE.SMLN_TRANSFER_DATE1 as SMLN_TRANSFER_DATE,
exp_GET_EFF_DATE.SMLN_MB_TYPE1 as SMLN_MB_TYPE,
exp_GET_EFF_DATE.SMLN_MB_ACCT_NUM1 as SMLN_MB_ACCT_NUM,
exp_GET_EFF_DATE.SMLN_SC_LIAB_PRD_I1 as SMLN_SC_LIAB_PRD_I,
exp_GET_EFF_DATE.SMLN_GL_COV_TYPE1 as SMLN_GL_COV_TYPE,
exp_GET_EFF_DATE.FEED_IND1 as FEED_IND,
nvl(exp_GET_EFF_DATE.out_ECTL_BATCH_ID1,''1'') as ECTL_BATCH_ID,
nvl(exp_GET_EFF_DATE.out_ORIG_INS_TS1,''1900-01-01'') as ECTL_ORIG_INS_TS,
nvl(exp_GET_EFF_DATE.out_ORIG_INS_TS1,''1900-01-01'') as ECTL_MODIFY_TS,
nvl(exp_GET_EFF_DATE.out_ECTL_SRC_ID1,''1'') as ECTL_SRC_ID,
nvl(exp_GET_EFF_DATE.out_ECTL_SRC_INST_ID1,''1'') as ECTL_SRC_INST_ID,
nvl(exp_GET_EFF_DATE.out_ECTL_PRGM_ID1,''1'') as ECTL_PRGM_ID,
nvl(exp_GET_EFF_DATE.ECTL_TX_CD,''1'') as ECTL_TX_CD,
nvl(exp_GET_EFF_DATE.out_ECTL_BATCH_START_DATE1,''1900-01-01'') as ECTL_START_DATE,
nvl(exp_GET_EFF_DATE.out_ECTL_END_DATE,''1900-01-01'') as ECTL_END_DATE
FROM
exp_GET_EFF_DATE;


-- Component SMLNPOLS_UPD, Type TARGET 
INSERT INTO DB_T_CORE_MEMBXREF_PROD.SMLNPOLS
(
SC_POLICY_NUM,
CHG_EFF_DT,
CHG_EXP_DT,
SC_FLT_ITEM,
ECTL_BATCH_ID,
ECTL_ORIG_INS_TS,
ECTL_MODIFY_TS,
ECTL_TX_CD,
ECTL_END_DATE
)
SELECT
upd_SMLNPOLS.SC_POLICY_NUM3 as SC_POLICY_NUM,
upd_SMLNPOLS.CHG_EFF_DT as CHG_EFF_DT,
upd_SMLNPOLS.CHG_EXP_DT as CHG_EXP_DT,
upd_SMLNPOLS.SC_FLT_ITEM3 as SC_FLT_ITEM,
nvl(upd_SMLNPOLS.out_ECTL_BATCH_ID3,''1'') as ECTL_BATCH_ID,
nvl(upd_SMLNPOLS.out_ORIG_INS_TS3,''1900-01-01'') as ECTL_ORIG_INS_TS,
nvl(upd_SMLNPOLS.out_ORIG_INS_TS3,''1900-01-01'') as ECTL_MODIFY_TS,
nvl(upd_SMLNPOLS.FLAG3,''1'') as ECTL_TX_CD,
nvl(upd_SMLNPOLS.ECTL_END_DATE,''1900-01-01'') as ECTL_END_DATE
FROM
upd_SMLNPOLS
WHERE UPDATE_STRATEGY_ACTION = 0;

/* Perform Updates */
MERGE INTO 
 DB_T_CORE_MEMBXREF_PROD.SMLNPOLS
USING (select * from upd_SMLNPOLS ) upd_SMLNPOLS ON (UPDATE_STRATEGY_ACTION = 0 and DB_T_CORE_MEMBXREF_PROD.SMLNPOLS.SC_POLICY_NUM = upd_SMLNPOLS.SC_POLICY_NUM3 and DB_T_CORE_MEMBXREF_PROD.SMLNPOLS.CHG_EFF_DT = upd_SMLNPOLS.CHG_EFF_DT)
WHEN MATCHED THEN UPDATE
SET
SC_POLICY_NUM = upd_SMLNPOLS.SC_POLICY_NUM3,
CHG_EFF_DT = upd_SMLNPOLS.CHG_EFF_DT,
CHG_EXP_DT = upd_SMLNPOLS.CHG_EXP_DT,
SC_FLT_ITEM = upd_SMLNPOLS.SC_FLT_ITEM3,
ECTL_BATCH_ID = nvl(upd_SMLNPOLS.out_ECTL_BATCH_ID3,''1''),
ECTL_ORIG_INS_TS = nvl(upd_SMLNPOLS.out_ORIG_INS_TS3,''1900-01-01''),
ECTL_MODIFY_TS = nvl(upd_SMLNPOLS.out_ORIG_INS_TS3,''1900-01-01''),
ECTL_TX_CD = nvl(upd_SMLNPOLS.FLAG3,''1''),
ECTL_END_DATE = nvl(upd_SMLNPOLS.ECTL_END_DATE,''1900-01-01'')
;


-- PIPELINE END FOR 2

END; ';
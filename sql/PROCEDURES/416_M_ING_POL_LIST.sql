-- Object Type: PROCEDURES
CREATE OR REPLACE PROCEDURE ALFA_EDW_DEV.PUBLIC.M_ING_POL_LIST("RUN_ID" VARCHAR)
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS ' DECLARE PMMAPPINGNAME varchar;
PROJ_ID varchar;
BATCH_ACTIVE_IND varchar;
BEGIN 

PMMAPPINGNAME:=''M_ING_POL_LIST''; 
BATCH_ACTIVE_IND:=(select ectl_active_ind from DB_T_CTRL_FIN_PROD.ECTL_BATCH_INFO where ECTL_BATCH_ID= :run_id); 
PROJ_ID:=(select ectl_proj_id from DB_T_CTRL_FIN_PROD.ECTL_BATCH_INFO where ECTL_BATCH_ID= :run_id); 

-- Component LKP_STG_MEMBXREF_TRIGGER, Type Prerequisite Lookup Object 
CREATE OR REPLACE TEMPORARY TABLE LKP_STG_MEMBXREF_TRIGGER AS
(
SELECT
TABLENAME,
FEED_DT
FROM DB_T_STAG_MEMBXREF_PROD.STG_MEMBXREF_TRIGGER
);


-- PIPELINE START FOR 1

-- Component SQ_ING_POL_LIST, Type SOURCE 
CREATE OR REPLACE TEMPORARY TABLE SQ_ING_POL_LIST AS
(
SELECT /* adding column aliases to ensure proper downstream column references */
$1 as POL_ID,
$2 as CHG_EFF_DT,
$3 as source_record_id
FROM (
SELECT SRC.*, row_number() over (order by 1) AS source_record_id FROM (
SELECT ING_POL_LIST.POL_ID ,ING_POL_LIST.CHG_EFF_DT 
FROM
 DB_T_CORE_MEMBXREF_PROD.ING_POL_LIST WHERE CHG_EXP_DT = CAST(''9999-12-31'' AS DATE ) 
) SRC
)
);


-- Component exp_ASSIGN_DUMMY_TG, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_ASSIGN_DUMMY_TG AS
(
SELECT
SQ_ING_POL_LIST.POL_ID as POL_ID,
SQ_ING_POL_LIST.CHG_EFF_DT as CHG_EFF_DT,
''ING_POL_LIST'' as var_TABLENAME,
LKP_1.FEED_DT /* replaced lookup LKP_STG_MEMBXREF_TRIGGER */ as var_FEED_DT,
var_FEED_DT as out_FEED_DT,
SQ_ING_POL_LIST.source_record_id,
row_number() over (partition by SQ_ING_POL_LIST.source_record_id order by SQ_ING_POL_LIST.source_record_id) as RNK
FROM
SQ_ING_POL_LIST
LEFT JOIN LKP_STG_MEMBXREF_TRIGGER LKP_1 ON LKP_1.TABLENAME = var_TABLENAME
QUALIFY RNK = 1
);


-- Component LKP_STG_ING_POL_LIST, Type LOOKUP 
CREATE OR REPLACE TEMPORARY TABLE LKP_STG_ING_POL_LIST AS
(
SELECT
LKP.POL_ID,
exp_ASSIGN_DUMMY_TG.source_record_id,
ROW_NUMBER() OVER(PARTITION BY exp_ASSIGN_DUMMY_TG.source_record_id ORDER BY LKP.POL_ID asc) RNK
FROM
exp_ASSIGN_DUMMY_TG
LEFT JOIN (
SELECT LTRIM(RTRIM(STG_ING_POL_LIST.POL_ID)) as POL_ID FROM DB_T_STAG_MEMBXREF_PROD.STG_ING_POL_LIST WHERE
 STG_ING_POL_LIST. LOAD_DT=(SELECT FEED_DT FROM DB_T_STAG_MEMBXREF_PROD.STG_MEMBXREF_TRIGGER WHERE TABLENAME=''ING_POL_LIST'')
) LKP ON LKP.POL_ID = exp_ASSIGN_DUMMY_TG.POL_ID
QUALIFY RNK = 1
);


-- Component fil_EXPIRED_POLS, Type FILTER 
CREATE OR REPLACE TEMPORARY TABLE fil_EXPIRED_POLS AS
(
SELECT
LKP_STG_ING_POL_LIST.POL_ID as POL_ID_tgt,
exp_ASSIGN_DUMMY_TG.CHG_EFF_DT as CHG_EFF_DT,
exp_ASSIGN_DUMMY_TG.POL_ID as POL_ID_src,
exp_ASSIGN_DUMMY_TG.out_FEED_DT as LOAD_DT,
exp_ASSIGN_DUMMY_TG.source_record_id
FROM
exp_ASSIGN_DUMMY_TG
LEFT JOIN LKP_STG_ING_POL_LIST ON exp_ASSIGN_DUMMY_TG.source_record_id = LKP_STG_ING_POL_LIST.source_record_id
WHERE LKP_STG_ING_POL_LIST.POL_ID IS NULL
);


-- Component exp_INPUT_ECTL_FIELDS, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_INPUT_ECTL_FIELDS AS
(
SELECT
fil_EXPIRED_POLS.CHG_EFF_DT as CHG_EFF_DT,
fil_EXPIRED_POLS.POL_ID_src as POL_ID_src,
LTRIM ( RTRIM ( :PMMappingName ) ) as out_PROJ_NAME,
:PROJ_ID as out_PROJ_ID,
:BATCH_ACTIVE_IND as out_BATCH_ACTIVE_IND,
:PROJ_ID as IN_ACT_PROJ_ID,
:BATCH_ACTIVE_IND as IN_BATCH_ACTIVE_IND,
''m_STG_FIN_CLM'' IN_PRGM_NM,
null IN_TABLE_NM,
''UPD'' as ECTL_TX_CD,
TO_CHAR ( ( DATE_PART(''YYYY'', TO_TIMESTAMP(fil_EXPIRED_POLS.LOAD_DT)) * 10000 ) + ( DATE_PART(''MM'', TO_TIMESTAMP(fil_EXPIRED_POLS.LOAD_DT)) * 100 ) + 1 ) as var_FIRST_DAY_EFF_DT,
 TO_DATE ( var_FIRST_DAY_EFF_DT  )  - 1 as var_CHG_EXP_DT_NEW,
CASE WHEN fil_EXPIRED_POLS.CHG_EFF_DT >= var_CHG_EXP_DT_NEW THEN fil_EXPIRED_POLS.CHG_EFF_DT ELSE var_CHG_EXP_DT_NEW END as out_CHG_EXP_DT_NEW,
CURRENT_TIMESTAMP as out_ECTL_END_DATE,
fil_EXPIRED_POLS.source_record_id
FROM
fil_EXPIRED_POLS
);


-- Component mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1, Type MAPPLET 
--MAPPLET NOT REGISTERED: mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE, mapplet instance mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1;
call mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE(''exp_INPUT_ECTL_FIELDS'');

-- Component upd_ING_POL_LIST_EXPIRED_POLS, Type UPDATE 
CREATE OR REPLACE TEMPORARY TABLE upd_ING_POL_LIST_EXPIRED_POLS AS
(
/* UPDATE_STRATEGY_ACTION = 0 FOR INSERT / UPDATE_STRATEGY_ACTION = 1 FOR UPDATE / UPDATE_STRATEGY_ACTION = 2 FOR DELETE / UPDATE_STRATEGY_ACTION = 3 FOR REJECT */
SELECT
--''1'' as ECTL_BATCH_ID,
--''1900-01-01'' as ECTL_MODIFY_TS,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1.out_ECTL_BATCH_ID as ECTL_BATCH_ID,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1.out_ORIG_INS_TS as ECTL_MODIFY_TS,
exp_INPUT_ECTL_FIELDS.out_ECTL_END_DATE as ECTL_END_DATE,
exp_INPUT_ECTL_FIELDS.POL_ID_src as POL_ID,
exp_INPUT_ECTL_FIELDS.CHG_EFF_DT as CHG_EFF_DT,
exp_INPUT_ECTL_FIELDS.ECTL_TX_CD as ECTL_TX_CD,
exp_INPUT_ECTL_FIELDS.out_CHG_EXP_DT_NEW as CHG_EXP_DT,
1 as UPDATE_STRATEGY_ACTION
FROM
exp_INPUT_ECTL_FIELDS
LEFT JOIN mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1 ON exp_INPUT_ECTL_FIELDS.source_record_id = mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE1.source_record_id
);


-- Component ING_POL_LIST_UPD_EXPIRED_POLS, Type TARGET 
INSERT INTO DB_T_CORE_MEMBXREF_PROD.ING_POL_LIST
(
POL_ID,
CHG_EFF_DT,
CHG_EXP_DT,
ECTL_BATCH_ID,
ECTL_MODIFY_TS,
ECTL_TX_CD,
ECTL_END_DATE
)
SELECT
upd_ING_POL_LIST_EXPIRED_POLS.POL_ID as POL_ID,
upd_ING_POL_LIST_EXPIRED_POLS.CHG_EFF_DT as CHG_EFF_DT,
upd_ING_POL_LIST_EXPIRED_POLS.CHG_EXP_DT as CHG_EXP_DT,
upd_ING_POL_LIST_EXPIRED_POLS.ECTL_BATCH_ID as ECTL_BATCH_ID,
upd_ING_POL_LIST_EXPIRED_POLS.ECTL_MODIFY_TS as ECTL_MODIFY_TS,
upd_ING_POL_LIST_EXPIRED_POLS.ECTL_TX_CD as ECTL_TX_CD,
upd_ING_POL_LIST_EXPIRED_POLS.ECTL_END_DATE as ECTL_END_DATE
FROM
upd_ING_POL_LIST_EXPIRED_POLS
WHERE UPDATE_STRATEGY_ACTION = 0;

/* Perform Updates */
MERGE INTO DB_T_CORE_MEMBXREF_PROD.ING_POL_LIST
USING upd_ING_POL_LIST_EXPIRED_POLS ON (UPDATE_STRATEGY_ACTION = 1  )
WHEN MATCHED THEN UPDATE
SET
POL_ID = upd_ING_POL_LIST_EXPIRED_POLS.POL_ID,
CHG_EFF_DT = upd_ING_POL_LIST_EXPIRED_POLS.CHG_EFF_DT,
CHG_EXP_DT = upd_ING_POL_LIST_EXPIRED_POLS.CHG_EXP_DT,
ECTL_BATCH_ID = upd_ING_POL_LIST_EXPIRED_POLS.ECTL_BATCH_ID,
ECTL_MODIFY_TS = upd_ING_POL_LIST_EXPIRED_POLS.ECTL_MODIFY_TS,
ECTL_TX_CD = upd_ING_POL_LIST_EXPIRED_POLS.ECTL_TX_CD,
ECTL_END_DATE = upd_ING_POL_LIST_EXPIRED_POLS.ECTL_END_DATE
;


-- PIPELINE END FOR 1

-- PIPELINE START FOR 2

-- Component sq_STG_ING_POL_LIST, Type SOURCE 
CREATE OR REPLACE TEMPORARY TABLE sq_STG_ING_POL_LIST AS
(
SELECT /* adding column aliases to ensure proper downstream column references */
$1 as CO_ID,
$2 as POL_ID,
$3 as INSURED_MEMBER_NUM,
$4 as PAYOR_MEMBER_NUM,
$5 as ALPHA_CODE_INSURED,
$6 as ALPHA_CODE_OWNER,
$7 as ALPHA_CODE_PAYOR,
$8 as ALPHA_CODE_JOINT,
$9 as INSURED_FIRST_NM,
$10 as INSURED_MID_NM,
$11 as INSURED_LAST_NM,
$12 as INSURED_SFX_NM,
$13 as PAYOR_FIRST_NM,
$14 as PAYOR_MID_NM,
$15 as PAYOR_LAST_NM,
$16 as PAYOR_SFX_NM,
$17 as INSURED_ADDR_LN_1,
$18 as INSURED_ADDR_LN_2,
$19 as INSURED_CITY_NM,
$20 as INSURED_STATE_CD,
$21 as INSURED_ZIP_CD,
$22 as INSURED_CLI_ID,
$23 as OWNER_CLI_ID,
$24 as PAYOR_CLI_ID,
$25 as SEC_INSURED_CLI_ID,
$26 as INSURED_SSN,
$27 as OWNER_SSN,
$28 as PAYOR_SSN,
$29 as SEC_INSURED_SSN,
$30 as AGT_ID,
$31 as POL_ISS_DT,
$32 as SERV_CENTER_NUM,
$33 as POLICY_TYPE,
$34 as POL_STATUS,
$35 as POL_CNFD_IND,
$36 as BASE_PLAN_ID,
$37 as BASE_FACE_AMT,
$38 as BILL_MODE,
$39 as CURR_CASH_VALUE,
$40 as OWNER_FIRST_NM,
$41 as OWNER_MID_NM,
$42 as OWNER_LAST_NM,
$43 as OWNER_SFX_NM,
$44 as LOAD_DT,
$45 as FEED_IND,
$46 as source_record_id
FROM (
SELECT SRC.*, row_number() over (order by 1) AS source_record_id FROM (
SELECT 
LTRIM(RTRIM(STG_ING_POL_LIST.CO_ID)), 
LTRIM(RTRIM(STG_ING_POL_LIST.POL_ID)), 
LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_MEMBER_NUM)), 
LTRIM(RTRIM(STG_ING_POL_LIST.PAYOR_MEMBER_NUM)), 
LTRIM(RTRIM(STG_ING_POL_LIST.ALPHA_CODE_INSURED)), 
LTRIM(RTRIM(STG_ING_POL_LIST.ALPHA_CODE_OWNER)), 
LTRIM(RTRIM(STG_ING_POL_LIST.ALPHA_CODE_PAYOR)), 
LTRIM(RTRIM(STG_ING_POL_LIST.ALPHA_CODE_JOINT)), LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_FIRST_NM)), LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_MID_NM)), LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_LAST_NM)), LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_SFX_NM)), LTRIM(RTRIM(STG_ING_POL_LIST.PAYOR_FIRST_NM)), LTRIM(RTRIM(STG_ING_POL_LIST.PAYOR_MID_NM)), LTRIM(RTRIM(STG_ING_POL_LIST.PAYOR_LAST_NM)), LTRIM(RTRIM(STG_ING_POL_LIST.PAYOR_SFX_NM)), LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_ADDR_LN_1)), 
LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_ADDR_LN_2)),
LTRIM(RTRIM( STG_ING_POL_LIST.INSURED_CITY_NM)), LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_STATE_CD)), LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_ZIP_CD)), LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_CLI_ID)), LTRIM(RTRIM(STG_ING_POL_LIST.OWNER_CLI_ID)),
 LTRIM(RTRIM(STG_ING_POL_LIST.PAYOR_CLI_ID)), 
LTRIM(RTRIM(STG_ING_POL_LIST.SEC_INSURED_CLI_ID)), LTRIM(RTRIM(STG_ING_POL_LIST.INSURED_SSN)), 
LTRIM(RTRIM(STG_ING_POL_LIST.OWNER_SSN)), 
LTRIM(RTRIM(STG_ING_POL_LIST.PAYOR_SSN)),
 LTRIM(RTRIM(STG_ING_POL_LIST.SEC_INSURED_SSN)), LTRIM(RTRIM(STG_ING_POL_LIST.AGT_ID)), STG_ING_POL_LIST.POL_ISS_DT, STG_ING_POL_LIST.SERV_CENTER_NUM, 
LTRIM(RTRIM(STG_ING_POL_LIST.POLICY_TYPE)), 
LTRIM(RTRIM(STG_ING_POL_LIST.POL_STATUS)), 
LTRIM(RTRIM(STG_ING_POL_LIST.POL_CNFD_IND)),
LTRIM(RTRIM(STG_ING_POL_LIST.BASE_PLAN_ID)),
STG_ING_POL_LIST.BASE_FACE_AMT,
LTRIM(RTRIM(STG_ING_POL_LIST.BILL_MODE)),
STG_ING_POL_LIST.CURR_CASH_VALUE,
LTRIM(RTRIM(STG_ING_POL_LIST.OWNER_FIRST_NM)),
LTRIM(RTRIM(STG_ING_POL_LIST.OWNER_MID_NM)),
LTRIM(RTRIM(STG_ING_POL_LIST.OWNER_LAST_NM)),
LTRIM(RTRIM(STG_ING_POL_LIST.OWNER_SFX_NM)),
STG_ING_POL_LIST.LOAD_DT,
 STG_ING_POL_LIST.FEED_IND 
FROM
DB_T_STAG_MEMBXREF_PROD.STG_ING_POL_LIST
WHERE LOAD_DT=(SELECT FEED_DT FROM DB_T_STAG_MEMBXREF_PROD.STG_MEMBXREF_TRIGGER WHERE TABLENAME=''ING_POL_LIST'')
) SRC
)
);


-- Component exp_TO_DATE_POL_ISS_DT, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_TO_DATE_POL_ISS_DT AS
(
SELECT
sq_STG_ING_POL_LIST.CO_ID as CO_ID,
sq_STG_ING_POL_LIST.POL_ID as POL_ID,
sq_STG_ING_POL_LIST.INSURED_MEMBER_NUM as INSURED_MEMBER_NUM,
sq_STG_ING_POL_LIST.PAYOR_MEMBER_NUM as PAYOR_MEMBER_NUM,
sq_STG_ING_POL_LIST.ALPHA_CODE_INSURED as ALPHA_CODE_INSURED,
sq_STG_ING_POL_LIST.ALPHA_CODE_OWNER as ALPHA_CODE_OWNER,
sq_STG_ING_POL_LIST.ALPHA_CODE_PAYOR as ALPHA_CODE_PAYOR,
sq_STG_ING_POL_LIST.ALPHA_CODE_JOINT as ALPHA_CODE_JOINT,
sq_STG_ING_POL_LIST.INSURED_FIRST_NM as INSURED_FIRST_NM,
sq_STG_ING_POL_LIST.INSURED_MID_NM as INSURED_MID_NM,
sq_STG_ING_POL_LIST.INSURED_LAST_NM as INSURED_LAST_NM,
sq_STG_ING_POL_LIST.INSURED_SFX_NM as INSURED_SFX_NM,
sq_STG_ING_POL_LIST.PAYOR_FIRST_NM as PAYOR_FIRST_NM,
sq_STG_ING_POL_LIST.PAYOR_MID_NM as PAYOR_MID_NM,
sq_STG_ING_POL_LIST.PAYOR_LAST_NM as PAYOR_LAST_NM,
sq_STG_ING_POL_LIST.PAYOR_SFX_NM as PAYOR_SFX_NM,
sq_STG_ING_POL_LIST.INSURED_ADDR_LN_1 as INSURED_ADDR_LN_1,
sq_STG_ING_POL_LIST.INSURED_ADDR_LN_2 as INSURED_ADDR_LN_2,
sq_STG_ING_POL_LIST.INSURED_CITY_NM as INSURED_CITY_NM,
sq_STG_ING_POL_LIST.INSURED_STATE_CD as INSURED_STATE_CD,
sq_STG_ING_POL_LIST.INSURED_ZIP_CD as INSURED_ZIP_CD,
sq_STG_ING_POL_LIST.INSURED_CLI_ID as INSURED_CLI_ID,
sq_STG_ING_POL_LIST.OWNER_CLI_ID as OWNER_CLI_ID,
sq_STG_ING_POL_LIST.PAYOR_CLI_ID as PAYOR_CLI_ID,
sq_STG_ING_POL_LIST.SEC_INSURED_CLI_ID as SEC_INSURED_CLI_ID,
sq_STG_ING_POL_LIST.INSURED_SSN as INSURED_SSN,
sq_STG_ING_POL_LIST.OWNER_SSN as OWNER_SSN,
sq_STG_ING_POL_LIST.PAYOR_SSN as PAYOR_SSN,
sq_STG_ING_POL_LIST.SEC_INSURED_SSN as SEC_INSURED_SSN,
sq_STG_ING_POL_LIST.AGT_ID as AGT_ID,
TO_DATE ( sq_STG_ING_POL_LIST.POL_ISS_DT , ''YYYY-MM-DD'' ) as out_POL_ISS_DT,
sq_STG_ING_POL_LIST.SERV_CENTER_NUM as SERV_CENTER_NUM,
sq_STG_ING_POL_LIST.POLICY_TYPE as POLICY_TYPE,
sq_STG_ING_POL_LIST.POL_STATUS as POL_STATUS,
sq_STG_ING_POL_LIST.POL_CNFD_IND as POL_CNFD_IND,
sq_STG_ING_POL_LIST.BASE_PLAN_ID as BASE_PLAN_ID,
sq_STG_ING_POL_LIST.BASE_FACE_AMT as BASE_FACE_AMT,
sq_STG_ING_POL_LIST.BILL_MODE as BILL_MODE,
sq_STG_ING_POL_LIST.CURR_CASH_VALUE as CURR_CASH_VALUE,
sq_STG_ING_POL_LIST.OWNER_FIRST_NM as OWNER_FIRST_NM,
sq_STG_ING_POL_LIST.OWNER_MID_NM as OWNER_MID_NM,
sq_STG_ING_POL_LIST.OWNER_LAST_NM as OWNER_LAST_NM,
sq_STG_ING_POL_LIST.OWNER_SFX_NM as OWNER_SFX_NM,
sq_STG_ING_POL_LIST.LOAD_DT as LOAD_DT,
sq_STG_ING_POL_LIST.FEED_IND as FEED_IND,
sq_STG_ING_POL_LIST.source_record_id
FROM
sq_STG_ING_POL_LIST
);


-- Component LKP_ING_POL_LIST, Type LOOKUP 
CREATE OR REPLACE TEMPORARY TABLE LKP_ING_POL_LIST AS
(
SELECT
LKP.CO_ID,
LKP.POL_ID,
LKP.CHG_EFF_DT,
LKP.CHG_EXP_DT,
LKP.INSURED_MEMBER_NUM,
LKP.PAYOR_MEMBER_NUM,
LKP.ALPHA_CODE_INSURED,
LKP.ALPHA_CODE_OWNER,
LKP.ALPHA_CODE_PAYOR,
LKP.ALPHA_CODE_JOINT,
LKP.INSURED_FIRST_NM,
LKP.INSURED_MID_NM,
LKP.INSURED_LAST_NM,
LKP.INSURED_SFX_NM,
LKP.PAYOR_FIRST_NM,
LKP.PAYOR_MID_NM,
LKP.PAYOR_LAST_NM,
LKP.PAYOR_SFX_NM,
LKP.INSURED_ADDR_LN_1,
LKP.INSURED_ADDR_LN_2,
LKP.INSURED_CITY_NM,
LKP.INSURED_STATE_CD,
LKP.INSURED_ZIP_CD,
LKP.INSURED_CLI_ID,
LKP.OWNER_CLI_ID,
LKP.PAYOR_CLI_ID,
LKP.SEC_INSURED_CLI_ID,
LKP.INSURED_SSN,
LKP.OWNER_SSN,
LKP.PAYOR_SSN,
LKP.SEC_INSURED_SSN,
LKP.AGT_ID,
LKP.POL_ISS_DT,
LKP.SERV_CENTER_NUM,
LKP.POLICY_TYPE,
LKP.POL_STATUS,
LKP.POL_CNFD_IND,
LKP.BASE_PLAN_ID,
LKP.BASE_FACE_AMT,
LKP.BILL_MODE,
LKP.CURR_CASH_VALUE,
LKP.OWNER_FIRST_NM,
LKP.OWNER_MID_NM,
LKP.OWNER_LAST_NM,
LKP.OWNER_SFX_NM,
LKP.FEED_IND,
exp_TO_DATE_POL_ISS_DT.source_record_id,
ROW_NUMBER() OVER(PARTITION BY exp_TO_DATE_POL_ISS_DT.source_record_id ORDER BY LKP.CO_ID asc,LKP.POL_ID asc,LKP.CHG_EFF_DT asc,LKP.CHG_EXP_DT asc,LKP.INSURED_MEMBER_NUM asc,LKP.PAYOR_MEMBER_NUM asc,LKP.ALPHA_CODE_INSURED asc,LKP.ALPHA_CODE_OWNER asc,LKP.ALPHA_CODE_PAYOR asc,LKP.ALPHA_CODE_JOINT asc,LKP.INSURED_FIRST_NM asc,LKP.INSURED_MID_NM asc,LKP.INSURED_LAST_NM asc,LKP.INSURED_SFX_NM asc,LKP.PAYOR_FIRST_NM asc,LKP.PAYOR_MID_NM asc,LKP.PAYOR_LAST_NM asc,LKP.PAYOR_SFX_NM asc,LKP.INSURED_ADDR_LN_1 asc,LKP.INSURED_ADDR_LN_2 asc,LKP.INSURED_CITY_NM asc,LKP.INSURED_STATE_CD asc,LKP.INSURED_ZIP_CD asc,LKP.INSURED_CLI_ID asc,LKP.OWNER_CLI_ID asc,LKP.PAYOR_CLI_ID asc,LKP.SEC_INSURED_CLI_ID asc,LKP.INSURED_SSN asc,LKP.OWNER_SSN asc,LKP.PAYOR_SSN asc,LKP.SEC_INSURED_SSN asc,LKP.AGT_ID asc,LKP.POL_ISS_DT asc,LKP.SERV_CENTER_NUM asc,LKP.POLICY_TYPE asc,LKP.POL_STATUS asc,LKP.POL_CNFD_IND asc,LKP.BASE_PLAN_ID asc,LKP.BASE_FACE_AMT asc,LKP.BILL_MODE asc,LKP.CURR_CASH_VALUE asc,LKP.OWNER_FIRST_NM asc,LKP.OWNER_MID_NM asc,LKP.OWNER_LAST_NM asc,LKP.OWNER_SFX_NM asc,LKP.FEED_IND asc,LKP.ECTL_BATCH_ID asc,LKP.ECTL_ORIG_INS_TS asc,LKP.ECTL_MODIFY_TS asc,LKP.ECTL_SRC_ID asc,LKP.ECTL_SRC_INST_ID asc,LKP.ECTL_PRGM_ID asc,LKP.ECTL_TX_CD asc,LKP.ECTL_START_DATE asc,LKP.ECTL_END_DATE asc) RNK
FROM
exp_TO_DATE_POL_ISS_DT
LEFT JOIN (
SELECT ING_POL_LIST.CO_ID as CO_ID, 
ING_POL_LIST.POL_ID as POL_ID,
ING_POL_LIST.CHG_EFF_DT as CHG_EFF_DT, ING_POL_LIST.CHG_EXP_DT as CHG_EXP_DT, ING_POL_LIST.INSURED_MEMBER_NUM as INSURED_MEMBER_NUM, ING_POL_LIST.PAYOR_MEMBER_NUM as PAYOR_MEMBER_NUM, ING_POL_LIST.ALPHA_CODE_INSURED as ALPHA_CODE_INSURED, ING_POL_LIST.ALPHA_CODE_OWNER as ALPHA_CODE_OWNER, ING_POL_LIST.ALPHA_CODE_PAYOR as ALPHA_CODE_PAYOR, ING_POL_LIST.ALPHA_CODE_JOINT as ALPHA_CODE_JOINT, ING_POL_LIST.INSURED_FIRST_NM as INSURED_FIRST_NM, ING_POL_LIST.INSURED_MID_NM as INSURED_MID_NM, ING_POL_LIST.INSURED_LAST_NM as INSURED_LAST_NM, ING_POL_LIST.INSURED_SFX_NM as INSURED_SFX_NM, ING_POL_LIST.PAYOR_FIRST_NM as PAYOR_FIRST_NM, ING_POL_LIST.PAYOR_MID_NM as PAYOR_MID_NM, ING_POL_LIST.PAYOR_LAST_NM as PAYOR_LAST_NM, ING_POL_LIST.PAYOR_SFX_NM as PAYOR_SFX_NM, ING_POL_LIST.INSURED_ADDR_LN_1 as INSURED_ADDR_LN_1, ING_POL_LIST.INSURED_ADDR_LN_2 as INSURED_ADDR_LN_2, ING_POL_LIST.INSURED_CITY_NM as INSURED_CITY_NM, ING_POL_LIST.INSURED_STATE_CD as INSURED_STATE_CD, ING_POL_LIST.INSURED_ZIP_CD as INSURED_ZIP_CD, ING_POL_LIST.INSURED_CLI_ID as INSURED_CLI_ID, ING_POL_LIST.OWNER_CLI_ID as OWNER_CLI_ID, ING_POL_LIST.PAYOR_CLI_ID as PAYOR_CLI_ID, ING_POL_LIST.SEC_INSURED_CLI_ID as SEC_INSURED_CLI_ID, ING_POL_LIST.INSURED_SSN as INSURED_SSN, ING_POL_LIST.OWNER_SSN as OWNER_SSN, ING_POL_LIST.PAYOR_SSN as PAYOR_SSN, ING_POL_LIST.SEC_INSURED_SSN as SEC_INSURED_SSN, ING_POL_LIST.AGT_ID as AGT_ID, ING_POL_LIST.POL_ISS_DT as POL_ISS_DT, ING_POL_LIST.SERV_CENTER_NUM as SERV_CENTER_NUM, ING_POL_LIST.POLICY_TYPE as POLICY_TYPE, ING_POL_LIST.POL_STATUS as POL_STATUS, ING_POL_LIST.POL_CNFD_IND as POL_CNFD_IND, ING_POL_LIST.BASE_PLAN_ID as BASE_PLAN_ID, ING_POL_LIST.BASE_FACE_AMT as BASE_FACE_AMT, ING_POL_LIST.BILL_MODE as BILL_MODE, ING_POL_LIST.CURR_CASH_VALUE as CURR_CASH_VALUE, ING_POL_LIST.OWNER_FIRST_NM as OWNER_FIRST_NM, ING_POL_LIST.OWNER_MID_NM as OWNER_MID_NM, ING_POL_LIST.OWNER_LAST_NM as OWNER_LAST_NM, ING_POL_LIST.OWNER_SFX_NM as OWNER_SFX_NM, ING_POL_LIST.FEED_IND as FEED_IND, ING_POL_LIST.ECTL_BATCH_ID as ECTL_BATCH_ID, ING_POL_LIST.ECTL_ORIG_INS_TS as ECTL_ORIG_INS_TS, ING_POL_LIST.ECTL_MODIFY_TS as ECTL_MODIFY_TS, ING_POL_LIST.ECTL_SRC_ID as ECTL_SRC_ID, ING_POL_LIST.ECTL_SRC_INST_ID as ECTL_SRC_INST_ID, ING_POL_LIST.ECTL_PRGM_ID as ECTL_PRGM_ID, ING_POL_LIST.ECTL_TX_CD as ECTL_TX_CD, ING_POL_LIST.ECTL_START_DATE as ECTL_START_DATE, ING_POL_LIST.ECTL_END_DATE as ECTL_END_DATE FROM DB_T_CORE_MEMBXREF_PROD.ING_POL_LIST
WHERE ECTL_TX_CD=''NEW''
) LKP ON LKP.POL_ID = exp_TO_DATE_POL_ISS_DT.POL_ID
QUALIFY RNK = 1
);


-- Component exp_DERIVE_FLAG, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_DERIVE_FLAG AS
(
SELECT
LKP_ING_POL_LIST.POL_ID as POL_ID_lkp,
LKP_ING_POL_LIST.CHG_EFF_DT as CHG_EFF_DT_lkp,
exp_TO_DATE_POL_ISS_DT.CO_ID as CO_ID,
exp_TO_DATE_POL_ISS_DT.POL_ID as POL_ID,
exp_TO_DATE_POL_ISS_DT.INSURED_MEMBER_NUM as INSURED_MEMBER_NUM,
exp_TO_DATE_POL_ISS_DT.PAYOR_MEMBER_NUM as PAYOR_MEMBER_NUM,
exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_INSURED as ALPHA_CODE_INSURED,
exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_OWNER as ALPHA_CODE_OWNER,
exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_PAYOR as ALPHA_CODE_PAYOR,
exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_JOINT as ALPHA_CODE_JOINT,
exp_TO_DATE_POL_ISS_DT.INSURED_FIRST_NM as INSURED_FIRST_NM,
exp_TO_DATE_POL_ISS_DT.INSURED_MID_NM as INSURED_MID_NM,
exp_TO_DATE_POL_ISS_DT.INSURED_LAST_NM as INSURED_LAST_NM,
exp_TO_DATE_POL_ISS_DT.INSURED_SFX_NM as INSURED_SFX_NM,
exp_TO_DATE_POL_ISS_DT.PAYOR_FIRST_NM as PAYOR_FIRST_NM,
exp_TO_DATE_POL_ISS_DT.PAYOR_MID_NM as PAYOR_MID_NM,
exp_TO_DATE_POL_ISS_DT.PAYOR_LAST_NM as PAYOR_LAST_NM,
exp_TO_DATE_POL_ISS_DT.PAYOR_SFX_NM as PAYOR_SFX_NM,
exp_TO_DATE_POL_ISS_DT.INSURED_ADDR_LN_1 as INSURED_ADDR_LN_1,
exp_TO_DATE_POL_ISS_DT.INSURED_ADDR_LN_2 as INSURED_ADDR_LN_2,
exp_TO_DATE_POL_ISS_DT.INSURED_CITY_NM as INSURED_CITY_NM,
exp_TO_DATE_POL_ISS_DT.INSURED_STATE_CD as INSURED_STATE_CD,
exp_TO_DATE_POL_ISS_DT.INSURED_ZIP_CD as INSURED_ZIP_CD,
exp_TO_DATE_POL_ISS_DT.INSURED_CLI_ID as INSURED_CLI_ID,
exp_TO_DATE_POL_ISS_DT.OWNER_CLI_ID as OWNER_CLI_ID,
exp_TO_DATE_POL_ISS_DT.PAYOR_CLI_ID as PAYOR_CLI_ID,
exp_TO_DATE_POL_ISS_DT.SEC_INSURED_CLI_ID as SEC_INSURED_CLI_ID,
exp_TO_DATE_POL_ISS_DT.INSURED_SSN as INSURED_SSN,
exp_TO_DATE_POL_ISS_DT.OWNER_SSN as OWNER_SSN,
exp_TO_DATE_POL_ISS_DT.PAYOR_SSN as PAYOR_SSN,
exp_TO_DATE_POL_ISS_DT.SEC_INSURED_SSN as SEC_INSURED_SSN,
exp_TO_DATE_POL_ISS_DT.AGT_ID as AGT_ID,
exp_TO_DATE_POL_ISS_DT.out_POL_ISS_DT as POL_ISS_DT,
exp_TO_DATE_POL_ISS_DT.SERV_CENTER_NUM as SERV_CENTER_NUM,
exp_TO_DATE_POL_ISS_DT.POLICY_TYPE as POLICY_TYPE,
exp_TO_DATE_POL_ISS_DT.POL_STATUS as POL_STATUS,
exp_TO_DATE_POL_ISS_DT.POL_CNFD_IND as POL_CNFD_IND,
exp_TO_DATE_POL_ISS_DT.BASE_PLAN_ID as BASE_PLAN_ID,
exp_TO_DATE_POL_ISS_DT.BASE_FACE_AMT as BASE_FACE_AMT,
exp_TO_DATE_POL_ISS_DT.BILL_MODE as BILL_MODE,
exp_TO_DATE_POL_ISS_DT.CURR_CASH_VALUE as CURR_CASH_VALUE,
exp_TO_DATE_POL_ISS_DT.OWNER_FIRST_NM as OWNER_FIRST_NM,
exp_TO_DATE_POL_ISS_DT.OWNER_MID_NM as OWNER_MID_NM,
exp_TO_DATE_POL_ISS_DT.OWNER_LAST_NM as OWNER_LAST_NM,
exp_TO_DATE_POL_ISS_DT.OWNER_SFX_NM as OWNER_SFX_NM,
exp_TO_DATE_POL_ISS_DT.LOAD_DT as LOAD_DT,
exp_TO_DATE_POL_ISS_DT.FEED_IND as FEED_IND,
CASE WHEN LKP_ING_POL_LIST.POL_ID IS NULL THEN ''NEW'' ELSE CASE WHEN CASE WHEN LKP_ING_POL_LIST.CO_ID IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.CO_ID END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.CO_ID IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.CO_ID END OR CASE WHEN LKP_ING_POL_LIST.INSURED_MEMBER_NUM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_MEMBER_NUM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_MEMBER_NUM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_MEMBER_NUM END OR CASE WHEN LKP_ING_POL_LIST.PAYOR_MEMBER_NUM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.PAYOR_MEMBER_NUM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.PAYOR_MEMBER_NUM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.PAYOR_MEMBER_NUM END OR CASE WHEN LKP_ING_POL_LIST.ALPHA_CODE_INSURED IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.ALPHA_CODE_INSURED END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_INSURED IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_INSURED END OR CASE WHEN LKP_ING_POL_LIST.ALPHA_CODE_OWNER IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.ALPHA_CODE_OWNER END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_OWNER IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_OWNER END OR CASE WHEN LKP_ING_POL_LIST.ALPHA_CODE_PAYOR IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.ALPHA_CODE_PAYOR END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_PAYOR IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_PAYOR END OR CASE WHEN LKP_ING_POL_LIST.ALPHA_CODE_JOINT IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.ALPHA_CODE_JOINT END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_JOINT IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.ALPHA_CODE_JOINT END OR CASE WHEN LKP_ING_POL_LIST.INSURED_FIRST_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_FIRST_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_FIRST_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_FIRST_NM END OR CASE WHEN LKP_ING_POL_LIST.INSURED_MID_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_MID_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_MID_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_MID_NM END OR CASE WHEN LKP_ING_POL_LIST.INSURED_LAST_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_LAST_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_LAST_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_LAST_NM END OR CASE WHEN LKP_ING_POL_LIST.INSURED_SFX_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_SFX_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_SFX_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_SFX_NM END OR CASE WHEN LKP_ING_POL_LIST.PAYOR_FIRST_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.PAYOR_FIRST_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.PAYOR_FIRST_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.PAYOR_FIRST_NM END OR CASE WHEN LKP_ING_POL_LIST.PAYOR_MID_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.PAYOR_MID_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.PAYOR_MID_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.PAYOR_MID_NM END OR CASE WHEN LKP_ING_POL_LIST.PAYOR_LAST_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.PAYOR_LAST_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.PAYOR_LAST_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.PAYOR_LAST_NM END OR CASE WHEN LKP_ING_POL_LIST.PAYOR_SFX_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.PAYOR_SFX_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.PAYOR_SFX_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.PAYOR_SFX_NM END OR CASE WHEN LKP_ING_POL_LIST.INSURED_ADDR_LN_1 IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_ADDR_LN_1 END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_ADDR_LN_1 IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_ADDR_LN_1 END OR CASE WHEN LKP_ING_POL_LIST.INSURED_ADDR_LN_2 IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_ADDR_LN_2 END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_ADDR_LN_2 IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_ADDR_LN_2 END OR CASE WHEN LKP_ING_POL_LIST.INSURED_CITY_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_CITY_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_CITY_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_CITY_NM END OR CASE WHEN LKP_ING_POL_LIST.INSURED_STATE_CD IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_STATE_CD END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_STATE_CD IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_STATE_CD END OR CASE WHEN LKP_ING_POL_LIST.INSURED_ZIP_CD IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_ZIP_CD END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_ZIP_CD IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_ZIP_CD END OR CASE WHEN LKP_ING_POL_LIST.INSURED_CLI_ID IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_CLI_ID END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_CLI_ID IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_CLI_ID END OR CASE WHEN LKP_ING_POL_LIST.OWNER_CLI_ID IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.OWNER_CLI_ID END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.OWNER_CLI_ID IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.OWNER_CLI_ID END OR CASE WHEN LKP_ING_POL_LIST.PAYOR_CLI_ID IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.PAYOR_CLI_ID END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.PAYOR_CLI_ID IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.PAYOR_CLI_ID END OR CASE WHEN LKP_ING_POL_LIST.SEC_INSURED_CLI_ID IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.SEC_INSURED_CLI_ID END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.SEC_INSURED_CLI_ID IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.SEC_INSURED_CLI_ID END OR CASE WHEN LKP_ING_POL_LIST.INSURED_SSN IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.INSURED_SSN END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.INSURED_SSN IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.INSURED_SSN END OR CASE WHEN LKP_ING_POL_LIST.OWNER_SSN IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.OWNER_SSN END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.OWNER_SSN IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.OWNER_SSN END OR CASE WHEN LKP_ING_POL_LIST.PAYOR_SSN IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.PAYOR_SSN END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.PAYOR_SSN IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.PAYOR_SSN END OR CASE WHEN LKP_ING_POL_LIST.SEC_INSURED_SSN IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.SEC_INSURED_SSN END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.SEC_INSURED_SSN IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.SEC_INSURED_SSN END OR CASE WHEN LKP_ING_POL_LIST.AGT_ID IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.AGT_ID END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.AGT_ID IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.AGT_ID END OR CASE WHEN LKP_ING_POL_LIST.POL_ISS_DT IS NULL THEN TO_DATE ( ''9999-12-31'' , ''YYYY-MM-DD'' ) ELSE LKP_ING_POL_LIST.POL_ISS_DT END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.out_POL_ISS_DT IS NULL THEN TO_DATE ( ''9999-12-31'' , ''YYYY-MM-DD'' ) ELSE exp_TO_DATE_POL_ISS_DT.out_POL_ISS_DT END OR CASE WHEN LKP_ING_POL_LIST.SERV_CENTER_NUM IS NULL THEN 0 ELSE LKP_ING_POL_LIST.SERV_CENTER_NUM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.SERV_CENTER_NUM IS NULL THEN 0 ELSE exp_TO_DATE_POL_ISS_DT.SERV_CENTER_NUM END OR CASE WHEN LKP_ING_POL_LIST.POLICY_TYPE IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.POLICY_TYPE END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.POLICY_TYPE IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.POLICY_TYPE END OR CASE WHEN LKP_ING_POL_LIST.POL_STATUS IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.POL_STATUS END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.POL_STATUS IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.POL_STATUS END OR CASE WHEN LKP_ING_POL_LIST.POL_CNFD_IND IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.POL_CNFD_IND END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.POL_CNFD_IND IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.POL_CNFD_IND END OR CASE WHEN LKP_ING_POL_LIST.BASE_PLAN_ID IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.BASE_PLAN_ID END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.BASE_PLAN_ID IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.BASE_PLAN_ID END OR CASE WHEN LKP_ING_POL_LIST.BASE_FACE_AMT IS NULL THEN 0 ELSE LKP_ING_POL_LIST.BASE_FACE_AMT END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.BASE_FACE_AMT IS NULL THEN 0 ELSE exp_TO_DATE_POL_ISS_DT.BASE_FACE_AMT END OR CASE WHEN LKP_ING_POL_LIST.BILL_MODE IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.BILL_MODE END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.BILL_MODE IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.BILL_MODE END OR CASE WHEN LKP_ING_POL_LIST.CURR_CASH_VALUE IS NULL THEN 0 ELSE LKP_ING_POL_LIST.CURR_CASH_VALUE END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.CURR_CASH_VALUE IS NULL THEN 0 ELSE exp_TO_DATE_POL_ISS_DT.CURR_CASH_VALUE END OR CASE WHEN LKP_ING_POL_LIST.OWNER_FIRST_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.OWNER_FIRST_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.OWNER_FIRST_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.OWNER_FIRST_NM END OR CASE WHEN LKP_ING_POL_LIST.OWNER_MID_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.OWNER_MID_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.OWNER_MID_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.OWNER_MID_NM END OR CASE WHEN LKP_ING_POL_LIST.OWNER_LAST_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.OWNER_LAST_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.OWNER_LAST_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.OWNER_LAST_NM END OR CASE WHEN LKP_ING_POL_LIST.OWNER_SFX_NM IS NULL THEN ''~'' ELSE LKP_ING_POL_LIST.OWNER_SFX_NM END <> CASE WHEN exp_TO_DATE_POL_ISS_DT.OWNER_SFX_NM IS NULL THEN ''~'' ELSE exp_TO_DATE_POL_ISS_DT.OWNER_SFX_NM END THEN ''UPD'' ELSE ''REJ'' END END as out_FLG,
LTRIM ( RTRIM ( :PMMappingName ) ) as out_PRGM_NM,
:PROJ_ID as out_PROJ_ID,
:BATCH_ACTIVE_IND as out_BATCH_ACTIVE_IND,
exp_TO_DATE_POL_ISS_DT.source_record_id
FROM
exp_TO_DATE_POL_ISS_DT
INNER JOIN LKP_ING_POL_LIST ON exp_TO_DATE_POL_ISS_DT.source_record_id = LKP_ING_POL_LIST.source_record_id
);


-- Component mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE, Type MAPPLET 
--MAPPLET NOT REGISTERED: mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE, mapplet instance mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE;


-- Component exp_ING_POL_LIST, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_ING_POL_LIST AS
(
SELECT
exp_DERIVE_FLAG.POL_ID_lkp as POL_ID_lkp,
exp_DERIVE_FLAG.CHG_EFF_DT_lkp as CHG_EFF_DT_lkp,
exp_DERIVE_FLAG.CO_ID as CO_ID,
exp_DERIVE_FLAG.POL_ID as POL_ID,
exp_DERIVE_FLAG.INSURED_MEMBER_NUM as INSURED_MEMBER_NUM,
exp_DERIVE_FLAG.PAYOR_MEMBER_NUM as PAYOR_MEMBER_NUM,
exp_DERIVE_FLAG.ALPHA_CODE_INSURED as ALPHA_CODE_INSURED,
exp_DERIVE_FLAG.ALPHA_CODE_OWNER as ALPHA_CODE_OWNER,
exp_DERIVE_FLAG.ALPHA_CODE_PAYOR as ALPHA_CODE_PAYOR,
exp_DERIVE_FLAG.ALPHA_CODE_JOINT as ALPHA_CODE_JOINT,
exp_DERIVE_FLAG.INSURED_FIRST_NM as INSURED_FIRST_NM,
exp_DERIVE_FLAG.INSURED_MID_NM as INSURED_MID_NM,
exp_DERIVE_FLAG.INSURED_LAST_NM as INSURED_LAST_NM,
exp_DERIVE_FLAG.INSURED_SFX_NM as INSURED_SFX_NM,
exp_DERIVE_FLAG.PAYOR_FIRST_NM as PAYOR_FIRST_NM,
exp_DERIVE_FLAG.PAYOR_MID_NM as PAYOR_MID_NM,
exp_DERIVE_FLAG.PAYOR_LAST_NM as PAYOR_LAST_NM,
exp_DERIVE_FLAG.PAYOR_SFX_NM as PAYOR_SFX_NM,
exp_DERIVE_FLAG.INSURED_ADDR_LN_1 as INSURED_ADDR_LN_1,
exp_DERIVE_FLAG.INSURED_ADDR_LN_2 as INSURED_ADDR_LN_2,
exp_DERIVE_FLAG.INSURED_CITY_NM as INSURED_CITY_NM,
exp_DERIVE_FLAG.INSURED_STATE_CD as INSURED_STATE_CD,
exp_DERIVE_FLAG.INSURED_ZIP_CD as INSURED_ZIP_CD,
exp_DERIVE_FLAG.INSURED_CLI_ID as INSURED_CLI_ID,
exp_DERIVE_FLAG.OWNER_CLI_ID as OWNER_CLI_ID,
exp_DERIVE_FLAG.PAYOR_CLI_ID as PAYOR_CLI_ID,
exp_DERIVE_FLAG.SEC_INSURED_CLI_ID as SEC_INSURED_CLI_ID,
exp_DERIVE_FLAG.INSURED_SSN as INSURED_SSN,
exp_DERIVE_FLAG.OWNER_SSN as OWNER_SSN,
exp_DERIVE_FLAG.PAYOR_SSN as PAYOR_SSN,
exp_DERIVE_FLAG.SEC_INSURED_SSN as SEC_INSURED_SSN,
exp_DERIVE_FLAG.AGT_ID as AGT_ID,
exp_DERIVE_FLAG.POL_ISS_DT as POL_ISS_DT,
exp_DERIVE_FLAG.SERV_CENTER_NUM as SERV_CENTER_NUM,
exp_DERIVE_FLAG.POLICY_TYPE as POLICY_TYPE,
exp_DERIVE_FLAG.POL_STATUS as POL_STATUS,
exp_DERIVE_FLAG.POL_CNFD_IND as POL_CNFD_IND,
exp_DERIVE_FLAG.BASE_PLAN_ID as BASE_PLAN_ID,
exp_DERIVE_FLAG.BASE_FACE_AMT as BASE_FACE_AMT,
exp_DERIVE_FLAG.BILL_MODE as BILL_MODE,
exp_DERIVE_FLAG.CURR_CASH_VALUE as CURR_CASH_VALUE,
exp_DERIVE_FLAG.OWNER_FIRST_NM as OWNER_FIRST_NM,
exp_DERIVE_FLAG.OWNER_MID_NM as OWNER_MID_NM,
exp_DERIVE_FLAG.OWNER_LAST_NM as OWNER_LAST_NM,
exp_DERIVE_FLAG.OWNER_SFX_NM as OWNER_SFX_NM,
exp_DERIVE_FLAG.LOAD_DT as LOAD_DT,
exp_DERIVE_FLAG.FEED_IND as FEED_IND,
exp_DERIVE_FLAG.out_FLG as FLG,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ECTL_PRGM_ID as ECTL_PRGM_ID,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ECTL_SRC_ID as ECTL_SRC_ID,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ECTL_SRC_INST_ID as ECTL_SRC_INST_ID,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ECTL_BATCH_ID as ECTL_BATCH_ID,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ORIG_INS_TS as ORIG_INS_TS,
mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.out_ECTL_BATCH_START_DATE as ECTL_BATCH_START_DATE,
--''1'' as ECTL_PRGM_ID,
--''1'' as ECTL_SRC_ID,
--''1'' as ECTL_SRC_INST_ID,
--''1'' as ECTL_BATCH_ID,
--''1900-01-01'' as ORIG_INS_TS,
--''1900-01-01'' as ECTL_BATCH_START_DATE,
exp_DERIVE_FLAG.source_record_id
FROM
exp_DERIVE_FLAG
INNER JOIN mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE ON exp_DERIVE_FLAG.source_record_id = mplt_LKP_ECTL_BATCH_PRGM_VALIDATION_CORE.source_record_id
);


-- Component rtr_INS_UPD_INSERT, Type ROUTER Output Group INSERT
create or replace temp table RTR_INS_UPD_INSERT as
SELECT
exp_ING_POL_LIST.POL_ID_lkp as POL_ID_lkp,
exp_ING_POL_LIST.CHG_EFF_DT_lkp as CHG_EFF_DT_lkp,
exp_ING_POL_LIST.CO_ID as CO_ID,
exp_ING_POL_LIST.POL_ID as POL_ID,
exp_ING_POL_LIST.INSURED_MEMBER_NUM as INSURED_MEMBER_NUM,
exp_ING_POL_LIST.PAYOR_MEMBER_NUM as PAYOR_MEMBER_NUM,
exp_ING_POL_LIST.ALPHA_CODE_INSURED as ALPHA_CODE_INSURED,
exp_ING_POL_LIST.ALPHA_CODE_OWNER as ALPHA_CODE_OWNER,
exp_ING_POL_LIST.ALPHA_CODE_PAYOR as ALPHA_CODE_PAYOR,
exp_ING_POL_LIST.ALPHA_CODE_JOINT as ALPHA_CODE_JOINT,
exp_ING_POL_LIST.INSURED_FIRST_NM as INSURED_FIRST_NM,
exp_ING_POL_LIST.INSURED_MID_NM as INSURED_MID_NM,
exp_ING_POL_LIST.INSURED_LAST_NM as INSURED_LAST_NM,
exp_ING_POL_LIST.INSURED_SFX_NM as INSURED_SFX_NM,
exp_ING_POL_LIST.PAYOR_FIRST_NM as PAYOR_FIRST_NM,
exp_ING_POL_LIST.PAYOR_MID_NM as PAYOR_MID_NM,
exp_ING_POL_LIST.PAYOR_LAST_NM as PAYOR_LAST_NM,
exp_ING_POL_LIST.PAYOR_SFX_NM as PAYOR_SFX_NM,
exp_ING_POL_LIST.INSURED_ADDR_LN_1 as INSURED_ADDR_LN_1,
exp_ING_POL_LIST.INSURED_ADDR_LN_2 as INSURED_ADDR_LN_2,
exp_ING_POL_LIST.INSURED_CITY_NM as INSURED_CITY_NM,
exp_ING_POL_LIST.INSURED_STATE_CD as INSURED_STATE_CD,
exp_ING_POL_LIST.INSURED_ZIP_CD as INSURED_ZIP_CD,
exp_ING_POL_LIST.INSURED_CLI_ID as INSURED_CLI_ID,
exp_ING_POL_LIST.OWNER_CLI_ID as OWNER_CLI_ID,
exp_ING_POL_LIST.PAYOR_CLI_ID as PAYOR_CLI_ID,
exp_ING_POL_LIST.SEC_INSURED_CLI_ID as SEC_INSURED_CLI_ID,
exp_ING_POL_LIST.INSURED_SSN as INSURED_SSN,
exp_ING_POL_LIST.OWNER_SSN as OWNER_SSN,
exp_ING_POL_LIST.PAYOR_SSN as PAYOR_SSN,
exp_ING_POL_LIST.SEC_INSURED_SSN as SEC_INSURED_SSN,
exp_ING_POL_LIST.AGT_ID as AGT_ID,
exp_ING_POL_LIST.POL_ISS_DT as POL_ISS_DT,
exp_ING_POL_LIST.SERV_CENTER_NUM as SERV_CENTER_NUM,
exp_ING_POL_LIST.POLICY_TYPE as POLICY_TYPE,
exp_ING_POL_LIST.POL_STATUS as POL_STATUS,
exp_ING_POL_LIST.POL_CNFD_IND as POL_CNFD_IND,
exp_ING_POL_LIST.BASE_PLAN_ID as BASE_PLAN_ID,
exp_ING_POL_LIST.BASE_FACE_AMT as BASE_FACE_AMT,
exp_ING_POL_LIST.BILL_MODE as BILL_MODE,
exp_ING_POL_LIST.CURR_CASH_VALUE as CURR_CASH_VALUE,
exp_ING_POL_LIST.OWNER_FIRST_NM as OWNER_FIRST_NM,
exp_ING_POL_LIST.OWNER_MID_NM as OWNER_MID_NM,
exp_ING_POL_LIST.OWNER_LAST_NM as OWNER_LAST_NM,
exp_ING_POL_LIST.OWNER_SFX_NM as OWNER_SFX_NM,
exp_ING_POL_LIST.LOAD_DT as LOAD_DT,
exp_ING_POL_LIST.FEED_IND as FEED_IND,
exp_ING_POL_LIST.FLG as FLG,
exp_ING_POL_LIST.ECTL_PRGM_ID as ECTL_PRGM_ID,
exp_ING_POL_LIST.ECTL_SRC_ID as ECTL_SRC_ID,
exp_ING_POL_LIST.ECTL_SRC_INST_ID as ECTL_SRC_INST_ID,
exp_ING_POL_LIST.ECTL_BATCH_ID as ECTL_BATCH_ID,
exp_ING_POL_LIST.ORIG_INS_TS as ORIG_INS_TS,
exp_ING_POL_LIST.ECTL_BATCH_START_DATE as ECTL_BATCH_START_DATE,
exp_ING_POL_LIST.source_record_id
FROM
exp_ING_POL_LIST
WHERE ( exp_ING_POL_LIST.FLG = ''NEW'' ) OR ( exp_ING_POL_LIST.FLG = ''UPD'' );


-- Component rtr_INS_UPD_UPDATE, Type ROUTER Output Group UPDATE
create or replace temp table rtr_INS_UPD_UPDATE as
SELECT
exp_ING_POL_LIST.POL_ID_lkp as POL_ID_lkp,
exp_ING_POL_LIST.CHG_EFF_DT_lkp as CHG_EFF_DT_lkp,
exp_ING_POL_LIST.CO_ID as CO_ID,
exp_ING_POL_LIST.POL_ID as POL_ID,
exp_ING_POL_LIST.INSURED_MEMBER_NUM as INSURED_MEMBER_NUM,
exp_ING_POL_LIST.PAYOR_MEMBER_NUM as PAYOR_MEMBER_NUM,
exp_ING_POL_LIST.ALPHA_CODE_INSURED as ALPHA_CODE_INSURED,
exp_ING_POL_LIST.ALPHA_CODE_OWNER as ALPHA_CODE_OWNER,
exp_ING_POL_LIST.ALPHA_CODE_PAYOR as ALPHA_CODE_PAYOR,
exp_ING_POL_LIST.ALPHA_CODE_JOINT as ALPHA_CODE_JOINT,
exp_ING_POL_LIST.INSURED_FIRST_NM as INSURED_FIRST_NM,
exp_ING_POL_LIST.INSURED_MID_NM as INSURED_MID_NM,
exp_ING_POL_LIST.INSURED_LAST_NM as INSURED_LAST_NM,
exp_ING_POL_LIST.INSURED_SFX_NM as INSURED_SFX_NM,
exp_ING_POL_LIST.PAYOR_FIRST_NM as PAYOR_FIRST_NM,
exp_ING_POL_LIST.PAYOR_MID_NM as PAYOR_MID_NM,
exp_ING_POL_LIST.PAYOR_LAST_NM as PAYOR_LAST_NM,
exp_ING_POL_LIST.PAYOR_SFX_NM as PAYOR_SFX_NM,
exp_ING_POL_LIST.INSURED_ADDR_LN_1 as INSURED_ADDR_LN_1,
exp_ING_POL_LIST.INSURED_ADDR_LN_2 as INSURED_ADDR_LN_2,
exp_ING_POL_LIST.INSURED_CITY_NM as INSURED_CITY_NM,
exp_ING_POL_LIST.INSURED_STATE_CD as INSURED_STATE_CD,
exp_ING_POL_LIST.INSURED_ZIP_CD as INSURED_ZIP_CD,
exp_ING_POL_LIST.INSURED_CLI_ID as INSURED_CLI_ID,
exp_ING_POL_LIST.OWNER_CLI_ID as OWNER_CLI_ID,
exp_ING_POL_LIST.PAYOR_CLI_ID as PAYOR_CLI_ID,
exp_ING_POL_LIST.SEC_INSURED_CLI_ID as SEC_INSURED_CLI_ID,
exp_ING_POL_LIST.INSURED_SSN as INSURED_SSN,
exp_ING_POL_LIST.OWNER_SSN as OWNER_SSN,
exp_ING_POL_LIST.PAYOR_SSN as PAYOR_SSN,
exp_ING_POL_LIST.SEC_INSURED_SSN as SEC_INSURED_SSN,
exp_ING_POL_LIST.AGT_ID as AGT_ID,
exp_ING_POL_LIST.POL_ISS_DT as POL_ISS_DT,
exp_ING_POL_LIST.SERV_CENTER_NUM as SERV_CENTER_NUM,
exp_ING_POL_LIST.POLICY_TYPE as POLICY_TYPE,
exp_ING_POL_LIST.POL_STATUS as POL_STATUS,
exp_ING_POL_LIST.POL_CNFD_IND as POL_CNFD_IND,
exp_ING_POL_LIST.BASE_PLAN_ID as BASE_PLAN_ID,
exp_ING_POL_LIST.BASE_FACE_AMT as BASE_FACE_AMT,
exp_ING_POL_LIST.BILL_MODE as BILL_MODE,
exp_ING_POL_LIST.CURR_CASH_VALUE as CURR_CASH_VALUE,
exp_ING_POL_LIST.OWNER_FIRST_NM as OWNER_FIRST_NM,
exp_ING_POL_LIST.OWNER_MID_NM as OWNER_MID_NM,
exp_ING_POL_LIST.OWNER_LAST_NM as OWNER_LAST_NM,
exp_ING_POL_LIST.OWNER_SFX_NM as OWNER_SFX_NM,
exp_ING_POL_LIST.LOAD_DT as LOAD_DT,
exp_ING_POL_LIST.FEED_IND as FEED_IND,
exp_ING_POL_LIST.FLG as FLG,
exp_ING_POL_LIST.ECTL_PRGM_ID as ECTL_PRGM_ID,
exp_ING_POL_LIST.ECTL_SRC_ID as ECTL_SRC_ID,
exp_ING_POL_LIST.ECTL_SRC_INST_ID as ECTL_SRC_INST_ID,
exp_ING_POL_LIST.ECTL_BATCH_ID as ECTL_BATCH_ID,
exp_ING_POL_LIST.ORIG_INS_TS as ORIG_INS_TS,
exp_ING_POL_LIST.ECTL_BATCH_START_DATE as ECTL_BATCH_START_DATE,
exp_ING_POL_LIST.source_record_id
FROM
exp_ING_POL_LIST
WHERE exp_ING_POL_LIST.FLG = ''UPD'';


-- Component exp_GET_EXP_DT, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_GET_EXP_DT AS
(
SELECT
rtr_INS_UPD_INSERT.CO_ID as CO_ID1,
rtr_INS_UPD_INSERT.POL_ID as POL_ID1,
rtr_INS_UPD_INSERT.INSURED_MEMBER_NUM as INSURED_MEMBER_NUM1,
rtr_INS_UPD_INSERT.PAYOR_MEMBER_NUM as PAYOR_MEMBER_NUM1,
rtr_INS_UPD_INSERT.ALPHA_CODE_INSURED as ALPHA_CODE_INSURED1,
rtr_INS_UPD_INSERT.ALPHA_CODE_OWNER as ALPHA_CODE_OWNER1,
rtr_INS_UPD_INSERT.ALPHA_CODE_PAYOR as ALPHA_CODE_PAYOR1,
rtr_INS_UPD_INSERT.ALPHA_CODE_JOINT as ALPHA_CODE_JOINT1,
rtr_INS_UPD_INSERT.INSURED_FIRST_NM as INSURED_FIRST_NM1,
rtr_INS_UPD_INSERT.INSURED_MID_NM as INSURED_MID_NM1,
rtr_INS_UPD_INSERT.INSURED_LAST_NM as INSURED_LAST_NM1,
rtr_INS_UPD_INSERT.INSURED_SFX_NM as INSURED_SFX_NM1,
rtr_INS_UPD_INSERT.PAYOR_FIRST_NM as PAYOR_FIRST_NM1,
rtr_INS_UPD_INSERT.PAYOR_MID_NM as PAYOR_MID_NM1,
rtr_INS_UPD_INSERT.PAYOR_LAST_NM as PAYOR_LAST_NM1,
rtr_INS_UPD_INSERT.PAYOR_SFX_NM as PAYOR_SFX_NM1,
rtr_INS_UPD_INSERT.INSURED_ADDR_LN_1 as INSURED_ADDR_LN_11,
rtr_INS_UPD_INSERT.INSURED_ADDR_LN_2 as INSURED_ADDR_LN_21,
rtr_INS_UPD_INSERT.INSURED_CITY_NM as INSURED_CITY_NM1,
rtr_INS_UPD_INSERT.INSURED_STATE_CD as INSURED_STATE_CD1,
rtr_INS_UPD_INSERT.INSURED_ZIP_CD as INSURED_ZIP_CD1,
rtr_INS_UPD_INSERT.INSURED_CLI_ID as INSURED_CLI_ID1,
rtr_INS_UPD_INSERT.OWNER_CLI_ID as OWNER_CLI_ID1,
rtr_INS_UPD_INSERT.PAYOR_CLI_ID as PAYOR_CLI_ID1,
rtr_INS_UPD_INSERT.SEC_INSURED_CLI_ID as SEC_INSURED_CLI_ID1,
rtr_INS_UPD_INSERT.INSURED_SSN as INSURED_SSN1,
rtr_INS_UPD_INSERT.OWNER_SSN as OWNER_SSN1,
rtr_INS_UPD_INSERT.PAYOR_SSN as PAYOR_SSN1,
rtr_INS_UPD_INSERT.SEC_INSURED_SSN as SEC_INSURED_SSN1,
rtr_INS_UPD_INSERT.AGT_ID as AGT_ID1,
rtr_INS_UPD_INSERT.POL_ISS_DT as POL_ISS_DT1,
rtr_INS_UPD_INSERT.SERV_CENTER_NUM as SERV_CENTER_NUM1,
rtr_INS_UPD_INSERT.POLICY_TYPE as POLICY_TYPE1,
rtr_INS_UPD_INSERT.POL_STATUS as POL_STATUS1,
rtr_INS_UPD_INSERT.POL_CNFD_IND as POL_CNFD_IND1,
rtr_INS_UPD_INSERT.BASE_PLAN_ID as BASE_PLAN_ID1,
rtr_INS_UPD_INSERT.BASE_FACE_AMT as BASE_FACE_AMT1,
rtr_INS_UPD_INSERT.BILL_MODE as BILL_MODE1,
rtr_INS_UPD_INSERT.CURR_CASH_VALUE as CURR_CASH_VALUE1,
rtr_INS_UPD_INSERT.OWNER_FIRST_NM as OWNER_FIRST_NM1,
rtr_INS_UPD_INSERT.OWNER_MID_NM as OWNER_MID_NM1,
rtr_INS_UPD_INSERT.OWNER_LAST_NM as OWNER_LAST_NM1,
rtr_INS_UPD_INSERT.OWNER_SFX_NM as OWNER_SFX_NM1,
rtr_INS_UPD_INSERT.FEED_IND as FEED_IND1,
rtr_INS_UPD_INSERT.ECTL_PRGM_ID as ECTL_PRGM_ID1,
rtr_INS_UPD_INSERT.ECTL_SRC_ID as ECTL_SRC_ID1,
rtr_INS_UPD_INSERT.ECTL_SRC_INST_ID as ECTL_SRC_INST_ID1,
rtr_INS_UPD_INSERT.ECTL_BATCH_ID as ECTL_BATCH_ID1,
rtr_INS_UPD_INSERT.ORIG_INS_TS as ORIG_INS_TS1,
rtr_INS_UPD_INSERT.ECTL_BATCH_START_DATE as ECTL_BATCH_START_DATE1,
''NEW'' as out_ECTL_TX_CD,
TO_CHAR ( ( DATE_PART(''YYYY'', TO_TIMESTAMP(rtr_INS_UPD_INSERT.LOAD_DT)) * 10000 ) + ( DATE_PART(''MM'', TO_TIMESTAMP(rtr_INS_UPD_INSERT.LOAD_DT)) * 100 ) + 1 ) as var_FIRST_DAY_EFF_DT,
TO_DATE ( var_FIRST_DAY_EFF_DT , ''YYYYMMDD'' ) as var_CHG_EFF_DT,
CASE WHEN rtr_INS_UPD_INSERT.CHG_EFF_DT_lkp >= var_CHG_EFF_DT THEN  rtr_INS_UPD_INSERT.CHG_EFF_DT_lkp + 1  ELSE var_CHG_EFF_DT END as out_CHG_EFF_DT,
TO_DATE ( ''9999-12-31'' , ''YYYY-MM-DD'' ) as out_CHG_EXP_DT_NEW,
TO_DATE ( ''9999-12-31'' , ''YYYY-MM-DD'' ) as out_ECTL_END_DT,
rtr_INS_UPD_INSERT.source_record_id
FROM
rtr_INS_UPD_INSERT
);


-- Component exp_GET_EFF_DT, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_GET_EFF_DT AS
(
SELECT
rtr_INS_UPD_UPDATE.POL_ID_lkp as POL_ID_lkp3,
rtr_INS_UPD_UPDATE.CHG_EFF_DT_lkp as CHG_EFF_DT_lkp3,
rtr_INS_UPD_UPDATE.CO_ID as CO_ID3,
rtr_INS_UPD_UPDATE.POL_ID as POL_ID3,
rtr_INS_UPD_UPDATE.INSURED_MEMBER_NUM as INSURED_MEMBER_NUM3,
rtr_INS_UPD_UPDATE.PAYOR_MEMBER_NUM as PAYOR_MEMBER_NUM3,
rtr_INS_UPD_UPDATE.ALPHA_CODE_INSURED as ALPHA_CODE_INSURED3,
rtr_INS_UPD_UPDATE.ALPHA_CODE_OWNER as ALPHA_CODE_OWNER3,
rtr_INS_UPD_UPDATE.ALPHA_CODE_PAYOR as ALPHA_CODE_PAYOR3,
rtr_INS_UPD_UPDATE.ALPHA_CODE_JOINT as ALPHA_CODE_JOINT3,
rtr_INS_UPD_UPDATE.INSURED_FIRST_NM as INSURED_FIRST_NM3,
rtr_INS_UPD_UPDATE.INSURED_MID_NM as INSURED_MID_NM3,
rtr_INS_UPD_UPDATE.INSURED_LAST_NM as INSURED_LAST_NM3,
rtr_INS_UPD_UPDATE.INSURED_SFX_NM as INSURED_SFX_NM3,
rtr_INS_UPD_UPDATE.PAYOR_FIRST_NM as PAYOR_FIRST_NM3,
rtr_INS_UPD_UPDATE.PAYOR_MID_NM as PAYOR_MID_NM3,
rtr_INS_UPD_UPDATE.PAYOR_LAST_NM as PAYOR_LAST_NM3,
rtr_INS_UPD_UPDATE.PAYOR_SFX_NM as PAYOR_SFX_NM3,
rtr_INS_UPD_UPDATE.INSURED_ADDR_LN_1 as INSURED_ADDR_LN_13,
rtr_INS_UPD_UPDATE.INSURED_ADDR_LN_2 as INSURED_ADDR_LN_23,
rtr_INS_UPD_UPDATE.INSURED_CITY_NM as INSURED_CITY_NM3,
rtr_INS_UPD_UPDATE.INSURED_STATE_CD as INSURED_STATE_CD3,
rtr_INS_UPD_UPDATE.INSURED_ZIP_CD as INSURED_ZIP_CD3,
rtr_INS_UPD_UPDATE.INSURED_CLI_ID as INSURED_CLI_ID3,
rtr_INS_UPD_UPDATE.OWNER_CLI_ID as OWNER_CLI_ID3,
rtr_INS_UPD_UPDATE.PAYOR_CLI_ID as PAYOR_CLI_ID3,
rtr_INS_UPD_UPDATE.SEC_INSURED_CLI_ID as SEC_INSURED_CLI_ID3,
rtr_INS_UPD_UPDATE.INSURED_SSN as INSURED_SSN3,
rtr_INS_UPD_UPDATE.OWNER_SSN as OWNER_SSN3,
rtr_INS_UPD_UPDATE.PAYOR_SSN as PAYOR_SSN3,
rtr_INS_UPD_UPDATE.SEC_INSURED_SSN as SEC_INSURED_SSN3,
rtr_INS_UPD_UPDATE.AGT_ID as AGT_ID3,
rtr_INS_UPD_UPDATE.POL_ISS_DT as POL_ISS_DT3,
rtr_INS_UPD_UPDATE.SERV_CENTER_NUM as SERV_CENTER_NUM3,
rtr_INS_UPD_UPDATE.POLICY_TYPE as POLICY_TYPE3,
rtr_INS_UPD_UPDATE.POL_STATUS as POL_STATUS3,
rtr_INS_UPD_UPDATE.POL_CNFD_IND as POL_CNFD_IND3,
rtr_INS_UPD_UPDATE.BASE_PLAN_ID as BASE_PLAN_ID3,
rtr_INS_UPD_UPDATE.BASE_FACE_AMT as BASE_FACE_AMT3,
rtr_INS_UPD_UPDATE.BILL_MODE as BILL_MODE3,
rtr_INS_UPD_UPDATE.CURR_CASH_VALUE as CURR_CASH_VALUE3,
rtr_INS_UPD_UPDATE.OWNER_FIRST_NM as OWNER_FIRST_NM3,
rtr_INS_UPD_UPDATE.OWNER_MID_NM as OWNER_MID_NM3,
rtr_INS_UPD_UPDATE.OWNER_LAST_NM as OWNER_LAST_NM3,
rtr_INS_UPD_UPDATE.OWNER_SFX_NM as OWNER_SFX_NM3,
rtr_INS_UPD_UPDATE.LOAD_DT as LOAD_DT3,
rtr_INS_UPD_UPDATE.FEED_IND as FEED_IND3,
rtr_INS_UPD_UPDATE.FLG as FLG3,
rtr_INS_UPD_UPDATE.ECTL_PRGM_ID as ECTL_PRGM_ID3,
rtr_INS_UPD_UPDATE.ECTL_SRC_ID as ECTL_SRC_ID3,
rtr_INS_UPD_UPDATE.ECTL_SRC_INST_ID as ECTL_SRC_INST_ID3,
rtr_INS_UPD_UPDATE.ECTL_BATCH_ID as ECTL_BATCH_ID3,
rtr_INS_UPD_UPDATE.ORIG_INS_TS as ORIG_INS_TS3,
rtr_INS_UPD_UPDATE.ECTL_BATCH_START_DATE as ECTL_BATCH_START_DATE3,
TO_CHAR ( ( DATE_PART(''YYYY'', TO_TIMESTAMP(rtr_INS_UPD_UPDATE.LOAD_DT)) * 10000 ) + ( DATE_PART(''MM'', TO_TIMESTAMP(rtr_INS_UPD_UPDATE.LOAD_DT)) * 100 ) + 1 ) as var_FIRST_DAY_EFF_DT,
 TO_DATE ( var_FIRST_DAY_EFF_DT  )  - 1  as var_CHG_EXP_DT_NEW,
CASE WHEN rtr_INS_UPD_UPDATE.CHG_EFF_DT_lkp >= TO_DATE ( var_FIRST_DAY_EFF_DT , ''YYYYMMDD'' ) THEN rtr_INS_UPD_UPDATE.CHG_EFF_DT_lkp ELSE var_CHG_EXP_DT_NEW END as out_CHG_EXP_DT_NEW,
CURRENT_TIMESTAMP as out_ECTL_END_DT,
rtr_INS_UPD_UPDATE.source_record_id
FROM
rtr_INS_UPD_UPDATE
);


-- Component ING_POL_LIST_INS, Type TARGET 
INSERT INTO DB_T_CORE_MEMBXREF_PROD.ING_POL_LIST
(
CO_ID,
POL_ID,
CHG_EFF_DT,
CHG_EXP_DT,
INSURED_MEMBER_NUM,
PAYOR_MEMBER_NUM,
ALPHA_CODE_INSURED,
ALPHA_CODE_OWNER,
ALPHA_CODE_PAYOR,
ALPHA_CODE_JOINT,
INSURED_FIRST_NM,
INSURED_MID_NM,
INSURED_LAST_NM,
INSURED_SFX_NM,
PAYOR_FIRST_NM,
PAYOR_MID_NM,
PAYOR_LAST_NM,
PAYOR_SFX_NM,
INSURED_ADDR_LN_1,
INSURED_ADDR_LN_2,
INSURED_CITY_NM,
INSURED_STATE_CD,
INSURED_ZIP_CD,
INSURED_CLI_ID,
OWNER_CLI_ID,
PAYOR_CLI_ID,
SEC_INSURED_CLI_ID,
INSURED_SSN,
OWNER_SSN,
PAYOR_SSN,
SEC_INSURED_SSN,
AGT_ID,
POL_ISS_DT,
SERV_CENTER_NUM,
POLICY_TYPE,
POL_STATUS,
POL_CNFD_IND,
BASE_PLAN_ID,
BASE_FACE_AMT,
BILL_MODE,
CURR_CASH_VALUE,
OWNER_FIRST_NM,
OWNER_MID_NM,
OWNER_LAST_NM,
OWNER_SFX_NM,
FEED_IND,
ECTL_BATCH_ID,
ECTL_ORIG_INS_TS,
ECTL_MODIFY_TS,
ECTL_SRC_ID,
ECTL_SRC_INST_ID,
ECTL_PRGM_ID,
ECTL_TX_CD,
ECTL_START_DATE,
ECTL_END_DATE
)
SELECT
exp_GET_EXP_DT.CO_ID1 as CO_ID,
exp_GET_EXP_DT.POL_ID1 as POL_ID,
exp_GET_EXP_DT.out_CHG_EFF_DT as CHG_EFF_DT,
exp_GET_EXP_DT.out_CHG_EXP_DT_NEW as CHG_EXP_DT,
exp_GET_EXP_DT.INSURED_MEMBER_NUM1 as INSURED_MEMBER_NUM,
exp_GET_EXP_DT.PAYOR_MEMBER_NUM1 as PAYOR_MEMBER_NUM,
exp_GET_EXP_DT.ALPHA_CODE_INSURED1 as ALPHA_CODE_INSURED,
exp_GET_EXP_DT.ALPHA_CODE_OWNER1 as ALPHA_CODE_OWNER,
exp_GET_EXP_DT.ALPHA_CODE_PAYOR1 as ALPHA_CODE_PAYOR,
exp_GET_EXP_DT.ALPHA_CODE_JOINT1 as ALPHA_CODE_JOINT,
exp_GET_EXP_DT.INSURED_FIRST_NM1 as INSURED_FIRST_NM,
exp_GET_EXP_DT.INSURED_MID_NM1 as INSURED_MID_NM,
exp_GET_EXP_DT.INSURED_LAST_NM1 as INSURED_LAST_NM,
exp_GET_EXP_DT.INSURED_SFX_NM1 as INSURED_SFX_NM,
exp_GET_EXP_DT.PAYOR_FIRST_NM1 as PAYOR_FIRST_NM,
exp_GET_EXP_DT.PAYOR_MID_NM1 as PAYOR_MID_NM,
exp_GET_EXP_DT.PAYOR_LAST_NM1 as PAYOR_LAST_NM,
exp_GET_EXP_DT.PAYOR_SFX_NM1 as PAYOR_SFX_NM,
exp_GET_EXP_DT.INSURED_ADDR_LN_11 as INSURED_ADDR_LN_1,
exp_GET_EXP_DT.INSURED_ADDR_LN_21 as INSURED_ADDR_LN_2,
exp_GET_EXP_DT.INSURED_CITY_NM1 as INSURED_CITY_NM,
exp_GET_EXP_DT.INSURED_STATE_CD1 as INSURED_STATE_CD,
exp_GET_EXP_DT.INSURED_ZIP_CD1 as INSURED_ZIP_CD,
exp_GET_EXP_DT.INSURED_CLI_ID1 as INSURED_CLI_ID,
exp_GET_EXP_DT.OWNER_CLI_ID1 as OWNER_CLI_ID,
exp_GET_EXP_DT.PAYOR_CLI_ID1 as PAYOR_CLI_ID,
exp_GET_EXP_DT.SEC_INSURED_CLI_ID1 as SEC_INSURED_CLI_ID,
exp_GET_EXP_DT.INSURED_SSN1 as INSURED_SSN,
exp_GET_EXP_DT.OWNER_SSN1 as OWNER_SSN,
exp_GET_EXP_DT.PAYOR_SSN1 as PAYOR_SSN,
exp_GET_EXP_DT.SEC_INSURED_SSN1 as SEC_INSURED_SSN,
exp_GET_EXP_DT.AGT_ID1 as AGT_ID,
exp_GET_EXP_DT.POL_ISS_DT1 as POL_ISS_DT,
exp_GET_EXP_DT.SERV_CENTER_NUM1 as SERV_CENTER_NUM,
exp_GET_EXP_DT.POLICY_TYPE1 as POLICY_TYPE,
exp_GET_EXP_DT.POL_STATUS1 as POL_STATUS,
exp_GET_EXP_DT.POL_CNFD_IND1 as POL_CNFD_IND,
exp_GET_EXP_DT.BASE_PLAN_ID1 as BASE_PLAN_ID,
exp_GET_EXP_DT.BASE_FACE_AMT1 as BASE_FACE_AMT,
exp_GET_EXP_DT.BILL_MODE1 as BILL_MODE,
exp_GET_EXP_DT.CURR_CASH_VALUE1 as CURR_CASH_VALUE,
exp_GET_EXP_DT.OWNER_FIRST_NM1 as OWNER_FIRST_NM,
exp_GET_EXP_DT.OWNER_MID_NM1 as OWNER_MID_NM,
exp_GET_EXP_DT.OWNER_LAST_NM1 as OWNER_LAST_NM,
exp_GET_EXP_DT.OWNER_SFX_NM1 as OWNER_SFX_NM,
exp_GET_EXP_DT.FEED_IND1 as FEED_IND,
exp_GET_EXP_DT.ECTL_BATCH_ID1 as ECTL_BATCH_ID,
exp_GET_EXP_DT.ORIG_INS_TS1 as ECTL_ORIG_INS_TS,
exp_GET_EXP_DT.ORIG_INS_TS1 as ECTL_MODIFY_TS,
exp_GET_EXP_DT.ECTL_SRC_ID1 as ECTL_SRC_ID,
exp_GET_EXP_DT.ECTL_SRC_INST_ID1 as ECTL_SRC_INST_ID,
exp_GET_EXP_DT.ECTL_PRGM_ID1 as ECTL_PRGM_ID,
exp_GET_EXP_DT.out_ECTL_TX_CD as ECTL_TX_CD,
exp_GET_EXP_DT.ECTL_BATCH_START_DATE1 as ECTL_START_DATE,
exp_GET_EXP_DT.out_ECTL_END_DT as ECTL_END_DATE
FROM
exp_GET_EXP_DT;


-- Component upd_ING_POL_LIST, Type UPDATE 
CREATE OR REPLACE TEMPORARY TABLE upd_ING_POL_LIST AS
(
/* UPDATE_STRATEGY_ACTION = 0 FOR INSERT / UPDATE_STRATEGY_ACTION = 1 FOR UPDATE / UPDATE_STRATEGY_ACTION = 2 FOR DELETE / UPDATE_STRATEGY_ACTION = 3 FOR REJECT */
SELECT
exp_GET_EFF_DT.POL_ID_lkp3 as POL_ID_lkp3,
exp_GET_EFF_DT.CHG_EFF_DT_lkp3 as CHG_EFF_DT_lkp3,
exp_GET_EFF_DT.CO_ID3 as CO_ID3,
exp_GET_EFF_DT.POL_ID3 as POL_ID3,
exp_GET_EFF_DT.INSURED_MEMBER_NUM3 as INSURED_MEMBER_NUM3,
exp_GET_EFF_DT.PAYOR_MEMBER_NUM3 as PAYOR_MEMBER_NUM3,
exp_GET_EFF_DT.ALPHA_CODE_INSURED3 as ALPHA_CODE_INSURED3,
exp_GET_EFF_DT.ALPHA_CODE_OWNER3 as ALPHA_CODE_OWNER3,
exp_GET_EFF_DT.ALPHA_CODE_PAYOR3 as ALPHA_CODE_PAYOR3,
exp_GET_EFF_DT.ALPHA_CODE_JOINT3 as ALPHA_CODE_JOINT3,
exp_GET_EFF_DT.INSURED_FIRST_NM3 as INSURED_FIRST_NM3,
exp_GET_EFF_DT.INSURED_MID_NM3 as INSURED_MID_NM3,
exp_GET_EFF_DT.INSURED_LAST_NM3 as INSURED_LAST_NM3,
exp_GET_EFF_DT.INSURED_SFX_NM3 as INSURED_SFX_NM3,
exp_GET_EFF_DT.PAYOR_FIRST_NM3 as PAYOR_FIRST_NM3,
exp_GET_EFF_DT.PAYOR_MID_NM3 as PAYOR_MID_NM3,
exp_GET_EFF_DT.PAYOR_LAST_NM3 as PAYOR_LAST_NM3,
exp_GET_EFF_DT.PAYOR_SFX_NM3 as PAYOR_SFX_NM3,
exp_GET_EFF_DT.INSURED_ADDR_LN_13 as INSURED_ADDR_LN_13,
exp_GET_EFF_DT.INSURED_ADDR_LN_23 as INSURED_ADDR_LN_23,
exp_GET_EFF_DT.INSURED_CITY_NM3 as INSURED_CITY_NM3,
exp_GET_EFF_DT.INSURED_STATE_CD3 as INSURED_STATE_CD3,
exp_GET_EFF_DT.INSURED_ZIP_CD3 as INSURED_ZIP_CD3,
exp_GET_EFF_DT.INSURED_CLI_ID3 as INSURED_CLI_ID3,
exp_GET_EFF_DT.OWNER_CLI_ID3 as OWNER_CLI_ID3,
exp_GET_EFF_DT.PAYOR_CLI_ID3 as PAYOR_CLI_ID3,
exp_GET_EFF_DT.SEC_INSURED_CLI_ID3 as SEC_INSURED_CLI_ID3,
exp_GET_EFF_DT.INSURED_SSN3 as INSURED_SSN3,
exp_GET_EFF_DT.OWNER_SSN3 as OWNER_SSN3,
exp_GET_EFF_DT.PAYOR_SSN3 as PAYOR_SSN3,
exp_GET_EFF_DT.SEC_INSURED_SSN3 as SEC_INSURED_SSN3,
exp_GET_EFF_DT.AGT_ID3 as AGT_ID3,
exp_GET_EFF_DT.POL_ISS_DT3 as POL_ISS_DT3,
exp_GET_EFF_DT.SERV_CENTER_NUM3 as SERV_CENTER_NUM3,
exp_GET_EFF_DT.POLICY_TYPE3 as POLICY_TYPE3,
exp_GET_EFF_DT.POL_STATUS3 as POL_STATUS3,
exp_GET_EFF_DT.POL_CNFD_IND3 as POL_CNFD_IND3,
exp_GET_EFF_DT.BASE_PLAN_ID3 as BASE_PLAN_ID3,
exp_GET_EFF_DT.BASE_FACE_AMT3 as BASE_FACE_AMT3,
exp_GET_EFF_DT.BILL_MODE3 as BILL_MODE3,
exp_GET_EFF_DT.CURR_CASH_VALUE3 as CURR_CASH_VALUE3,
exp_GET_EFF_DT.OWNER_FIRST_NM3 as OWNER_FIRST_NM3,
exp_GET_EFF_DT.OWNER_MID_NM3 as OWNER_MID_NM3,
exp_GET_EFF_DT.OWNER_LAST_NM3 as OWNER_LAST_NM3,
exp_GET_EFF_DT.OWNER_SFX_NM3 as OWNER_SFX_NM3,
exp_GET_EFF_DT.LOAD_DT3 as LOAD_DT3,
exp_GET_EFF_DT.FEED_IND3 as FEED_IND3,
exp_GET_EFF_DT.FLG3 as FLG3,
exp_GET_EFF_DT.ECTL_PRGM_ID3 as ECTL_PRGM_ID3,
exp_GET_EFF_DT.ECTL_SRC_ID3 as ECTL_SRC_ID3,
exp_GET_EFF_DT.ECTL_SRC_INST_ID3 as ECTL_SRC_INST_ID3,
exp_GET_EFF_DT.ECTL_BATCH_ID3 as ECTL_BATCH_ID3,
exp_GET_EFF_DT.ORIG_INS_TS3 as ORIG_INS_TS3,
exp_GET_EFF_DT.ECTL_BATCH_START_DATE3 as ECTL_BATCH_START_DATE3,
exp_GET_EFF_DT.out_CHG_EXP_DT_NEW as out_CHG_EXP_DT_NEW,
exp_GET_EFF_DT.out_ECTL_END_DT as out_ECTL_END_DT,
1 as UPDATE_STRATEGY_ACTION
FROM
exp_GET_EFF_DT
);


-- Component ING_POL_LIST_UPD, Type TARGET 
/* Perform Updates */
MERGE INTO DB_T_core_MEMBXREF_PROD.ING_POL_LIST
USING upd_ING_POL_LIST
ON (POL_ID = upd_ING_POL_LIST.POL_ID_lkp3 AND CHG_EFF_DT = upd_ING_POL_LIST.CHG_EFF_DT_lkp3)
WHEN MATCHED THEN UPDATE SET
ECTL_BATCH_ID = upd_ING_POL_LIST.ECTL_BATCH_ID3, ECTL_MODIFY_TS = upd_ING_POL_LIST.ORIG_INS_TS3, 
--ECTL_TX_CD = upd_ING_POL_LIST.ECTL_TX_CD,
ECTL_END_DATE = upd_ING_POL_LIST.out_ECTL_END_DT,CHG_EXP_DT = upd_ING_POL_LIST.out_CHG_EXP_DT_NEW;


-- PIPELINE END FOR 2

END; ';
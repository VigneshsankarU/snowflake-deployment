-- Object Type: PROCEDURES
CREATE OR REPLACE PROCEDURE ALFA_EDW_DEV.PUBLIC.M_BIBASE_D_AUTO_PLCY("WORKLET_NAME" VARCHAR)
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS ' DECLARE
  CAL_END_DT STRING;
  CAL_END_MTH_ID STRING;
  run_id STRING;
  workflow_name STRING;
  session_name STRING;
BEGIN
  run_id := public.func_get_scoped_param(:run_id, ''run_id'', :workflow_name, :worklet_name, :session_name);
  workflow_name := public.func_get_scoped_param(:run_id, ''workflow_name'', :workflow_name, :worklet_name, :session_name);
  session_name := public.func_get_scoped_param(:run_id, ''session_name'', :workflow_name, :worklet_name, :session_name);

  CAL_END_DT := public.func_get_scoped_param(:run_id, ''cal_end_dt'', :workflow_name, :worklet_name, :session_name);
  CAL_END_MTH_ID := public.func_get_scoped_param(:run_id, ''cal_end_mth_id'', :workflow_name, :worklet_name, :session_name);
 

-- Component sq_AGMT, Type SOURCE 
CREATE OR REPLACE TEMPORARY TABLE sq_AGMT AS
(
SELECT /* adding column aliases to ensure proper downstream column references */
$1 as MO_ID,
$2 as PRODUCER_ID,
$3 as BUSN_TYPE_CD,
$4 as PLCY_NUM,
$5 as FRST_NAME,
$6 as LAST_NAME,
$7 as AGNT_NUM,
$8 as SRVC_CTR_NUM,
$9 as COMBO_IND,
$10 as MIN_LMTS_IND,
$11 as PLEASURE_USE_IND,
$12 as SHRT_ANNUAL_MILES_IND,
$13 as MULTICAR_IND,
$14 as LIABTY_ONLY_IND,
$15 as SRC_SYS_CD,
$16 as YOUTHFUL_IND,
$17 as LOSS_OF_USE_IND,
$18 as MED_PAY_IND,
$19 as PROD_NAME,
$20 as source_record_id
FROM (
SELECT SRC.*, row_number() over (order by 1) AS source_record_id FROM (
SELECT	

:CAL_END_MTH_ID AS MO_ID,

AGNT_NUM AS PRODUCER_ID,

 CASE 

	WHEN	(PREV.HOST_AGMT_NUM  IS  NULL 

	AND	 AG.PLCY_NBR NOT LIKE ''16%'' 

	AND	  AG.PLCY_NBR NOT LIKE ''14%'' 

	AND	  AG.PLCY_NBR NOT LIKE ''12%''

 AND    AG.PLCY_NBR NOT LIKE ''18%''

 AND  AG.PLCY_NBR NOT LIKE ''A%'' 

	AND	 AG.PLCY_NBR NOT LIKE ''G%'' ) THEN ''NEW'' 

ELSE	''EXISTING'' 

END	BUSN_TYPE_CD

,PLCY_NBR

,GVN_NAME AS FRST_NAME

,FMLY_NAME AS LAST_NAM

,AGNT_NUM AS AGNT_NUM

,SC_NUM AS SRVC_CTR_NUM

, MAX(COALESCE(CD_DISC_IND,''N'')) CD_DISC_IND

,MAX(COALESCE(MIN_BI_LIMIT,''N'')) MIN_BI_LIMIT

,MAX(COALESCE(PLEASURE_USE_IND,''N'')) PLEASURE_USE_IND

,MAX(COALESCE(ANNUAL_DSTC_MEAS,''N'')) ANNUAL_DSTC_MEAS,

MAX(COALESCE(MTC_DISC_IND,''N'')) MTC_DISC_IND 

,MAX(COALESCE(LIABTY_ONLY_IND,''N''))  LIABTY_ONLY_IND

,''GW'' AS SRC_SYS_CD

,MAX(

CASE	WHEN (YOUTHFUL_CNT>=1) THEN ''Y'' 

ELSE	''N''   

END	) AS YOUTHFUL_IND

,MAX(COALESCE(LOU_IND,''N''))  LOSS_OF_USE_IND 

,MAX(COALESCE(MED_IND,''N'')) MED_PAY_IND,

PROD_NAME

 FROM 

(

SELECT A.AGMT_ID,  ast.AGMT_STS_CD,

A.HOST_AGMT_NUM PLCY_NBR,P.PROD_NAME,a.CNTNUS_SRVC_DTTM,

CASE WHEN a.MODL_EFF_DTTM > a.MODL_CRTN_DTTM THEN a.MODL_EFF_DTTM 

ELSE a.MODL_CRTN_DTTM END AS NEW_AGMT_EFF_DTTM 
FROM  db_t_prod_core.AGMT AS A 

JOIN  db_t_prod_core.AGMT TRM 

ON TRM.HOST_AGMT_NUM=A.HOST_AGMT_NUM AND TRM.TERM_NUM=A.TERM_NUM 

and    TRM.AGMT_TYPE_CD=''POLTRM''   AND CAST(CAST('':CAL_END_DT'' AS DATE)+1 AS TIMESTAMP(6)) - INTERVAL ''0.000001 SECOND'' 

BETWEEN trm.AGMT_EFF_DTTM AND trm.AGMT_PLND_EXPN_DTTM 

AND A.EDW_END_DTTM =''9999-12-31 23:59:59.999999''

JOIN db_t_prod_core.AGMT_STS  AS AS1  ON  TRM.AGMT_ID=AS1.AGMT_ID 

AND AS1.AGMT_STS_STRT_DTTM <= CAST(CAST('':CAL_END_DT'' AS DATE)+1 AS TIMESTAMP(6)) - INTERVAL ''0.000001 SECOND'' 

and NEW_AGMT_EFF_DTTM < CAST(CAST('':CAL_END_DT''  AS DATE)+1 AS TIMESTAMP(6)) - INTERVAL ''0.000001 SECOND''

AND A.AGMT_TYPE_CD = ''PPV'' AND AS1.AGMT_STS_CD <> ''CNFRMDDT'' 

JOIN db_t_prod_core.AGMT_PROD  AS AP ON A.AGMT_ID=AP.AGMT_ID  AND AP.AGMT_PROD_ROLE_CD=''PLCYTYPE''

AND  '':CAL_END_DT''  BETWEEN CAST(AP.AGMT_PROD_STRT_DTTM AS DATE) AND CAST(AP.AGMT_PROD_END_DTTM AS DATE)

JOIN db_t_prod_core.PROD  P ON AP.PROD_ID=P.PROD_ID 

AND '':CAL_END_DT'' BETWEEN CAST(P.PROD_STRT_DTTM AS DATE) AND CAST(P.PROD_END_DTTM AS DATE)

AND P.EDW_END_DTTM =''9999-12-31 23:59:59.999999''

LEFT OUTER JOIN db_t_prod_core.AGMT_STS_TYPE AST ON AS1.AGMT_STS_CD = AST.AGMT_STS_CD 

LEFT OUTER JOIN db_t_prod_core.AGMT_MBRSHP  AS AM ON  A.AGMT_ID=AM.AGMT_ID

 AND '':CAL_END_DT'' BETWEEN CAST(AM.AGMT_MBRSHP_STRT_DTTM AS DATE) AND CAST(AM.AGMT_MBRSHP_END_DTTM AS DATE)

LEFT OUTER JOIN db_t_prod_core.MBRSHP   AS M ON M.MBRSHP_ID=AM.MBRSHP_ID AND CAST(M.EDW_END_DTTM AS DATE) =CAST( ''9999-12-31''  AS DATE)

WHERE 	  P.PROD_NAME IN (''PPV'',''PPV2'',''COMMERCIAL'')

QUALIFY ROW_NUMBER() OVER(PARTITION BY A.HOST_AGMT_NUM ORDER BY A.MODL_CRTN_DTTM DESC, A.MODL_EFF_DTTM DESC,  AS1.AGMT_STS_STRT_DTTM DESC, AS1.EDW_END_DTTM DESC) = 1



and ast.AGMT_STS_CD =''inforce''

) AG

 left outer join 

(

select	 T1.AGMT_ID,

SUM(

CASE	WHEN (CAST((extract( year from CAST('':CAL_END_DT'' AS DATE))-extract(year from cast(BIRTH_DT as date))) AS INTEGER) <25) THEN 1 

ELSE	0 

END	) YOUTHFUL_CNT

from	(

select	PA.AGMT_ID,PA.PRTY_ID,

CASE	WHEN  PA.PRTY_AGMT_ROLE_CD = ''RTDDRVR'' THEN  BIRTH_DT 

END	AS BIRTH_DT

FROM	 db_t_prod_core.PRTY_AGMT_ASSET AS PA  

 JOIN db_t_prod_core.INDIV AS INM 

	ON	PA.PRTY_ID = INM.INDIV_PRTY_ID  

WHERE	 PA.PRTY_AGMT_ROLE_CD IN (''RTDDRVR'')

	AND	CAST(INM.TRANS_STRT_DTTM AS DATE)<=to_date('':CAL_END_DT'',''YYYY-MM-DD'')  

	AND	CAST(INM.TRANS_END_DTTM AS DATE)>=to_date('':CAL_END_DT'', ''YYYY-MM-DD'')  

 QUALIFY ROW_NUMBER() OVER(PARTITION BY PA.AGMT_ID,PA.PRTY_ID 

ORDER	BY  PA.EDW_STRT_DTTM  DESC)=1)T1

   GROUP BY 1

  )AGE  

	ON	AG.AGMT_ID=AGE.AGMT_ID

left outer join 

(

select	AGMT_ID,

MAX(GVN_NAME) AS GVN_NAME,

MAX(FMLY_NAME) AS FMLY_NAME,

MAX(AGNT_NUM) AS AGNT_NUM, 

MAX(SC_NUM) AS SC_NUM 

FROM	(

select	PA.AGMT_ID,

CASE	WHEN  PA.PRTY_AGMT_ROLE_CD = ''PLCYPRININS'' THEN  UPPER(COALESCE(TRIM(INM.GVN_NAME),

		ORG_NAME)) 

END	AS GVN_NAME,

CASE	WHEN  PA.PRTY_AGMT_ROLE_CD = ''PLCYPRININS'' THEN UPPER(TRIM(INM.FMLY_NAME)) 

END	AS FMLY_NAME,

CASE	WHEN  PA.PRTY_AGMT_ROLE_CD = ''PRDA'' THEN  ltrim( IO.INTRNL_ORG_NUM,''0'') 

END	AS AGNT_NUM, 

CASE	WHEN  PA.PRTY_AGMT_ROLE_CD = ''SVC'' THEN  ltrim(IO.INTRNL_ORG_NUM,''0'') 

END	AS SC_NUM

FROM	 db_t_prod_core.PRTY_AGMT AS PA  

LEFT OUTER JOIN db_t_prod_core.INDIV_NAME AS INM 

	ON	PA.PRTY_ID = INM.INDIV_PRTY_ID 

	AND	 PA.PRTY_AGMT_ROLE_CD IN (''PLCYPRININS'') 

LEFT OUTER JOIN db_t_prod_core.ORG_NAME AS ORN 

	ON	PA.PRTY_ID = ORN.PRTY_ID 

LEFT OUTER JOIN db_t_prod_core.INTRNL_ORG AS IO 

	ON	PA.PRTY_ID = IO.INTRNL_ORG_PRTY_ID 

	AND	

PA.PRTY_AGMT_ROLE_CD = 

CASE	WHEN IO.INTRNL_ORG_SBTYPE_CD = ''SRVCCTR'' THEN ''SVC'' 

ELSE	IO.INTRNL_ORG_SBTYPE_CD 

END	 

WHERE	 PA.PRTY_AGMT_ROLE_CD IN (''PLCYPRININS'',''PRDA'',''SVC'') 

QUALIFY	ROW_NUMBER() OVER(PARTITION BY PA.AGMT_ID,PA.PRTY_ID,PA.PRTY_AGMT_ROLE_CD 

ORDER	BY PA.PRTY_AGMT_STRT_DTTM DESC, PA.TRANS_STRT_DTTM  DESC)=1

) T1 

GROUP	BY 1 )SVC_AGNT  

	ON	AG.AGMT_ID=SVC_AGNT.AGMT_ID

LEFT OUTER JOIN

(

select	AGMT_ID,

MAX(

CASE	WHEN (INSRNC_CVGE_TYPE_CD = ''BI'' 

	AND	FEAT_SBTYPE_CD = ''PKG'' 

	AND	FEAT_DTL_CD_NAME=''25K_50k'') THEN ''Y'' 

ELSE	''N'' 

END	) MIN_BI_LIMIT,

MAX(

CASE	WHEN ((INSRNC_CVGE_TYPE_CD )= ''COMP''  ) THEN ''Y'' 

ELSE	''N'' 

END	 ) AS CMP_IND,

MAX(

CASE	WHEN ((INSRNC_CVGE_TYPE_CD )= ''COLL''  ) THEN ''Y'' 

ELSE	''N'' 

END	 ) AS COLL_IND,

CASE	WHEN (CMP_IND=''N'' 

	AND	COLL_IND=''N'') THEN ''Y'' 

ELSE	''N'' 

END	LIABTY_ONLY_IND,

MAX(

CASE	WHEN ((INSRNC_CVGE_TYPE_CD )= ''LOU''  ) THEN ''Y'' 

ELSE	''N'' 

END	 ) AS LOU_IND,

MAX(

CASE	WHEN ((INSRNC_CVGE_TYPE_CD )= ''MED''  ) THEN ''Y'' 

ELSE	''N'' 

END	 ) AS MED_IND

FROM	

(

SELECT	A.AGMT_ID,PRTY_ASSET_ID,FEAT_ID 

FROM	db_t_prod_core.AGMT_INSRD_ASSET_FEAT A

JOIN db_t_prod_core.AGMT_PROD  AS AP 

	ON	A.AGMT_ID=AP.AGMT_ID 

JOIN db_t_prod_core.PROD  P 

	ON	AP.PROD_ID=P.PROD_ID 

WHERE	 PROD_NAME IN ( ''PPV'',''PPV2'' ,''COMMERCIAL'') 

	AND	CAST(A.AGMT_ASSET_FEAT_STRT_DTTM AS DATE)<='':CAL_END_DT''

	AND	CAST(A.TRANS_END_DTTM AS DATE)>='':CAL_END_DT''

QUALIFY	ROW_NUMBER() OVER(PARTITION BY A.AGMT_ID,A.PRTY_ASSET_ID,

		A.FEAT_ID 

ORDER	BY A.AGMT_ASSET_FEAT_STRT_DTTM DESC, A.TRANS_STRT_DTTM DESC ) = 1) T1

JOIN db_t_prod_core.FEAT AS F 

	ON	T1.FEAT_ID = F.FEAT_ID  

WHERE	F.INSRNC_CVGE_TYPE_CD IN (''BI'',''COMP'',''COLL'',''LOU'',''MED'')  

GROUP	BY 1) COV 

	ON	AG.AGMT_ID=COV.AGMT_ID

LEFT OUTER JOIN

(

select	AGMT_ID,

MAX(

CASE	WHEN( NK_SRC_KEY = ''PAMultiPolicyDiscount_alfa'') THEN ''Y'' 

ELSE	''N'' 

END	)  AS CD_DISC_IND,

MAX(

CASE	WHEN (NK_SRC_KEY IN(''PAMultiCarDiscount'',''PAKeepMultiCar_alfa'')) THEN ''Y'' 

ELSE	''N'' 

END	)  AS MTC_DISC_IND

FROM	

(

SELECT	A.AGMT_ID,FEAT_ID 

FROM	db_t_prod_core.AGMT_FEAT  A

JOIN db_t_prod_core.AGMT_PROD  AS AP 

	ON	A.AGMT_ID=AP.AGMT_ID 

JOIN db_t_prod_core.PROD  P 

	ON	AP.PROD_ID=P.PROD_ID 

WHERE	 PROD_NAME IN ( ''PPV'',''PPV2'' ,''COMMERCIAL'')  

	AND	A.FEAT_ELGBL_IND = ''T''

	AND	CAST(A.AGMT_FEAT_STRT_DTTM AS DATE)<='':CAL_END_DT''

QUALIFY	ROW_NUMBER() OVER(PARTITION BY A.AGMT_ID,A.FEAT_ID 

ORDER	BY A.AGMT_FEAT_STRT_DTTM DESC, A.TRANS_STRT_DTTM DESC ) = 1) T1

JOIN db_t_prod_core.FEAT AS F 

	ON	T1.FEAT_ID = F.FEAT_ID  

WHERE	F.INSRNC_LOB_TYPE_CD = ''PAWTC'' 

	AND	F.FEAT_SBTYPE_CD = ''MOD'' 

	AND	F.NK_SRC_KEY IN (''PAMultiPolicyDiscount_alfa'',''PAMultiCarDiscount'',

		''PAKeepMultiCar_alfa'')

GROUP	BY 1) DIS 

	ON	AG.AGMT_ID=DIS.AGMT_ID

LEFT OUTER JOIN  (

SELECT	AGMT_ID, MAX(

CASE	WHEN  ASSET_DTL_CD =''PLEASURE'' THEN ''Y'' 

ELSE	''N'' 

END	) PLEASURE_USE_IND,

MAX(

CASE	WHEN ANNUAL_DSTC_MEAS<=7500 THEN ''Y'' 

ELSE	''N'' 

END	) ANNUAL_DSTC_MEAS 

FROM	(

SELECT	AA.AGMT_ID, AA.PRTY_ASSET_ID 

FROM	db_t_prod_core.AGMT_ASSET AA

WHERE	CAST(AA.AGMT_ASSET_STRT_DTTM AS DATE)<='':CAL_END_DT''

	AND	CAST(AA.TRANS_END_DTTM AS DATE)>='':CAL_END_DT''

QUALIFY	ROW_NUMBER() OVER(PARTITION BY AA.AGMT_ID,AA.PRTY_ASSET_ID 

ORDER	BY AA.AGMT_ASSET_STRT_DTTM DESC, AA.TRANS_STRT_DTTM DESC ) = 1) AA

LEFT OUTER JOIN db_t_prod_core.ASSET_DTL_CD_XREF ADCX

	ON	AA.PRTY_ASSET_ID=ADCX.PRTY_ASSET_ID

LEFT OUTER JOIN db_t_prod_core.ASSET_MOTR_VEH_DTL MVD

	ON	AA.PRTY_ASSET_ID=MVD.PRTY_ASSET_ID

GROUP	BY 1) VEH 

	ON	VEH.AGMT_ID=AG.AGMT_ID

LEFT OUTER JOIN   db_t_prod_core.AGMTAGMT PREV 

	ON	

PREV.HOST_AGMT_NUM =AG.PLCY_NBR 

	AND	PREV.AGMT_TYPE_CD=''PPV'' 

	AND	CAST(PREV.MODL_EFF_DTTM AS DATE)<=ADD_MONTHS(CAST('':CAL_END_DT'' AS DATE),-1)

	AND	SRC_SYS_CD=''GWPC''

WHERE	 AGMT_STS_CD IN (''INFORCE'',''RNEWLLAPSD'',''CNFRMD'')

GROUP	BY 1,2,3,4,5,6,7,8,19
) SRC
)
);


-- Component LKP_PLCY_XREF, Type LOOKUP 
CREATE OR REPLACE TEMPORARY TABLE LKP_PLCY_XREF AS
(
SELECT
LKP.PLCY_ID,
sq_AGMT.PLCY_NUM as PLCY_NUM,
sq_AGMT.source_record_id,
ROW_NUMBER() OVER(PARTITION BY sq_AGMT.source_record_id ORDER BY LKP.PLCY_ID asc) RNK
FROM
sq_AGMT
LEFT JOIN (
SELECT PLCY_ID as PLCY_ID, PLCY_NBR as PLCY_NBR FROM  db_v_prod_pres.PLCY_XREF
WHERE SRC_TYPE=''GW''
QUALIFY ROW_NUMBER() OVER (PARTITION BY PLCY_NBR ORDER BY EDW_END_DTTM DESC)=1
) LKP ON  -- missing join condition, manaully added but needs to be verified
sq_AGMT.PLCY_ID = LKP.PLCY_ID
QUALIFY RNK = 1
);


-- Component exp_Passthrough, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_Passthrough AS
(
SELECT
LKP_PLCY_XREF.PLCY_ID as PLCY_ID,
sq_AGMT.MO_ID as MO_ID,
sq_AGMT.PRODUCER_ID as PRODUCER_ID,
sq_AGMT.BUSN_TYPE_CD as BUSN_TYPE_CD,
LKP_PLCY_XREF.PLCY_NUM as PLCY_NUM,
sq_AGMT.FRST_NAME as FRST_NAME,
sq_AGMT.LAST_NAME as LAST_NAME,
sq_AGMT.AGNT_NUM as AGNT_NUM,
sq_AGMT.SRVC_CTR_NUM as SRVC_CTR_NUM,
sq_AGMT.COMBO_IND as COMBO_IND,
sq_AGMT.MIN_LMTS_IND as MIN_LMTS_IND,
sq_AGMT.PLEASURE_USE_IND as PLEASURE_USE_IND,
sq_AGMT.SHRT_ANNUAL_MILES_IND as SHRT_ANNUAL_MILES_IND,
sq_AGMT.MULTICAR_IND as MULTICAR_IND,
sq_AGMT.LIABTY_ONLY_IND as LIABTY_ONLY_IND,
sq_AGMT.SRC_SYS_CD as SRC_SYS_CD,
sq_AGMT.YOUTHFUL_IND as YOUTHFUL_IND,
sq_AGMT.LOSS_OF_USE_IND as LOSS_OF_USE_IND,
sq_AGMT.MED_PAY_IND as MED_PAY_IND,
sq_AGMT.PROD_NAME as PROD_NAME,
sq_AGMT.source_record_id
FROM
sq_AGMT
INNER JOIN LKP_PLCY_XREF ON sq_AGMT.source_record_id = LKP_PLCY_XREF.source_record_id
);


-- Component fil_invalid_policynumber, Type FILTER 
CREATE OR REPLACE TEMPORARY TABLE fil_invalid_policynumber AS
(
SELECT
exp_Passthrough.PLCY_ID as PLCY_ID,
exp_Passthrough.MO_ID as MO_ID,
exp_Passthrough.PRODUCER_ID as PRODUCER_ID,
exp_Passthrough.BUSN_TYPE_CD as BUSN_TYPE_CD,
exp_Passthrough.PLCY_NUM as PLCY_NUM,
exp_Passthrough.FRST_NAME as FRST_NAME,
exp_Passthrough.LAST_NAME as LAST_NAME,
exp_Passthrough.AGNT_NUM as AGNT_NUM,
exp_Passthrough.SRVC_CTR_NUM as SRVC_CTR_NUM,
exp_Passthrough.COMBO_IND as COMBO_IND,
exp_Passthrough.MIN_LMTS_IND as MIN_LMTS_IND,
exp_Passthrough.PLEASURE_USE_IND as PLEASURE_USE_IND,
exp_Passthrough.SHRT_ANNUAL_MILES_IND as SHRT_ANNUAL_MILES_IND,
exp_Passthrough.MULTICAR_IND as MULTICAR_IND,
exp_Passthrough.LIABTY_ONLY_IND as LIABTY_ONLY_IND,
exp_Passthrough.SRC_SYS_CD as SRC_SYS_CD,
exp_Passthrough.YOUTHFUL_IND as YOUTHFUL_IND,
exp_Passthrough.LOSS_OF_USE_IND as LOSS_OF_USE_IND,
exp_Passthrough.MED_PAY_IND as MED_PAY_IND,
exp_Passthrough.PROD_NAME as PROD_NAME,
exp_Passthrough.source_record_id
FROM
exp_Passthrough
WHERE exp_Passthrough.PLCY_ID IS NOT NULL
);


-- Component D_AUTO_PLCY, Type TARGET 
INSERT INTO db_v_prod_pres.D_AUTO_PLCY
(
PLCY_ID,
MO_ID,
PRODUCER_ID,
BUSN_TYPE_CD,
PLCY_NUM,
FRST_NAME,
LAST_NAME,
AGNT_NUM,
SRVC_CTR_NUM,
COMBO_IND,
MIN_LMTS_IND,
PLEASURE_USE_IND,
SHRT_ANNUAL_MILES_IND,
MULTICAR_IND,
LIABTY_ONLY_IND,
SRC_SYS_CD,
YOUTHFUL_IND,
LOSS_OF_USE_IND,
MED_PAY_IND,
PROD_NAME
)
SELECT
fil_invalid_policynumber.PLCY_ID as PLCY_ID,
fil_invalid_policynumber.MO_ID as MO_ID,
fil_invalid_policynumber.PRODUCER_ID as PRODUCER_ID,
fil_invalid_policynumber.BUSN_TYPE_CD as BUSN_TYPE_CD,
fil_invalid_policynumber.PLCY_NUM as PLCY_NUM,
fil_invalid_policynumber.FRST_NAME as FRST_NAME,
fil_invalid_policynumber.LAST_NAME as LAST_NAME,
fil_invalid_policynumber.AGNT_NUM as AGNT_NUM,
fil_invalid_policynumber.SRVC_CTR_NUM as SRVC_CTR_NUM,
fil_invalid_policynumber.COMBO_IND as COMBO_IND,
fil_invalid_policynumber.MIN_LMTS_IND as MIN_LMTS_IND,
fil_invalid_policynumber.PLEASURE_USE_IND as PLEASURE_USE_IND,
fil_invalid_policynumber.SHRT_ANNUAL_MILES_IND as SHRT_ANNUAL_MILES_IND,
fil_invalid_policynumber.MULTICAR_IND as MULTICAR_IND,
fil_invalid_policynumber.LIABTY_ONLY_IND as LIABTY_ONLY_IND,
fil_invalid_policynumber.SRC_SYS_CD as SRC_SYS_CD,
fil_invalid_policynumber.YOUTHFUL_IND as YOUTHFUL_IND,
fil_invalid_policynumber.LOSS_OF_USE_IND as LOSS_OF_USE_IND,
fil_invalid_policynumber.MED_PAY_IND as MED_PAY_IND,
fil_invalid_policynumber.PROD_NAME as PROD_NAME
FROM
fil_invalid_policynumber;


END; ';
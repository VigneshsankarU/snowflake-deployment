-- Object Type: PROCEDURES
CREATE OR REPLACE PROCEDURE ALFA_EDW_DEV.PUBLIC.M_STG_CLMF_CLM_NO_TRL_WC("RUN_ID" VARCHAR)
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS ' BEGIN 

-- Component amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL, Type SOURCE 
CREATE OR REPLACE TEMPORARY TABLE amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL AS
(
SELECT /* adding column aliases to ensure proper downstream column references */
$1 as OPERATOR_ID,
$2 as COMPANY,
$3 as MRI,
$4 as TRL_COUNT,
$5 as POL_STATE,
$6 as PFX,
$7 as PNO,
$8 as DATE_O_LOSS,
$9 as SEQNO,
$10 as TRANS_ID,
$11 as DIST,
$12 as ADJSYM,
$13 as FAST_TRAC,
$14 as GLASBRK,
$15 as SUSP,
$16 as SAL_SUB,
$17 as SUIT_CD,
$18 as SLC_CD,
$19 as REPT_DT,
$20 as ACCTG_DT,
$21 as CAUSE_CD,
$22 as CAUSE_DESC,
$23 as COT_PLN,
$24 as CAT_CD,
$25 as RISK_ID,
$26 as CLOSE_CD,
$27 as CLOSE_DT,
$28 as NO_REO,
$29 as REIN,
$30 as ENC_CD,
$31 as AGTNO,
$32 as SCNO,
$33 as INSD_NM,
$34 as OCC_CD,
$35 as TIME_O_LOSS,
$36 as SUBROGATION_DATE,
$37 as PURG_CLM_FROM_FOLDER,
$38 as RECOVERABLE_LOSS_CD,
$39 as RECOVERABLE_LOSS_AMT,
$40 as PREM_FINANCE,
$41 as HIGH_PERFORM_CODE,
$42 as FIBER_GLASS_CODE,
$43 as INEXPER_DRVR_CODE,
$44 as FINANCIAL_RESPONBILITY_CODE,
$45 as MISC_DISCOUNT,
$46 as HO_DISCOUNT,
$47 as SM_SP_POLICY_IND,
$48 as PREV_AGENT,
$49 as CHANGE_AGT_DT,
$50 as WC_EFF_YR,
$51 as POL_FOLDER_DATE,
$52 as TRANSFERRED_POL_NBR,
$53 as CLUE_CHANGE_MMYY,
$54 as CLUE_REPT_ITEM,
$55 as MISS_FIRE_CLM_IND,
$56 as TIMES_NOT_FOUND,
$57 as TOT_RES_AMT,
$58 as TOT_PAID_AMT,
$59 as WC_AGEINSD,
$60 as WC_AMTWKLYBEN,
$61 as WC_LOSSCOV,
$62 as source_record_id
FROM (
SELECT SRC.*, row_number() over (order by 1) AS source_record_id FROM (
SELECT
clmfdm_CLMF_CLM_WC_NO_TRL.OPERATOR_ID,
clmfdm_CLMF_CLM_WC_NO_TRL.COMPANY,
clmfdm_CLMF_CLM_WC_NO_TRL.MRI,
clmfdm_CLMF_CLM_WC_NO_TRL.TRL_COUNT,
clmfdm_CLMF_CLM_WC_NO_TRL.POL_STATE,
clmfdm_CLMF_CLM_WC_NO_TRL.PFX,
clmfdm_CLMF_CLM_WC_NO_TRL.PNO,
clmfdm_CLMF_CLM_WC_NO_TRL.DATE_O_LOSS,
clmfdm_CLMF_CLM_WC_NO_TRL.SEQNO,
clmfdm_CLMF_CLM_WC_NO_TRL.TRANS_ID,
clmfdm_CLMF_CLM_WC_NO_TRL.DIST,
clmfdm_CLMF_CLM_WC_NO_TRL.ADJSYM,
clmfdm_CLMF_CLM_WC_NO_TRL.FAST_TRAC,
clmfdm_CLMF_CLM_WC_NO_TRL.GLASBRK,
clmfdm_CLMF_CLM_WC_NO_TRL.SUSP,
clmfdm_CLMF_CLM_WC_NO_TRL.SAL_SUB,
clmfdm_CLMF_CLM_WC_NO_TRL.SUIT_CD,
clmfdm_CLMF_CLM_WC_NO_TRL.SLC_CD,
clmfdm_CLMF_CLM_WC_NO_TRL.REPT_DT,
clmfdm_CLMF_CLM_WC_NO_TRL.ACCTG_DT,
clmfdm_CLMF_CLM_WC_NO_TRL.CAUSE_CD,
clmfdm_CLMF_CLM_WC_NO_TRL.CAUSE_DESC,
clmfdm_CLMF_CLM_WC_NO_TRL.COT_PLN,
clmfdm_CLMF_CLM_WC_NO_TRL.CAT_CD,
clmfdm_CLMF_CLM_WC_NO_TRL.RISK_ID,
clmfdm_CLMF_CLM_WC_NO_TRL.CLOSE_CD,
clmfdm_CLMF_CLM_WC_NO_TRL.CLOSE_DT,
clmfdm_CLMF_CLM_WC_NO_TRL.NO_REO,
clmfdm_CLMF_CLM_WC_NO_TRL.REIN,
clmfdm_CLMF_CLM_WC_NO_TRL.ENC_CD,
clmfdm_CLMF_CLM_WC_NO_TRL.AGTNO,
clmfdm_CLMF_CLM_WC_NO_TRL.SCNO,
clmfdm_CLMF_CLM_WC_NO_TRL.INSD_NM,
clmfdm_CLMF_CLM_WC_NO_TRL.OCC_CD,
clmfdm_CLMF_CLM_WC_NO_TRL.TIME_O_LOSS,
clmfdm_CLMF_CLM_WC_NO_TRL.SUBROGATION_DATE,
clmfdm_CLMF_CLM_WC_NO_TRL.PURG_CLM_FROM_FOLDER,
clmfdm_CLMF_CLM_WC_NO_TRL.RECOVERABLE_LOSS_CD,
clmfdm_CLMF_CLM_WC_NO_TRL.RECOVERABLE_LOSS_AMT,
clmfdm_CLMF_CLM_WC_NO_TRL.PREM_FINANCE,
clmfdm_CLMF_CLM_WC_NO_TRL.HIGH_PERFORM_CODE,
clmfdm_CLMF_CLM_WC_NO_TRL.FIBER_GLASS_CODE,
clmfdm_CLMF_CLM_WC_NO_TRL.INEXPER_DRVR_CODE,
clmfdm_CLMF_CLM_WC_NO_TRL.FINANCIAL_RESPONBILITY_CODE,
clmfdm_CLMF_CLM_WC_NO_TRL.MISC_DISCOUNT,
clmfdm_CLMF_CLM_WC_NO_TRL.HO_DISCOUNT,
clmfdm_CLMF_CLM_WC_NO_TRL.SM_SP_POLICY_IND,
clmfdm_CLMF_CLM_WC_NO_TRL.PREV_AGENT,
clmfdm_CLMF_CLM_WC_NO_TRL.CHANGE_AGT_DT,
clmfdm_CLMF_CLM_WC_NO_TRL.WC_EFF_YR,
clmfdm_CLMF_CLM_WC_NO_TRL.POL_FOLDER_DATE,
clmfdm_CLMF_CLM_WC_NO_TRL.TRANSFERRED_POL_NBR,
clmfdm_CLMF_CLM_WC_NO_TRL.CLUE_CHANGE_MMYY,
clmfdm_CLMF_CLM_WC_NO_TRL.CLUE_REPT_ITEM,
clmfdm_CLMF_CLM_WC_NO_TRL.MISS_FIRE_CLM_IND,
clmfdm_CLMF_CLM_WC_NO_TRL.TIMES_NOT_FOUND,
clmfdm_CLMF_CLM_WC_NO_TRL.TOT_RES_AMT,
clmfdm_CLMF_CLM_WC_NO_TRL.TOT_PAID_AMT,
clmfdm_CLMF_CLM_WC_NO_TRL.WC_AGEINSD,
clmfdm_CLMF_CLM_WC_NO_TRL.WC_AMTWKLYBEN,
clmfdm_CLMF_CLM_WC_NO_TRL.WC_LOSSCOV
FROM clmfdm_CLMF_CLM_WC_NO_TRL
) SRC
)
);

CREATE
OR REPLACE TEMPORARY FUNCTION AGECONV_MMDDYY (input_date TEXT) RETURNS DATE AS ''CASE WHEN LENGTH(TRIM(input_date)) = 6 THEN TO_DATE(input_date, \\''MMDDYY\\'') ELSE NULL END'';
CREATE
OR REPLACE TEMPORARY FUNCTION DATECONV_CYYMMDD (input_date TEXT) RETURNS DATE AS ''CASE WHEN LENGTH(TRIM(input_date)) = 7 THEN TO_DATE(CASE WHEN LEFT(input_date,1) IN (\\''0\\'',\\''1\\'') THEN \\''20\\'' || input_date ELSE \\''19\\'' || input_date END, \\''YYYYMMDD\\'') ELSE NULL END'';

-- Component exp_DATE_CONVERSION, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_DATE_CONVERSION AS
(
SELECT
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.OPERATOR_ID as OPERATOR_ID,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.COMPANY as COMPANY,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.MRI as MRI,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.TRL_COUNT as TRL_COUNT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.POL_STATE as POL_STATE,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.PFX as PFX,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.PNO as PNO,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.DATE_O_LOSS as DATE_O_LOSS,
DATECONV_CYYMMDD ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.DATE_O_LOSS ) as out_DATE_O_LOSS,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.SEQNO as SEQNO,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.TRANS_ID as TRANS_ID,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.DIST as DIST,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.ADJSYM as ADJSYM,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.FAST_TRAC as FAST_TRAC,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.GLASBRK as GLASBRK,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.SUSP as SUSP,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.SAL_SUB as SAL_SUB,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.SUIT_CD as SUIT_CD,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.SLC_CD as SLC_CD,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.REPT_DT as REPT_DT,
DATECONV_CYYMMDD ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.REPT_DT ) as out_REPT_DT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.ACCTG_DT as ACCTG_DT,
DATECONV_CYYMMDD ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.ACCTG_DT ) as out_ACCTG_DT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CAUSE_CD as CAUSE_CD,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CAUSE_DESC as CAUSE_DESC,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.COT_PLN as COT_PLN,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CAT_CD as CAT_CD,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.RISK_ID as RISK_ID,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CLOSE_CD as CLOSE_CD,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CLOSE_DT as CLOSE_DT,
DATECONV_CYYMMDD ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CLOSE_DT ) as out_CLOSE_DT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.NO_REO as NO_REO,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.REIN as REIN,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.ENC_CD as ENC_CD,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.AGTNO as AGTNO,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.SCNO as SCNO,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.INSD_NM as INSD_NM,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.OCC_CD as OCC_CD,
CASE WHEN ( SUBSTR ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.TIME_O_LOSS , 3 , 1 ) = ''A'' OR SUBSTR ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.TIME_O_LOSS , 3 , 1 ) = ''P'' ) THEN ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.TIME_O_LOSS || ''M'' ) ELSE amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.TIME_O_LOSS END as var_TIME_O_LOSS,
CASE WHEN IS_DATE ( var_TIME_O_LOSS , ''HH12AM'' ) THEN var_TIME_O_LOSS ELSE ''INVALID'' END as out_TIME_O_LOSS,
CASE WHEN ( TO_NUMBER(amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.SUBROGATION_DATE) = 0 OR amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.SUBROGATION_DATE IS NULL ) THEN NULL ELSE LPAD ( TO_CHAR ( TO_NUMBER(amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.SUBROGATION_DATE) ) , 4 , ''0'' ) END as out_SUBROGATION_DATE,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.PURG_CLM_FROM_FOLDER as PURG_CLM_FROM_FOLDER,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.RECOVERABLE_LOSS_CD as RECOVERABLE_LOSS_CD,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.RECOVERABLE_LOSS_AMT as RECOVERABLE_LOSS_AMT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.PREM_FINANCE as PREM_FINANCE,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.HIGH_PERFORM_CODE as HIGH_PERFORM_CODE,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.FIBER_GLASS_CODE as FIBER_GLASS_CODE,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.INEXPER_DRVR_CODE as INEXPER_DRVR_CODE,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.FINANCIAL_RESPONBILITY_CODE as FINANCIAL_RESPONBILITY_CODE,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.MISC_DISCOUNT as MISC_DISCOUNT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.HO_DISCOUNT as HO_DISCOUNT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.SM_SP_POLICY_IND as SM_SP_POLICY_IND,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.PREV_AGENT as PREV_AGENT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CHANGE_AGT_DT as CHANGE_AGT_DT,
DATECONV_CYYMMDD ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CHANGE_AGT_DT ) as out_CHANGE_AGT_DT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.WC_EFF_YR as WC_EFF_YR,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.POL_FOLDER_DATE as POL_FOLDER_DATE,
DATECONV_CYYMMDD ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.POL_FOLDER_DATE ) as out_POL_FOLDER_DATE,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.TRANSFERRED_POL_NBR as TRANSFERRED_POL_NBR,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CLUE_CHANGE_MMYY as CLUE_CHANGE_MMYY,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CLUE_REPT_ITEM as CLUE_REPT_ITEM,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.MISS_FIRE_CLM_IND as MISS_FIRE_CLM_IND,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.TIMES_NOT_FOUND as TIMES_NOT_FOUND,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.TOT_RES_AMT as TOT_RES_AMT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.TOT_PAID_AMT as TOT_PAID_AMT,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.WC_AGEINSD as WC_AGEINSD,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.WC_AMTWKLYBEN as WC_AMTWKLYBEN,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.WC_LOSSCOV as WC_LOSSCOV,
DATECONV_CYYMMDD ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.DATE_O_LOSS ) as v_DATE_OF_LOSS,
LPAD ( RTRIM ( TO_CHAR ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.POL_STATE ) ) , 2 , ''0'' ) as o_STATE,
RTRIM ( amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.CAT_CD ) as o_CAT_CD,
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL.source_record_id
FROM
amgdsq_clmfdm_CLMF_CLM_WC_NO_TRL
);


-- Component LKP_CAT_CODE, Type LOOKUP 
CREATE OR REPLACE TEMPORARY TABLE LKP_CAT_CODE AS
(
SELECT
LKP.CAT_3CATCODE,
exp_DATE_CONVERSION.source_record_id,
ROW_NUMBER() OVER(PARTITION BY exp_DATE_CONVERSION.source_record_id ORDER BY LKP.CAT_STATE asc,LKP.CAT_CATCODE asc,LKP.CAT_START_DT asc,LKP.CAT_END_DT asc,LKP.CAT_YEAR asc,LKP.CAT_3CATCODE asc) RNK
FROM
exp_DATE_CONVERSION
LEFT JOIN (
SELECT
CAT_STATE,
CAT_CATCODE,
CAT_START_DT,
CAT_END_DT,
CAT_YEAR,
CAT_3CATCODE
FROM CAT_CD_LOOKUP
) LKP ON LKP.CAT_STATE = exp_DATE_CONVERSION.o_STATE AND LKP.CAT_CATCODE = exp_DATE_CONVERSION.o_CAT_CD AND LKP.CAT_START_DT <= exp_DATE_CONVERSION.out_DATE_O_LOSS AND LKP.CAT_END_DT >= exp_DATE_CONVERSION.out_DATE_O_LOSS
QUALIFY RNK = 1
);


-- Component exp_TARGET_ANCHOR, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE exp_TARGET_ANCHOR AS
(
SELECT
exp_DATE_CONVERSION.OPERATOR_ID as OPERATOR_ID,
exp_DATE_CONVERSION.COMPANY as COMPANY,
exp_DATE_CONVERSION.MRI as MRI,
exp_DATE_CONVERSION.TRL_COUNT as TRL_COUNT,
exp_DATE_CONVERSION.POL_STATE as POL_STATE,
exp_DATE_CONVERSION.PFX as PFX,
exp_DATE_CONVERSION.PNO as PNO,
exp_DATE_CONVERSION.DATE_O_LOSS as DATE_O_LOSS,
exp_DATE_CONVERSION.out_DATE_O_LOSS as out_DATE_O_LOSS,
exp_DATE_CONVERSION.SEQNO as SEQNO,
exp_DATE_CONVERSION.TRANS_ID as TRANS_ID,
exp_DATE_CONVERSION.DIST as DIST,
exp_DATE_CONVERSION.ADJSYM as ADJSYM,
exp_DATE_CONVERSION.FAST_TRAC as FAST_TRAC,
exp_DATE_CONVERSION.GLASBRK as GLASBRK,
exp_DATE_CONVERSION.SUSP as SUSP,
exp_DATE_CONVERSION.SAL_SUB as SAL_SUB,
exp_DATE_CONVERSION.SUIT_CD as SUIT_CD,
exp_DATE_CONVERSION.SLC_CD as SLC_CD,
exp_DATE_CONVERSION.REPT_DT as REPT_DT,
exp_DATE_CONVERSION.out_REPT_DT as out_REPT_DT,
exp_DATE_CONVERSION.ACCTG_DT as ACCTG_DT,
exp_DATE_CONVERSION.out_ACCTG_DT as out_ACCTG_DT,
exp_DATE_CONVERSION.CAUSE_CD as CAUSE_CD,
exp_DATE_CONVERSION.CAUSE_DESC as CAUSE_DESC,
exp_DATE_CONVERSION.COT_PLN as COT_PLN,
exp_DATE_CONVERSION.CAT_CD as CAT_CD,
exp_DATE_CONVERSION.RISK_ID as RISK_ID,
exp_DATE_CONVERSION.CLOSE_CD as CLOSE_CD,
exp_DATE_CONVERSION.CLOSE_DT as CLOSE_DT,
exp_DATE_CONVERSION.out_CLOSE_DT as out_CLOSE_DT,
exp_DATE_CONVERSION.NO_REO as NO_REO,
exp_DATE_CONVERSION.REIN as REIN,
exp_DATE_CONVERSION.ENC_CD as ENC_CD,
exp_DATE_CONVERSION.AGTNO as AGTNO,
exp_DATE_CONVERSION.SCNO as SCNO,
exp_DATE_CONVERSION.INSD_NM as INSD_NM,
exp_DATE_CONVERSION.OCC_CD as OCC_CD,
exp_DATE_CONVERSION.out_TIME_O_LOSS as out_TIME_O_LOSS,
exp_DATE_CONVERSION.out_SUBROGATION_DATE as out_SUBROGATION_DATE,
exp_DATE_CONVERSION.PURG_CLM_FROM_FOLDER as PURG_CLM_FROM_FOLDER,
exp_DATE_CONVERSION.RECOVERABLE_LOSS_CD as RECOVERABLE_LOSS_CD,
exp_DATE_CONVERSION.RECOVERABLE_LOSS_AMT as RECOVERABLE_LOSS_AMT,
exp_DATE_CONVERSION.PREM_FINANCE as PREM_FINANCE,
exp_DATE_CONVERSION.HIGH_PERFORM_CODE as HIGH_PERFORM_CODE,
exp_DATE_CONVERSION.FIBER_GLASS_CODE as FIBER_GLASS_CODE,
exp_DATE_CONVERSION.INEXPER_DRVR_CODE as INEXPER_DRVR_CODE,
exp_DATE_CONVERSION.FINANCIAL_RESPONBILITY_CODE as FINANCIAL_RESPONBILITY_CODE,
exp_DATE_CONVERSION.MISC_DISCOUNT as MISC_DISCOUNT,
exp_DATE_CONVERSION.HO_DISCOUNT as HO_DISCOUNT,
exp_DATE_CONVERSION.SM_SP_POLICY_IND as SM_SP_POLICY_IND,
exp_DATE_CONVERSION.PREV_AGENT as PREV_AGENT,
exp_DATE_CONVERSION.CHANGE_AGT_DT as CHANGE_AGT_DT,
exp_DATE_CONVERSION.out_CHANGE_AGT_DT as out_CHANGE_AGT_DT,
exp_DATE_CONVERSION.WC_EFF_YR as WC_EFF_YR,
exp_DATE_CONVERSION.POL_FOLDER_DATE as POL_FOLDER_DATE,
exp_DATE_CONVERSION.out_POL_FOLDER_DATE as out_POL_FOLDER_DATE,
exp_DATE_CONVERSION.TRANSFERRED_POL_NBR as TRANSFERRED_POL_NBR,
exp_DATE_CONVERSION.CLUE_CHANGE_MMYY as CLUE_CHANGE_MMYY,
exp_DATE_CONVERSION.CLUE_REPT_ITEM as CLUE_REPT_ITEM,
exp_DATE_CONVERSION.MISS_FIRE_CLM_IND as MISS_FIRE_CLM_IND,
exp_DATE_CONVERSION.TIMES_NOT_FOUND as TIMES_NOT_FOUND,
exp_DATE_CONVERSION.TOT_RES_AMT as TOT_RES_AMT,
exp_DATE_CONVERSION.TOT_PAID_AMT as TOT_PAID_AMT,
exp_DATE_CONVERSION.WC_AGEINSD as WC_AGEINSD,
exp_DATE_CONVERSION.WC_AMTWKLYBEN as WC_AMTWKLYBEN,
exp_DATE_CONVERSION.WC_LOSSCOV as WC_LOSSCOV,
LTRIM ( RTRIM ( exp_DATE_CONVERSION.CAT_CD ) ) as v_CAT_CD,
LTRIM ( RTRIM ( LKP_CAT_CODE.CAT_3CATCODE ) ) as v_CAT_3CATCODE,
CASE WHEN v_CAT_CD IS NULL OR LENGTH ( v_CAT_CD ) = 0 THEN CASE WHEN v_CAT_3CATCODE IS NULL OR LENGTH ( v_CAT_3CATCODE ) = 0 THEN v_CAT_3CATCODE ELSE v_CAT_CD END ELSE CASE WHEN v_CAT_3CATCODE IS NULL OR LENGTH ( v_CAT_3CATCODE ) = 0 THEN v_CAT_CD ELSE v_CAT_3CATCODE END END as v_CAT_3CATCODE_TEMP,
CASE WHEN v_CAT_3CATCODE_TEMP IS NULL THEN ''          '' ELSE v_CAT_3CATCODE_TEMP END as o_CAT_3CATCODE,
exp_DATE_CONVERSION.source_record_id
FROM
exp_DATE_CONVERSION
INNER JOIN LKP_CAT_CODE ON exp_DATE_CONVERSION.source_record_id = LKP_CAT_CODE.source_record_id
);


-- Component STG_CLMF_CLM_NO_TRL_WC, Type TARGET 
INSERT INTO DB_T_STAG_PROD.STG_CLMF_CLM_NO_TRL_WC
(
OPERATOR_ID,
COMPANY,
MRI,
TRL_COUNT,
POL_STATE,
PFX,
PNO,
DATE_O_LOSS,
DATE_O_LOSS_DT,
SEQNO,
TRANS_ID,
DIST,
ADJSYM,
FAST_TRAC,
GLASBRK,
SUSP,
SAL_SUB,
SUIT_CD,
SLC_CD,
REPT_DT,
REPT_DATE,
ACCTG_DT,
ACCTG_DATE,
CAUSE_CD,
CAUSE_DESC,
COT_PLN,
CAT_CD,
RISK_ID,
CLOSE_CD,
CLOSE_DT,
CLOSE_DATE,
NO_REO,
REIN,
ENC_CD,
AGTNO,
SCNO,
INSD_NM,
OCC_CD,
TIME_O_LOSS,
SUBROGATION_DATE,
PURG_CLM_FROM_FOLDER,
RECOVERABLE_LOSS_CD,
RECOVERABLE_LOSS_AMT,
PREM_FINANCE,
HIGH_PERFORM_CODE,
FIBER_GLASS_CODE,
INEXPER_DRVR_CODE,
FINANCIAL_RESPONBILITY_CODE,
MISC_DISCOUNT,
HO_DISCOUNT,
SM_SP_POLICY_IND,
PREV_AGENT,
CHANGE_AGT_DT,
CHANGE_AGT_DATE,
WC_EFF_YR,
POL_FOLDER_DATE,
POL_FOLDER_DT,
TRANSFERRED_POL_NBR,
CLUE_CHANGE_MMYY,
CLUE_REPT_ITEM,
MISS_FIRE_CLM_IND,
TIMES_NOT_FOUND,
TOT_RES_AMT,
TOT_PAID_AMT,
WC_AGEINSD,
WC_AMT_WEEKLY_BEN,
WC_LOSS_COV
)
SELECT
exp_TARGET_ANCHOR.OPERATOR_ID as OPERATOR_ID,
exp_TARGET_ANCHOR.COMPANY as COMPANY,
exp_TARGET_ANCHOR.MRI as MRI,
exp_TARGET_ANCHOR.TRL_COUNT as TRL_COUNT,
exp_TARGET_ANCHOR.POL_STATE as POL_STATE,
exp_TARGET_ANCHOR.PFX as PFX,
exp_TARGET_ANCHOR.PNO as PNO,
exp_TARGET_ANCHOR.DATE_O_LOSS as DATE_O_LOSS,
exp_TARGET_ANCHOR.out_DATE_O_LOSS as DATE_O_LOSS_DT,
exp_TARGET_ANCHOR.SEQNO as SEQNO,
exp_TARGET_ANCHOR.TRANS_ID as TRANS_ID,
exp_TARGET_ANCHOR.DIST as DIST,
exp_TARGET_ANCHOR.ADJSYM as ADJSYM,
exp_TARGET_ANCHOR.FAST_TRAC as FAST_TRAC,
exp_TARGET_ANCHOR.GLASBRK as GLASBRK,
exp_TARGET_ANCHOR.SUSP as SUSP,
exp_TARGET_ANCHOR.SAL_SUB as SAL_SUB,
exp_TARGET_ANCHOR.SUIT_CD as SUIT_CD,
exp_TARGET_ANCHOR.SLC_CD as SLC_CD,
exp_TARGET_ANCHOR.REPT_DT as REPT_DT,
exp_TARGET_ANCHOR.out_REPT_DT as REPT_DATE,
exp_TARGET_ANCHOR.ACCTG_DT as ACCTG_DT,
exp_TARGET_ANCHOR.out_ACCTG_DT as ACCTG_DATE,
exp_TARGET_ANCHOR.CAUSE_CD as CAUSE_CD,
exp_TARGET_ANCHOR.CAUSE_DESC as CAUSE_DESC,
exp_TARGET_ANCHOR.COT_PLN as COT_PLN,
exp_TARGET_ANCHOR.o_CAT_3CATCODE as CAT_CD,
exp_TARGET_ANCHOR.RISK_ID as RISK_ID,
exp_TARGET_ANCHOR.CLOSE_CD as CLOSE_CD,
exp_TARGET_ANCHOR.CLOSE_DT as CLOSE_DT,
exp_TARGET_ANCHOR.out_CLOSE_DT as CLOSE_DATE,
exp_TARGET_ANCHOR.NO_REO as NO_REO,
exp_TARGET_ANCHOR.REIN as REIN,
exp_TARGET_ANCHOR.ENC_CD as ENC_CD,
exp_TARGET_ANCHOR.AGTNO as AGTNO,
exp_TARGET_ANCHOR.SCNO as SCNO,
exp_TARGET_ANCHOR.INSD_NM as INSD_NM,
exp_TARGET_ANCHOR.OCC_CD as OCC_CD,
exp_TARGET_ANCHOR.out_TIME_O_LOSS as TIME_O_LOSS,
exp_TARGET_ANCHOR.out_SUBROGATION_DATE as SUBROGATION_DATE,
exp_TARGET_ANCHOR.PURG_CLM_FROM_FOLDER as PURG_CLM_FROM_FOLDER,
exp_TARGET_ANCHOR.RECOVERABLE_LOSS_CD as RECOVERABLE_LOSS_CD,
exp_TARGET_ANCHOR.RECOVERABLE_LOSS_AMT as RECOVERABLE_LOSS_AMT,
exp_TARGET_ANCHOR.PREM_FINANCE as PREM_FINANCE,
exp_TARGET_ANCHOR.HIGH_PERFORM_CODE as HIGH_PERFORM_CODE,
exp_TARGET_ANCHOR.FIBER_GLASS_CODE as FIBER_GLASS_CODE,
exp_TARGET_ANCHOR.INEXPER_DRVR_CODE as INEXPER_DRVR_CODE,
exp_TARGET_ANCHOR.FINANCIAL_RESPONBILITY_CODE as FINANCIAL_RESPONBILITY_CODE,
exp_TARGET_ANCHOR.MISC_DISCOUNT as MISC_DISCOUNT,
exp_TARGET_ANCHOR.HO_DISCOUNT as HO_DISCOUNT,
exp_TARGET_ANCHOR.SM_SP_POLICY_IND as SM_SP_POLICY_IND,
exp_TARGET_ANCHOR.PREV_AGENT as PREV_AGENT,
exp_TARGET_ANCHOR.CHANGE_AGT_DT as CHANGE_AGT_DT,
exp_TARGET_ANCHOR.out_CHANGE_AGT_DT as CHANGE_AGT_DATE,
exp_TARGET_ANCHOR.WC_EFF_YR as WC_EFF_YR,
exp_TARGET_ANCHOR.POL_FOLDER_DATE as POL_FOLDER_DATE,
exp_TARGET_ANCHOR.out_POL_FOLDER_DATE as POL_FOLDER_DT,
exp_TARGET_ANCHOR.TRANSFERRED_POL_NBR as TRANSFERRED_POL_NBR,
exp_TARGET_ANCHOR.CLUE_CHANGE_MMYY as CLUE_CHANGE_MMYY,
exp_TARGET_ANCHOR.CLUE_REPT_ITEM as CLUE_REPT_ITEM,
exp_TARGET_ANCHOR.MISS_FIRE_CLM_IND as MISS_FIRE_CLM_IND,
exp_TARGET_ANCHOR.TIMES_NOT_FOUND as TIMES_NOT_FOUND,
exp_TARGET_ANCHOR.TOT_RES_AMT as TOT_RES_AMT,
exp_TARGET_ANCHOR.TOT_PAID_AMT as TOT_PAID_AMT,
exp_TARGET_ANCHOR.WC_AGEINSD as WC_AGEINSD,
exp_TARGET_ANCHOR.WC_AMTWKLYBEN as WC_AMT_WEEKLY_BEN,
exp_TARGET_ANCHOR.WC_LOSSCOV as WC_LOSS_COV
FROM
exp_TARGET_ANCHOR;


END; ';
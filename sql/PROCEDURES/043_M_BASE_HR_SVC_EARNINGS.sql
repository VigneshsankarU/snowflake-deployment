-- Object Type: PROCEDURES
CREATE OR REPLACE PROCEDURE ALFA_EDW_DEV.PUBLIC.M_BASE_HR_SVC_EARNINGS("PARAM_JSON" VARCHAR)
RETURNS VARCHAR
LANGUAGE SQL
EXECUTE AS CALLER
AS ' BEGIN 

-- Component SQ_SRC_HR_SVC_EARNINGS_SRC, Type TABLE_DDL Creating an empty table
CREATE OR REPLACE TEMPORARY TABLE SQ_SRC_HR_SVC_EARNINGS
(
AMT varchar(20),
EARN_CD varchar(50),
COMBO_CD varchar(50),
GRP varchar(50),
STATE varchar(50),
PAY_PRD varchar(10),
SVC integer,
HR_TYP_CD varchar(50),
source_record_id number autoincrement start 1 increment 1
);


-- Component SQ_SRC_HR_SVC_EARNINGS_SRC, Type IMPORT_DATA Importing Data
;


-- Component EXP_HR_SVC_EARNINGS, Type EXPRESSION 
CREATE OR REPLACE TEMPORARY TABLE EXP_HR_SVC_EARNINGS AS
(
SELECT
TO_NUMBER(TO_CHAR ( CURRENT_TIMESTAMP , ''YYYYMM'' )) as MO_ID,
IFNULL(TRY_TO_DECIMAL(REPLACE(SQ_SRC_HR_SVC_EARNINGS.AMT,'','',NULL)), 0) as o_AMT,
SQ_SRC_HR_SVC_EARNINGS.EARN_CD as EARN_CD,
SQ_SRC_HR_SVC_EARNINGS.COMBO_CD as COMBO_CD,
SQ_SRC_HR_SVC_EARNINGS.GRP as GRP,
SQ_SRC_HR_SVC_EARNINGS.STATE as STATE,
TO_DATE ( SQ_SRC_HR_SVC_EARNINGS.PAY_PRD , ''MM/DD/YYYY'' ) as o_PAY_PRD,
SQ_SRC_HR_SVC_EARNINGS.SVC as SVC,
SQ_SRC_HR_SVC_EARNINGS.HR_TYP_CD as HR_TYP_CD,
$PRCS_ID as PRCS_ID,
CURRENT_TIMESTAMP as LOAD_DTTM,
SQ_SRC_HR_SVC_EARNINGS.source_record_id
FROM
SQ_SRC_HR_SVC_EARNINGS
);


-- Component HR_SVC_EARNINGS, Type TARGET 
INSERT INTO DB_T_PROD_COMN.HR_SVC_EARNINGS
(
MO_ID,
AMT,
EARN_CD,
COMBO_CD,
GRP,
STATE,
PAY_PRD,
SVC,
HR_TYP_CD,
PRCS_ID,
LOAD_DTTM
)
SELECT
EXP_HR_SVC_EARNINGS.MO_ID as MO_ID,
EXP_HR_SVC_EARNINGS.o_AMT as AMT,
EXP_HR_SVC_EARNINGS.EARN_CD as EARN_CD,
EXP_HR_SVC_EARNINGS.COMBO_CD as COMBO_CD,
EXP_HR_SVC_EARNINGS.GRP as GRP,
EXP_HR_SVC_EARNINGS.STATE as STATE,
EXP_HR_SVC_EARNINGS.o_PAY_PRD as PAY_PRD,
EXP_HR_SVC_EARNINGS.SVC as SVC,
EXP_HR_SVC_EARNINGS.HR_TYP_CD as HR_TYP_CD,
EXP_HR_SVC_EARNINGS.PRCS_ID as PRCS_ID,
EXP_HR_SVC_EARNINGS.LOAD_DTTM as LOAD_DTTM
FROM
EXP_HR_SVC_EARNINGS;


END; ';